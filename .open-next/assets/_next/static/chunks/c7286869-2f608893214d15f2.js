"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4398],{75725:(e,t,n)=>{n.d(t,{LF:()=>e4,Og:()=>oI,pq:()=>oC,v$:()=>eP,zz:()=>oj});var o=n(11748),i=n(12115),r=n(70469),a=n(95155),l=n(43538),s=n(8186),c=n(63941),d=n(49059),p=n(64681),h=n(60392),u=n(53768),f=n(29744),y=n(35138),g=n(3254),m=n(62128),k=n(79886),v=n(57433),b=n(58179),x=n(51257),_=n(69384),E=n(40609),w=n(64358),S=n(25015),B=n(84258),K=n(1180),T=n(77963),A=n(85862),O=n(58140),D=n(78411),N=n(4159),I=n(20648),M=n(91550),j=n(98134),C=n(34814),P=n(52254),z=n(60013),R=n(79998),$=n(34741),L=n(31536);let V="sanity-pte:";function G(e){let t=`${V}${e}`;return p&&p.enabled(t)?p(t):p(V)}p(V);let U="void-child";function F(e,t){let n=t[e._key];return n&&y(e,n)?n:(t[e._key]=e,e)}function H(e,{schemaTypes:t},n={}){return e&&Array.isArray(e)?e.map(e=>{let{_type:o,_key:i,...r}=e;if(e&&e._type===t.block.name){let a=!1,l=typeof e.style>"u",s=typeof e.markDefs>"u",d=typeof e.children>"u",p=(e.children||[]).map(e=>{let{_type:t,_key:o,...i}=e;return"span"!==t?(a=!0,F({_type:t,_key:o,children:[{_key:U,_type:"span",text:"",marks:[]}],value:i,__inline:!0},n)):e});return!(!l&&!s&&!d&&!a&&c.Hg.isElement(e))?(l&&(r.style=t.styles[0].name),F({_type:o,_key:i,...r,children:p},n)):e}return F({_type:o,_key:i,children:[{_key:U,_type:"span",text:"",marks:[]}],value:r},n)}):[]}function Q(e,t,n={}){return e.map(e=>{let{_key:o,_type:i}=e;if(!o||!i)throw Error("Not a valid block");if(i===t&&"children"in e&&Array.isArray(e.children)&&o){let t=!1,r=e.children.map(e=>{let{_type:o}=e;if("value"in e&&"span"!==o){t=!0;let{value:o,_key:i,_type:r,__inline:a,children:l,...s}=e;return F({...s,...o,_key:i,_type:r},n)}return e});return t?F({...e,children:r,_key:o,_type:i},n):e}let r="value"in e&&e.value;return F({_key:o,_type:i,..."object"==typeof r?r:{}},n)})}function W(e,t){return void 0===e||e&&Array.isArray(e)&&0===e.length||e&&Array.isArray(e)&&1===e.length&&c.Hg.isElement(e[0])&&e[0]._type===t.block.name&&"style"in e[0]&&e[0].style===t.styles[0].name&&!("listItem"in e[0])&&Array.isArray(e[0].children)&&1===e[0].children.length&&c.EY.isText(e[0].children[0])&&"span"===e[0].children[0]._type&&!e[0].children[0].marks?.join("")&&""===e[0].children[0].text}function J({editor:e}){if(!e.selection)return[void 0,void 0];try{return c.KE.node(e,e.selection.focus.path.slice(0,1))??[void 0,void 0]}catch{return[void 0,void 0]}}function Y({editor:e,point:t}){try{let[n]=c.KE.node(e,t.path.slice(0,1))??[void 0,void 0];return n?[n,t.path.slice(0,1)]:[void 0,void 0]}catch{return[void 0,void 0]}}function q({editor:e,point:t}){let[n,o]=Y({editor:e,point:t}),i=t.path.at(1);if(!n||!o||void 0===i)return[void 0,void 0];try{let e=c.bP.child(n,i);return e?[e,[...o,i]]:[void 0,void 0]}catch{return[void 0,void 0]}}function Z({editor:e}){if(0===e.children.length)return[void 0,void 0];let t=c.KE.end(e,[]).path.at(0);try{return void 0!==t?c.KE.node(e,[t])??[void 0,void 0]:[void 0,void 0]}catch{return[void 0,void 0]}}function X({schema:e,element:t}){return Q([t],e.block.name)?.at(0)}function ee({editor:e,schema:t},n){return c.Hg.isElement(n)&&!e.isInline(n)&&(t.block.name===n._type||t.blockObjects.some(e=>e.name===n._type))}function et({schema:e,editor:t,range:n}){let[o]=Y({editor:t,point:n.anchor}),[i]=Y({editor:t,point:n.focus});if(!o||!i)return null;let[r]=o._type===e.block.name?q({editor:t,point:n.anchor}):[void 0,void 0],[a]=i._type===e.block.name?q({editor:t,point:n.focus}):[void 0,void 0],l={anchor:{path:[{_key:o._key}],offset:n.anchor.offset},focus:{path:[{_key:i._key}],offset:n.focus.offset},backward:c.Q6.isBackward(n)};return r&&(l.anchor.path.push("children"),l.anchor.path.push({_key:r._key})),a&&(l.focus.path.push("children"),l.focus.path.push({_key:a._key})),l}function en({editorActor:e,slateEditor:t,event:n}){if(e.getSnapshot().matches({setup:"setting up"}))return;let o=function({slateEditor:e,event:t}){return h.wE.hasTarget(e,t.target)?h.wE.toSlateNode(e,t.target):void 0}({slateEditor:t,event:n});if(!o)return;let i=function({editor:e,schema:t,node:n}){if(c.KE.isEditor(n))return;if(ee({editor:e,schema:t},n))return X({schema:t,element:n});let o=Array.from(c.KE.nodes(e,{mode:"highest",at:[],match:o=>ee({editor:e,schema:t},o)&&o.children.some(e=>e._key===n._key)})).at(0)?.at(0);return c.Hg.isElement(o)?X({schema:t,element:o}):void 0}({editor:t,schema:e.getSnapshot().context.schema,node:o}),r=function({node:e,slateEditor:t,event:n}){let[o]=function({editor:e}){if(0===e.children.length)return[void 0,void 0];let t=c.KE.start(e,[]).path.at(0);try{return void 0!==t?c.KE.node(e,[t])??[void 0,void 0]:[void 0,void 0]}catch{return[void 0,void 0]}}({editor:t});if(!o)return;let i=h.wE.toDOMNode(t,o).getBoundingClientRect();if(n.pageY<i.top)return"start";let[r]=Z({editor:t});if(!r)return;let a=h.wE.toDOMNode(t,r).getBoundingClientRect();if(n.pageY>a.bottom)return"end";let l=h.wE.toDOMNode(t,e).getBoundingClientRect(),s=l.top,d=l.height;return Math.abs(s-n.pageY)<d/2?"start":"end"}({node:o,slateEditor:t,event:n}),a=function({schema:e,slateEditor:t,event:n}){let o=function(e,t){let n,o;if(!t.target||!(0,h.vA)(t.target))return;let i=h.wE.getWindow(e);if(void 0!==i.document.caretPositionFromPoint){let e=i.document.caretPositionFromPoint(t.clientX,t.clientY);if(e)try{(n=i.document.createRange()).setStart(e.offsetNode,e.offset),n.setEnd(e.offsetNode,e.offset)}catch{}}else{if(void 0===i.document.caretRangeFromPoint)return void console.warn("Neither caretPositionFromPoint nor caretRangeFromPoint is supported");n=i.document.caretRangeFromPoint(t.clientX,t.clientY)??void 0}if(n){try{o=h.wE.toSlateRange(e,n,{exactMatch:!1,suppressThrow:!1})}catch{}return o}}(t,n);return o?et({schema:e,editor:t,range:o}):null}({schema:e.getSnapshot().context.schema,slateEditor:t,event:n});if(i&&r&&!a&&!c.KE.isEditor(o))return{block:r,isEditor:!1,selection:{anchor:(0,f.u3)({context:e.getSnapshot().context,block:{node:i,path:[{_key:i._key}]}}),focus:(0,u.J8)({context:e.getSnapshot().context,block:{node:i,path:[{_key:i._key}]}})}};if(!r||!a)return;let l=(0,f.XE)(a.focus);if(void 0!==l)return(0,u.WV)(a)&&i&&l!==i._key?{block:r,isEditor:!1,selection:{anchor:(0,f.u3)({context:e.getSnapshot().context,block:{node:i,path:[{_key:i._key}]}}),focus:(0,u.J8)({context:e.getSnapshot().context,block:{node:i,path:[{_key:i._key}]}})}}:{block:r,isEditor:c.KE.isEditor(o),selection:a}}function eo(e,t){if(!e||!t)return null;let n=[],o=e.offset||0,i="object"==typeof e.path[0]&&"_key"in e.path[0]&&e.path[0]._key,r="object"==typeof e.path[2]&&"_key"in e.path[2]&&e.path[2]._key,a=t.find(e=>e._key===i);if(!a)return null;if(n.push({_key:a._key}),a&&"children"===e.path[1]){if(!a.children||Array.isArray(a.children)&&0===a.children.length)return null;let t=Array.isArray(a.children)&&a.children.find(e=>e._key===r);if(!t)return null;n.push("children"),n.push({_key:t._key}),o=t.text&&t.text.length>=e.offset?e.offset:t.text&&t.text.length||0}return{path:n,offset:o}}function ei(e){if(!e.context.selection)return null;if((0,u._Q)(e.context.selection.anchor,e.context.selection.focus)){let t=er(e,e.context.selection.anchor,e.context.selection.backward?"forward":"backward");return t?{anchor:t,focus:t}:null}let t=er(e,e.context.selection.anchor,e.context.selection.backward?"forward":"backward"),n=er(e,e.context.selection.focus,e.context.selection.backward?"backward":"forward");return t&&n?{anchor:t,focus:n}:null}function er(e,t,n){let o=(0,f.XE)(t);if(!o)return;let i=e.blockIndexMap.get(o);if(void 0===i)return;let r=e.context.value.at(i);if(!r)return;if(!(0,g.zS)(e.context,r))return{path:[i,0],offset:0};let a=(0,f.qX)({path:t.path}),l=a?void 0:(0,f.m4)({context:{schema:e.context.schema,value:[r]},blockOffset:{path:[{_key:o}],offset:t.offset},direction:n});if(!(a=l?(0,f.qX)(l):a))return{path:[i,0],offset:0};let s=l?.offset??t.offset,c=[],d=-1,p;for(let t of r.children)if(d++,t._key===a){p=t,(0,g.bl)(e.context,t)?c=[d]:(c=[d,0],s=0);break}return 0===c.length?{path:[i,0],offset:0}:{path:[i].concat(c),offset:(0,g.bl)(e.context,p)?Math.min(p.text.length,s):s}}let ea=(0,i.createContext)({});function el(){let e,t=(0,o.c)(1);return t[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,a.jsx)("div",{contentEditable:!1,className:"pt-drop-indicator",style:{position:"absolute",width:"100%",height:1,borderBottom:"1px solid currentColor",zIndex:5},children:(0,a.jsx)("span",{})}),t[0]=e):e=t[0],e}function es(e){let t,n,i=(0,o.c)(4);return i[0]===Symbol.for("react.memo_cache_sentinel")?(t={userSelect:"none"},i[0]=t):t=i[0],i[1]!==e.blockObject._key||i[2]!==e.blockObject._type?(n=(0,a.jsxs)("div",{style:t,children:["[",e.blockObject._type,": ",e.blockObject._key,"]"]}),i[1]=e.blockObject._key,i[2]=e.blockObject._type,i[3]=n):n=i[3],n}function ec(e){let t,n,i=(0,o.c)(4);return i[0]===Symbol.for("react.memo_cache_sentinel")?(t={userSelect:"none"},i[0]=t):t=i[0],i[1]!==e.inlineObject._key||i[2]!==e.inlineObject._type?(n=(0,a.jsxs)("span",{style:t,children:["[",e.inlineObject._type,": ",e.inlineObject._key,"]"]}),i[1]=e.inlineObject._key,i[2]=e.inlineObject._type,i[3]=n):n=i[3],n}function ed(e){return{id:(0,f.OL)(),name:e?.name,reference:e?.reference}}let ep=ed({name:"core"});function eh({eventSelection:e,snapshot:t}){let n=e;if((0,m.Rt)({...t,context:{...t.context,selection:e}}))return n;let o=(0,k.WV)({context:{...t.context,selection:e}}),i=(0,k.hH)({...t,context:{...t.context,selection:e}}),r=(0,k.d2)({...t,context:{...t.context,selection:e}});o&&i&&r&&(n={anchor:(0,f.u3)({context:t.context,block:i}),focus:(0,u.J8)({context:t.context,block:i})});let a=(0,m.wx)(t);if(t.context.selection&&(0,k.gR)(t)&&a.length>1){let o=(0,m.GB)(t),i=(0,m.P$)(t);if(!o||!i)return n;let r=(0,f.u3)({context:t.context,block:o}),a=(0,u.J8)({context:t.context,block:i});(0,m.Q)(e)({...t,context:{...t.context,selection:{anchor:r,focus:a}}})&&(n={anchor:r,focus:a})}return n}function eu(e){let t,n,r=(0,o.c)(5),{key:a,onSetDragPositionBlock:l}=e,s=(0,i.useContext)(ea);r[0]!==s||r[1]!==a||r[2]!==l?(t=()=>{let e=function({key:e,onSetDragPositionBlock:t}){return[{behavior:(0,v.Ke)({on:"drag.dragover",guard:({snapshot:t,event:n})=>{let o=(0,k.gU)({...t,context:{...t.context,selection:n.position.selection}});if(!o||o.node._key!==e)return!1;let i=n.dragOrigin;if(!i)return!1;let r=eh({eventSelection:i.selection,snapshot:t});return!(0,m.wx)({...t,context:{...t.context,selection:r}}).some(t=>t.node._key===e)&&(0,m.iE)({...t,context:{...t.context,selection:r}})},actions:[({event:e})=>[{type:"effect",effect:()=>{t(e.position.block)}}]]}),priority:ed({reference:{priority:ep,importance:"lower"}})},{behavior:(0,v.Ke)({on:"drag.*",guard:({event:e})=>"drag.dragover"!==e.type,actions:[({event:e})=>[{type:"effect",effect:()=>{t(void 0)}},(0,v.sY)(e)]]}),priority:ed({reference:{priority:ep,importance:"lower"}})}]}({key:a,onSetDragPositionBlock:l});for(let t of e)s.send({type:"add behavior",behaviorConfig:t});return()=>{for(let t of e)s.send({type:"remove behavior",behaviorConfig:t})}},n=[s,a,l],r[0]=s,r[1]=a,r[2]=l,r[3]=t,r[4]=n):(t=r[3],n=r[4]),(0,i.useEffect)(t,n)}function ef(e){let t,n,r,l,s,p,h,u,f,y=(0,o.c)(35),[g,m]=(0,i.useState)(),k=(0,i.useRef)(null),v=(0,d.f7)();y[0]!==v?(t=e=>v&&null!==e.selection&&c.Q6.isCollapsed(e.selection),y[0]=v,y[1]=t):t=y[1];let b=(0,d.s1)(t);if(y[2]!==e.element._key?(n={key:e.element._key,onSetDragPositionBlock:m},y[2]=e.element._key,y[3]=n):n=y[3],eu(n),y[4]!==e.element._type||y[5]!==e.legacySchema.blockObjects){let t;y[7]!==e.element._type?(t=t=>t.name===e.element._type,y[7]=e.element._type,y[8]=t):t=y[8],r=e.legacySchema.blockObjects.find(t),y[4]=e.element._type,y[5]=e.legacySchema.blockObjects,y[6]=r}else r=y[6];let x=r;x||console.error(`Unable to find Block Object "${e.element._type}" in Schema`),y[9]!==e.blockObject||y[10]!==e.element._key||y[11]!==e.element._type?(l=e.blockObject??{_key:e.element._key,_type:e.element._type},y[9]=e.blockObject,y[10]=e.element._key,y[11]=e.element._type,y[12]=l):l=y[12];let _=l;y[13]!==g?(s="start"===g?(0,a.jsx)(el,{}):null,y[13]=g,y[14]=s):s=y[14];let E=!e.readOnly;return y[15]!==_||y[16]!==b||y[17]!==x||y[18]!==e.element._key||y[19]!==e.renderBlock||y[20]!==v?(p=e.renderBlock&&x?(0,a.jsx)(ey,{renderBlock:e.renderBlock,editorElementRef:k,focused:b,path:[{_key:e.element._key}],schemaType:x,selected:v,type:x,value:_,children:(0,a.jsx)(es,{blockObject:_})}):(0,a.jsx)(es,{blockObject:_}),y[15]=_,y[16]=b,y[17]=x,y[18]=e.element._key,y[19]=e.renderBlock,y[20]=v,y[21]=p):p=y[21],y[22]!==E||y[23]!==p?(h=(0,a.jsx)("div",{ref:k,contentEditable:!1,draggable:E,children:p}),y[22]=E,y[23]=p,y[24]=h):h=y[24],y[25]!==g?(u="end"===g?(0,a.jsx)(el,{}):null,y[25]=g,y[26]=u):u=y[26],y[27]!==e.attributes||y[28]!==e.children||y[29]!==e.element._key||y[30]!==e.element._type||y[31]!==s||y[32]!==h||y[33]!==u?(f=(0,a.jsxs)("div",{...e.attributes,className:"pt-block pt-object-block","data-block-key":e.element._key,"data-block-name":e.element._type,"data-block-type":"object",children:[s,e.children,h,u]}),y[27]=e.attributes,y[28]=e.children,y[29]=e.element._key,y[30]=e.element._type,y[31]=s,y[32]=h,y[33]=u,y[34]=f):f=y[34],f}function ey({renderBlock:e,children:t,editorElementRef:n,focused:o,path:i,schemaType:r,selected:a,type:l,value:s}){return e({children:t,editorElementRef:n,focused:o,path:i,schemaType:r,selected:a,type:l,value:s})}function eg(e){let t,n,r,l,s,p,u,f,y=(0,o.c)(32),g=(0,i.useRef)(null),m=(0,d.RV)(),k=(0,d.f7)();y[0]!==k?(t=e=>k&&null!==e.selection&&c.Q6.isCollapsed(e.selection),y[0]=k,y[1]=t):t=y[1];let v=(0,d.s1)(t);if(y[2]!==e.element._type||y[3]!==e.legacySchema.inlineObjects){let t;y[5]!==e.element._type?(t=t=>t.name===e.element._type,y[5]=e.element._type,y[6]=t):t=y[6],n=e.legacySchema.inlineObjects.find(t),y[2]=e.element._type,y[3]=e.legacySchema.inlineObjects,y[4]=n}else n=y[4];let b=n;if(b||console.error(`Unable to find Inline Object "${e.element._type}" in Schema`),y[7]!==e.element||y[8]!==m){let t=h.wE.findPath(m,e.element);r=Y({editor:m,point:{path:t,offset:0}}),y[7]=e.element,y[8]=m,y[9]=r}else r=y[9];let[x]=r;x||console.error(`Unable to find parent block of inline object ${e.element._key}`),y[10]!==e.element?(l="value"in e.element&&"object"==typeof e.element.value?e.element.value:{},y[10]=e.element,y[11]=l):l=y[11],y[12]!==e.element._key||y[13]!==e.element._type||y[14]!==l?(s={_key:e.element._key,_type:e.element._type,...l},y[12]=e.element._key,y[13]=e.element._type,y[14]=l,y[15]=s):s=y[15];let _=s,E=!e.readOnly;return y[16]===Symbol.for("react.memo_cache_sentinel")?(p={display:"inline-block"},y[16]=p):p=y[16],y[17]!==x||y[18]!==v||y[19]!==_||y[20]!==b||y[21]!==e.element._key||y[22]!==e.renderChild||y[23]!==k?(u=(0,a.jsx)("span",{ref:g,style:p,children:e.renderChild&&x&&b?(0,a.jsx)(em,{renderChild:e.renderChild,annotations:[],editorElementRef:g,selected:k,focused:v,path:[{_key:x._key},"children",{_key:e.element._key}],schemaType:b,value:_,type:b,children:(0,a.jsx)(ec,{inlineObject:_})}):(0,a.jsx)(ec,{inlineObject:_})}),y[17]=x,y[18]=v,y[19]=_,y[20]=b,y[21]=e.element._key,y[22]=e.renderChild,y[23]=k,y[24]=u):u=y[24],y[25]!==_._key||y[26]!==_._type||y[27]!==e.attributes||y[28]!==e.children||y[29]!==E||y[30]!==u?(f=(0,a.jsxs)("span",{...e.attributes,draggable:E,className:"pt-inline-object","data-child-key":_._key,"data-child-name":_._type,"data-child-type":"object",children:[e.children,u]}),y[25]=_._key,y[26]=_._type,y[27]=e.attributes,y[28]=e.children,y[29]=E,y[30]=u,y[31]=f):f=y[31],f}function em({renderChild:e,annotations:t,children:n,editorElementRef:o,focused:i,path:r,schemaType:a,selected:l,value:s,type:c}){return e({annotations:t,children:n,editorElementRef:o,focused:i,path:r,schemaType:a,selected:l,value:s,type:c})}function ek(e){let t,n,r,l,s,p,h,u,f,y,g,m,k,v,b,x=(0,o.c)(77),[_,E]=(0,i.useState)(),w=(0,i.useRef)(null),S=(0,d.f7)();x[0]!==S?(t=e=>S&&null!==e.selection&&c.Q6.isCollapsed(e.selection),x[0]=S,x[1]=t):t=x[1];let B=(0,d.s1)(t);x[2]!==e.element._key?(n={key:e.element._key,onSetDragPositionBlock:E},x[2]=e.element._key,x[3]=n):n=x[3],eu(n),x[4]!==e.textBlock._key?(r=t=>t.listIndexMap.get(e.textBlock._key),x[4]=e.textBlock._key,x[5]=r):r=x[5];let K=(0,d.s1)(r),T=e.children;if(e.renderStyle&&e.textBlock.style){let t;x[6]!==e.legacySchema||x[7]!==e.textBlock.style?(t=void 0!==e.textBlock.style?e.legacySchema.styles.find(t=>t.value===e.textBlock.style):void 0,x[6]=e.legacySchema,x[7]=e.textBlock.style,x[8]=t):t=x[8];let n=t;if(n){let t,o;x[9]!==e.textBlock._key?(t=[{_key:e.textBlock._key}],x[9]=e.textBlock._key,x[10]=t):t=x[10],x[11]!==T||x[12]!==B||x[13]!==n||x[14]!==e.renderStyle||x[15]!==e.textBlock||x[16]!==S||x[17]!==t?(o=(0,a.jsx)(ex,{renderStyle:e.renderStyle,block:e.textBlock,editorElementRef:w,focused:B,path:t,schemaType:n,selected:S,value:e.textBlock.style,children:T}),x[11]=T,x[12]=B,x[13]=n,x[14]=e.renderStyle,x[15]=e.textBlock,x[16]=S,x[17]=t,x[18]=o):o=x[18],T=o}else console.error(`Unable to find Schema type for text block style ${e.textBlock.style}`)}if(e.renderListItem&&e.textBlock.listItem){let t;if(x[19]!==e.legacySchema.lists||x[20]!==e.textBlock.listItem){let n;x[22]!==e.textBlock.listItem?(n=t=>t.value===e.textBlock.listItem,x[22]=e.textBlock.listItem,x[23]=n):n=x[23],t=e.legacySchema.lists.find(n),x[19]=e.legacySchema.lists,x[20]=e.textBlock.listItem,x[21]=t}else t=x[21];let n=t;if(n){let t,o,i=e.textBlock.level??1;x[24]!==e.textBlock._key?(t=[{_key:e.textBlock._key}],x[24]=e.textBlock._key,x[25]=t):t=x[25],x[26]!==T||x[27]!==B||x[28]!==n||x[29]!==e.renderListItem||x[30]!==e.textBlock||x[31]!==S||x[32]!==i||x[33]!==t?(o=(0,a.jsx)(eb,{renderListItem:e.renderListItem,block:e.textBlock,editorElementRef:w,focused:B,level:i,path:t,selected:S,value:e.textBlock.listItem,schemaType:n,children:T}),x[26]=T,x[27]=B,x[28]=n,x[29]=e.renderListItem,x[30]=e.textBlock,x[31]=S,x[32]=i,x[33]=t,x[34]=o):o=x[34],T=o}else console.error(`Unable to find Schema type for text block list item ${e.textBlock.listItem}`)}let A=e.attributes;x[35]!==e.textBlock.style?(l=e.textBlock.style?[`pt-text-block-style-${e.textBlock.style}`]:[],x[35]=e.textBlock.style,x[36]=l):l=x[36],x[37]!==e.textBlock.level||x[38]!==e.textBlock.listItem?(s=e.textBlock.listItem?["pt-list-item",`pt-list-item-${e.textBlock.listItem}`,`pt-list-item-level-${e.textBlock.level??1}`]:[],x[37]=e.textBlock.level,x[38]=e.textBlock.listItem,x[39]=s):s=x[39],x[40]!==l||x[41]!==s?(p=["pt-block","pt-text-block",...l,...s],x[40]=l,x[41]=s,x[42]=p):p=x[42];let O=p.join(" ");return x[43]!==e.textBlock.listItem?(h=void 0!==e.textBlock.listItem?{"data-list-item":e.textBlock.listItem}:{},x[43]=e.textBlock.listItem,x[44]=h):h=x[44],x[45]!==e.textBlock.level?(u=void 0!==e.textBlock.level?{"data-level":e.textBlock.level}:{},x[45]=e.textBlock.level,x[46]=u):u=x[46],x[47]!==e.textBlock.style?(f=void 0!==e.textBlock.style?{"data-style":e.textBlock.style}:{},x[47]=e.textBlock.style,x[48]=f):f=x[48],x[49]!==K?(y=void 0!==K?{"data-list-index":K}:{},x[49]=K,x[50]=y):y=x[50],x[51]!==_?(g="start"===_?(0,a.jsx)(el,{}):null,x[51]=_,x[52]=g):g=x[52],x[53]!==T||x[54]!==B||x[55]!==e.legacySchema||x[56]!==e.renderBlock||x[57]!==e.textBlock||x[58]!==S?(m=e.renderBlock?(0,a.jsx)(ev,{renderBlock:e.renderBlock,editorElementRef:w,focused:B,level:e.textBlock.level,listItem:e.textBlock.listItem,path:[{_key:e.textBlock._key}],selected:S,schemaType:e.legacySchema.block,style:e.textBlock.style,type:e.legacySchema.block,value:e.textBlock,children:T}):T,x[53]=T,x[54]=B,x[55]=e.legacySchema,x[56]=e.renderBlock,x[57]=e.textBlock,x[58]=S,x[59]=m):m=x[59],x[60]!==m?(k=(0,a.jsx)("div",{ref:w,children:m}),x[60]=m,x[61]=k):k=x[61],x[62]!==_?(v="end"===_?(0,a.jsx)(el,{}):null,x[62]=_,x[63]=v):v=x[63],x[64]!==e.attributes||x[65]!==e.spellCheck||x[66]!==e.textBlock._key||x[67]!==e.textBlock._type||x[68]!==f||x[69]!==y||x[70]!==g||x[71]!==k||x[72]!==v||x[73]!==O||x[74]!==h||x[75]!==u?(b=(0,a.jsxs)("div",{...A,className:O,spellCheck:e.spellCheck,"data-block-key":e.textBlock._key,"data-block-name":e.textBlock._type,"data-block-type":"text",...h,...u,...f,...y,children:[g,k,v]}),x[64]=e.attributes,x[65]=e.spellCheck,x[66]=e.textBlock._key,x[67]=e.textBlock._type,x[68]=f,x[69]=y,x[70]=g,x[71]=k,x[72]=v,x[73]=O,x[74]=h,x[75]=u,x[76]=b):b=x[76],b}function ev({renderBlock:e,children:t,editorElementRef:n,focused:o,level:i,listItem:r,path:a,selected:l,style:s,schemaType:c,type:d,value:p}){return e({children:t,editorElementRef:n,focused:o,level:i,listItem:r,path:a,selected:l,style:s,schemaType:c,type:d,value:p})}function eb({renderListItem:e,block:t,children:n,editorElementRef:o,focused:i,level:r,path:a,schemaType:l,selected:s,value:c}){return e({block:t,children:n,editorElementRef:o,focused:i,level:r,path:a,schemaType:l,selected:s,value:c})}function ex({renderStyle:e,block:t,children:n,editorElementRef:o,focused:i,path:r,schemaType:a,selected:l,value:s}){return e({block:t,children:n,editorElementRef:o,focused:i,path:r,schemaType:a,selected:l,value:s})}function e_(e){let t,n,r,s=(0,o.c)(34),c=(0,i.useContext)(ea),p=(0,l.d4)(c,ew),h=(0,l.d4)(c,eE),u=(0,d.RV)();if("__inline"in e.element&&!0===e.element.__inline){let t;return s[0]!==h||s[1]!==e.attributes||s[2]!==e.children||s[3]!==e.element||s[4]!==e.readOnly||s[5]!==e.renderChild||s[6]!==p?(t=(0,a.jsx)(eg,{attributes:e.attributes,element:e.element,legacySchema:h,readOnly:e.readOnly,renderChild:e.renderChild,schema:p,children:e.children}),s[0]=h,s[1]=e.attributes,s[2]=e.children,s[3]=e.element,s[4]=e.readOnly,s[5]=e.renderChild,s[6]=p,s[7]=t):t=s[7],t}if(s[8]!==e.element._key||s[9]!==p||s[10]!==u.blockIndexMap||s[11]!==u.value){let o=u.blockIndexMap.get(e.element._key);t=void 0!==o?u.value.at(o):void 0,n=(0,g.zS)({schema:p},t),s[8]=e.element._key,s[9]=p,s[10]=u.blockIndexMap,s[11]=u.value,s[12]=t,s[13]=n}else t=s[12],n=s[13];if(n){let n;return s[14]!==t||s[15]!==h||s[16]!==e.attributes||s[17]!==e.children||s[18]!==e.element||s[19]!==e.readOnly||s[20]!==e.renderBlock||s[21]!==e.renderListItem||s[22]!==e.renderStyle||s[23]!==e.spellCheck?(n=(0,a.jsx)(ek,{attributes:e.attributes,element:e.element,legacySchema:h,readOnly:e.readOnly,renderBlock:e.renderBlock,renderListItem:e.renderListItem,renderStyle:e.renderStyle,spellCheck:e.spellCheck,textBlock:t,children:e.children}),s[14]=t,s[15]=h,s[16]=e.attributes,s[17]=e.children,s[18]=e.element,s[19]=e.readOnly,s[20]=e.renderBlock,s[21]=e.renderListItem,s[22]=e.renderStyle,s[23]=e.spellCheck,s[24]=n):n=s[24],n}return s[25]!==t||s[26]!==h||s[27]!==e.attributes||s[28]!==e.children||s[29]!==e.element||s[30]!==e.readOnly||s[31]!==e.renderBlock||s[32]!==p?(r=(0,a.jsx)(ef,{attributes:e.attributes,blockObject:t,element:e.element,legacySchema:h,readOnly:e.readOnly,renderBlock:e.renderBlock,schema:p,children:e.children}),s[25]=t,s[26]=h,s[27]=e.attributes,s[28]=e.children,s[29]=e.element,s[30]=e.readOnly,s[31]=e.renderBlock,s[32]=p,s[33]=r):r=s[33],r}function eE(e){return e.context.getLegacySchema()}function ew(e){return e.context.schema}function eS({editorActorSnapshot:e,slateEditorInstance:t}){let n=t.selection?et({schema:e.context.schema,editor:t,range:t.selection}):null;return{blockIndexMap:t.blockIndexMap,context:{converters:[...e.context.converters],keyGenerator:e.context.keyGenerator,readOnly:e.matches({"edit mode":"read only"}),schema:e.context.schema,selection:n,value:t.value},decoratorState:t.decoratorState}}function eB(e){let t,n,r,s,c,p,h=(0,o.c)(40),u=(0,d.RV)(),f=(0,i.useContext)(ea),y=(0,l.d4)(f,eT),v=(0,i.useRef)(null);h[0]!==e.leaf._key||h[1]!==u?(t=t=>{let n=eS({editorActorSnapshot:t,slateEditorInstance:u});if(!n.context.selection||!(0,k.WV)(n))return!1;let o=(0,k.d2)(n);return!!o&&o.node._key===e.leaf._key},h[0]=e.leaf._key,h[1]=u,h[2]=t):t=h[2];let x=(0,l.d4)(f,t);h[3]!==e.children.props.parent||h[4]!==e.leaf._key||h[5]!==e.leaf.text||h[6]!==u?(n=t=>{let n=eS({editorActorSnapshot:t,slateEditorInstance:u});if(!n.context.selection)return!1;let o=e.children.props.parent,i=o&&(0,g.zS)(n.context,o)?o:void 0,r=i?{anchor:{path:[{_key:i._key},"children",{_key:e.leaf._key}],offset:0},focus:{path:[{_key:i._key},"children",{_key:e.leaf._key}],offset:e.leaf.text.length}}:null;return(0,m.Q)(r)(n)},h[3]=e.children.props.parent,h[4]=e.leaf._key,h[5]=e.leaf.text,h[6]=u,h[7]=n):n=h[7];let _=(0,l.d4)(f,n),E=e.children.props.parent,w=E&&u.isTextBlock(E)?E:void 0;h[8]!==w||h[9]!==e.leaf._key?(r=w?[{_key:w._key},"children",{_key:e.leaf._key}]:void 0,h[8]=w,h[9]=e.leaf._key,h[10]=r):r=h[10];let S=r;if(h[11]!==w||h[12]!==f||h[13]!==x||h[14]!==y||h[15]!==S||h[16]!==e.children||h[17]!==e.leaf.marks||h[18]!==e.renderAnnotation||h[19]!==e.renderDecorator||h[20]!==_){let t=f.getSnapshot().context.schema.decorators.map(eK),n=b((e.leaf.marks??[]).filter(e=>t.includes(e)));for(let o of(s=(e.leaf.marks??[]).flatMap(e=>{if(t.includes(e))return[];let n=w?.markDefs?.find(t=>t._key===e);return n?[n]:[]}),c=e.children,n)){let t=y.decorators.find(e=>e.value===o);S&&t&&e.renderDecorator&&(c=(0,a.jsx)(eO,{renderDecorator:e.renderDecorator,editorElementRef:v,focused:x,path:S,selected:_,schemaType:t,value:o,type:t,children:c}))}for(let t of s){let n=y.annotations.find(e=>e.name===t._type);n&&(c=w&&S&&e.renderAnnotation?(0,a.jsx)("span",{ref:v,children:(0,a.jsx)(eA,{renderAnnotation:e.renderAnnotation,block:w,editorElementRef:v,focused:x,path:S,selected:_,schemaType:n,value:t,type:n,children:c})}):(0,a.jsx)("span",{ref:v,children:c}))}h[11]=w,h[12]=f,h[13]=x,h[14]=y,h[15]=S,h[16]=e.children,h[17]=e.leaf.marks,h[18]=e.renderAnnotation,h[19]=e.renderDecorator,h[20]=_,h[21]=s,h[22]=c}else s=h[21],c=h[22];if(w&&S&&e.renderChild){let t;if(h[23]!==w.children||h[24]!==e.leaf){let n;h[26]!==e.leaf?(n=t=>t._key===e.leaf._key,h[26]=e.leaf,h[27]=n):n=h[27],t=w.children.find(n),h[23]=w.children,h[24]=e.leaf,h[25]=t}else t=h[25];let n=t;if(n){let t;h[28]!==s||h[29]!==n||h[30]!==c||h[31]!==x||h[32]!==y.span||h[33]!==S||h[34]!==e.renderChild||h[35]!==_?(t=(0,a.jsx)(eD,{renderChild:e.renderChild,annotations:s,editorElementRef:v,focused:x,path:S,schemaType:y.span,selected:_,value:n,type:y.span,children:c}),h[28]=s,h[29]=n,h[30]=c,h[31]=x,h[32]=y.span,h[33]=S,h[34]=e.renderChild,h[35]=_,h[36]=t):t=h[36],c=t}}return h[37]!==c||h[38]!==e.attributes?(p=(0,a.jsx)("span",{...e.attributes,ref:v,children:c}),h[37]=c,h[38]=e.attributes,h[39]=p):p=h[39],p}function eK(e){return e.name}function eT(e){return e.context.getLegacySchema()}function eA({renderAnnotation:e,block:t,children:n,editorElementRef:o,focused:i,path:r,schemaType:a,selected:l,value:s,type:c}){return e({block:t,children:n,editorElementRef:o,focused:i,path:r,schemaType:a,selected:l,value:s,type:c})}function eO({renderDecorator:e,children:t,editorElementRef:n,focused:o,path:i,schemaType:r,selected:a,value:l,type:s}){return e({children:t,editorElementRef:n,focused:o,path:i,schemaType:r,selected:a,value:l,type:s})}function eD({renderChild:e,annotations:t,children:n,editorElementRef:o,focused:i,path:r,schemaType:a,selected:l,value:s,type:c}){return e({annotations:t,children:n,editorElementRef:o,focused:i,path:r,schemaType:a,selected:l,value:s,type:c})}let eN={position:"absolute",userSelect:"none",pointerEvents:"none",left:0,right:0};function eI(e){let t,n=(0,o.c)(12),r=(0,i.useContext)(ea),s=(0,l.d4)(r,eM);if(e.leaf._type!==s.span.name)return e.children;n[0]!==e?(t=(0,a.jsx)(eB,{...e}),n[0]=e,n[1]=t):t=n[1];let c=t;if(e.renderPlaceholder&&e.leaf.placeholder&&""===e.text.text){let t,o,i;return n[2]!==e.renderPlaceholder?(t=e.renderPlaceholder(),n[2]=e.renderPlaceholder,n[3]=t):t=n[3],n[4]!==t?(o=(0,a.jsx)("span",{style:eN,contentEditable:!1,children:t}),n[4]=t,n[5]=o):o=n[5],n[6]!==c||n[7]!==o?(i=(0,a.jsxs)(a.Fragment,{children:[o,c]}),n[6]=c,n[7]=o,n[8]=i):i=n[8],i}let d=e.leaf.rangeDecoration;if(d){let e;n[9]!==d||n[10]!==c?(e=d.component({children:c}),n[9]=d,n[10]=c,n[11]=e):e=n[11],c=e}return c}function eM(e){return e.context.schema}function ej(e){let t,n=(0,o.c)(5);return n[0]!==e.attributes||n[1]!==e.children||n[2]!==e.text._key||n[3]!==e.text._type?(t=(0,a.jsx)("span",{...e.attributes,"data-child-key":e.text._key,"data-child-name":e.text._type,"data-child-type":"span",children:e.children}),n[0]=e.attributes,n[1]=e.children,n[2]=e.text._key,n[3]=e.text._type,n[4]=t):t=n[4],t}let eC=(0,i.createContext)(null),eP=()=>{let e=(0,i.useContext)(eC);if(!e)throw Error("The `usePortableTextEditor` hook must be used inside the <PortableTextEditor> component's context.");return e},ez="u">typeof window&&/Mac|iPod|iPhone|iPad/.test(window.navigator.userAgent),eR={alt:"altKey",control:"ctrlKey",meta:"metaKey",shift:"shiftKey"},e$={add:"+",break:"pause",cmd:"meta",command:"meta",ctl:"control",ctrl:"control",del:"delete",down:"arrowdown",esc:"escape",ins:"insert",left:"arrowleft",mod:ez?"meta":"control",opt:"alt",option:"alt",return:"enter",right:"arrowright",space:" ",spacebar:" ",up:"arrowup",win:"meta",windows:"meta"},eL={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,escape:27," ":32,pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,insert:45,delete:46,meta:91,numlock:144,scrolllock:145,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,f13:124,f14:125,f15:126,f16:127,f17:128,f18:129,f19:130,f20:131};function eV(e){let t={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1},n=e.replace("++","+add").split("+");for(let e of n){let o=e.endsWith("?")&&e.length>1,i=o?e.slice(0,-1):e,r=eU(i),a=eR[r],l=e$[i],s=eL[r];if(i.length>1&&void 0===a&&void 0===l&&void 0===s)throw TypeError(`Unknown modifier: "${i}"`);(1===n.length||void 0===a)&&(t.key=r,t.keyCode=function(e){let t=eU(e);return eL[t]??t.toUpperCase().charCodeAt(0)}(i)),void 0!==a&&(t[a]=!o||null)}return t}function eG(e,t){return(null==e.altKey||e.altKey===t.altKey)&&(null==e.ctrlKey||e.ctrlKey===t.ctrlKey)&&(null==e.metaKey||e.metaKey===t.metaKey)&&(null==e.shiftKey||e.shiftKey===t.shiftKey)&&(void 0!==e.keyCode&&void 0!==t.keyCode?91===e.keyCode&&93===t.keyCode||e.keyCode===t.keyCode:e.keyCode===t.keyCode||e.key===t.key.toLowerCase())}function eU(e){let t=e.toLowerCase();return e$[t]??t}let eF=G("plugin:withHotKeys"),eH=(0,x.mj)({types:{context:{},input:{},events:{}},actions:{"update pending range decorations":(0,_.a)({pendingRangeDecorations:({context:e,event:t})=>"range decorations updated"!==t.type?e.pendingRangeDecorations:t.rangeDecorations}),"set up initial range decorations":({context:e})=>{let t=[];for(let n of e.pendingRangeDecorations){let o=ei({context:{schema:e.schema,value:e.slateEditor.value,selection:n.selection},blockIndexMap:e.slateEditor.blockIndexMap});if(!c.Q6.isRange(o)){n.onMoved?.({newSelection:null,rangeDecoration:n,origin:"local"});continue}t.push({rangeDecoration:n,...o})}e.slateEditor.decoratedRanges=t},"update range decorations":({context:e,event:t})=>{if("range decorations updated"!==t.type)return;let n=[];for(let o of t.rangeDecorations){let t=ei({context:{schema:e.schema,value:e.slateEditor.value,selection:o.selection},blockIndexMap:e.slateEditor.blockIndexMap});if(!c.Q6.isRange(t)){o.onMoved?.({newSelection:null,rangeDecoration:o,origin:"local"});continue}n.push({rangeDecoration:o,...t})}e.slateEditor.decoratedRanges=n},"move range decorations":({context:e,event:t})=>{if("slate operation"!==t.type)return;let n=[];for(let o of e.slateEditor.decoratedRanges){let i,r=ei({context:{schema:e.schema,value:e.slateEditor.value,selection:o.rangeDecoration.selection},blockIndexMap:e.slateEditor.blockIndexMap});if(!c.Q6.isRange(r)){o.rangeDecoration.onMoved?.({newSelection:null,rangeDecoration:o.rangeDecoration,origin:"local"});continue}if((i=function(e,t){let n=c.bR.transform(e.anchor,t),o=c.bR.transform(e.focus,t);return null===n||null===o?null:c.bR.equals(n,e.anchor)&&c.bR.equals(o,e.focus)?e:{anchor:n,focus:o}}(r,t.operation))&&i!==r||null===i&&r){let t=i?et({schema:e.schema,editor:e.slateEditor,range:i}):null;o.rangeDecoration.onMoved?.({newSelection:t,rangeDecoration:o.rangeDecoration,origin:"local"})}null!==i&&n.push({...i||r,rangeDecoration:{...o.rangeDecoration,selection:et({schema:e.schema,editor:e.slateEditor,range:i})}})}e.slateEditor.decoratedRanges=n},"assign readOnly":(0,_.a)({readOnly:({context:e,event:t})=>"update read only"!==t.type?e.readOnly:t.readOnly}),"update decorate":(0,_.a)({decorate:({context:e})=>({fn:eQ(e.schema,e.slateEditor)})})},actors:{"slate operation listener":(0,E.SP)(({input:e,sendBack:t})=>{let n=e.slateEditor.apply;return e.slateEditor.apply=e=>{"set_selection"!==e.type&&t({type:"slate operation",operation:e}),n(e)},()=>{e.slateEditor.apply=n}})},guards:{"has pending range decorations":({context:e})=>e.pendingRangeDecorations.length>0,"has range decorations":({context:e})=>e.slateEditor.decoratedRanges.length>0,"has different decorations":({context:e,event:t})=>"range decorations updated"===t.type&&!y(e.slateEditor.decoratedRanges.map(e=>({anchor:e.rangeDecoration.selection?.anchor,focus:e.rangeDecoration.selection?.focus,payload:e.rangeDecoration.payload})),t.rangeDecorations.map(e=>({anchor:e.selection?.anchor,focus:e.selection?.focus,payload:e.payload}))),"not read only":({context:e})=>!e.readOnly,"should skip setup":({context:e})=>e.skipSetup}}).createMachine({id:"range decorations",context:({input:e})=>({readOnly:e.readOnly,pendingRangeDecorations:e.rangeDecorations,decoratedRanges:[],skipSetup:e.skipSetup,schema:e.schema,slateEditor:e.slateEditor,decorate:{fn:eQ(e.schema,e.slateEditor)}}),invoke:{src:"slate operation listener",input:({context:e})=>({slateEditor:e.slateEditor})},on:{"update read only":{actions:["assign readOnly"]}},initial:"setting up",states:{"setting up":{always:[{guard:(0,w.d)(["should skip setup","has pending range decorations"]),target:"ready",actions:["set up initial range decorations","update decorate"]},{guard:"should skip setup",target:"ready"}],on:{"range decorations updated":{actions:["update pending range decorations"]},ready:[{target:"ready",guard:"has pending range decorations",actions:["set up initial range decorations","update decorate"]},{target:"ready"}]}},ready:{initial:"idle",on:{"range decorations updated":{target:".idle",guard:"has different decorations",actions:["update range decorations","update decorate"]}},states:{idle:{on:{"slate operation":{target:"moving range decorations",guard:(0,w.d)(["has range decorations","not read only"])}}},"moving range decorations":{entry:["move range decorations"],always:{target:"idle"}}}}}});function eQ(e,t){return function([n,o]){if(W(t.children,e))return[{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0},placeholder:!0}];if(0===o.length||!c.Hg.isElement(n)||0===n.children.length)return[];let i=o.at(0);return void 0===i?[]:t.decoratedRanges.filter(e=>c.Q6.isCollapsed(e)?n.children.some((t,n)=>c.wA.equals(e.anchor.path,[i,n])&&c.wA.equals(e.focus.path,[i,n])):c.Q6.intersection(e,{anchor:{path:o,offset:0},focus:{path:o,offset:0}})||c.Q6.includes(e,o))}}let eW=(0,i.createContext)({}),eJ=G("validate selection machine"),eY=(0,x.mj)({types:{context:{},input:{},events:{}},guards:{"pending operations":({context:e})=>e.slateEditor.operations.length>0}}),eq=eY.createAction(({context:e,event:t})=>{!function(e,t){let n;if(!e.selection)return;try{n=d.rL.findDocumentOrShadowRoot(e)}catch{}if(!n||t!==n.activeElement)return;let o=d.rL.getWindow(e).getSelection();if(!o||0===o.rangeCount)return;let i=o.getRangeAt(0);try{let t=d.rL.toDOMRange(e,e.selection);(t.startOffset!==i.startOffset||t.endOffset!==i.endOffset)&&(eJ("DOM range out of sync, validating selection"),o?.removeAllRanges(),o.addRange(t))}catch{eJ("Could not resolve selection, selecting top document"),c.gB.deselect(e),e.children.length>0&&c.gB.select(e,c.KE.start(e,[])),e.onChange()}}(e.slateEditor,t.editorElement)}),eZ=eY.createMachine({id:"validate selection",context:({input:e})=>({slateEditor:e.slateEditor}),initial:"idle",states:{idle:{on:{"validate selection":[{guard:"pending operations",target:"waiting"},{actions:[eq],target:"idle"}]}},waiting:{after:{0:[{guard:"pending operations",target:".",reenter:!0},{target:"idle",actions:[eq]}]},on:{"validate selection":{target:".",reenter:!0}}}}}),eX=new WeakMap,e0=new WeakMap,e1=new WeakMap,e2=new WeakMap,e3=G("component:Editable"),e4=(0,i.forwardRef)(function(e,t){let n,r,p,h,u,g,m,k,v,b,x,_,E,w,S,B,K,T,A,O,D,N,I,M,j,C,P,z,R,$,L,V,G,U,F,H,J,Y,q,Z,X,ee,er,el,es,ec,ed,ep,eh,eu,ef,ey,eg,em,ek,ev,eb,ex,eE,ew,eS,eB,eK,eT=(0,o.c)(174);eT[0]!==e?({hotkeys:n,onBlur:p,onFocus:w,onBeforeInput:r,onPaste:S,onCopy:u,onCut:g,onClick:h,onDragStart:_,onDrag:m,onDragEnd:k,onDragEnter:v,onDragOver:x,onDrop:E,onDragLeave:b,rangeDecorations:K,renderAnnotation:T,renderBlock:A,renderChild:O,renderDecorator:D,renderListItem:N,renderPlaceholder:I,renderStyle:M,selection:B,scrollSelectionIntoView:C,spellCheck:P,...j}=e,eT[0]=e,eT[1]=n,eT[2]=r,eT[3]=p,eT[4]=h,eT[5]=u,eT[6]=g,eT[7]=m,eT[8]=k,eT[9]=v,eT[10]=b,eT[11]=x,eT[12]=_,eT[13]=E,eT[14]=w,eT[15]=S,eT[16]=B,eT[17]=K,eT[18]=T,eT[19]=A,eT[20]=O,eT[21]=D,eT[22]=N,eT[23]=I,eT[24]=M,eT[25]=j,eT[26]=C,eT[27]=P):(n=eT[1],r=eT[2],p=eT[3],h=eT[4],u=eT[5],g=eT[6],m=eT[7],k=eT[8],v=eT[9],b=eT[10],x=eT[11],_=eT[12],E=eT[13],w=eT[14],S=eT[15],B=eT[16],K=eT[17],T=eT[18],A=eT[19],O=eT[20],D=eT[21],N=eT[22],I=eT[23],M=eT[24],j=eT[25],C=eT[26],P=eT[27]);let eA=eP(),[eO,eD]=(0,i.useState)(!1),eN=(0,i.useContext)(ea),eM=(0,i.useContext)(eW),ej=(0,l.d4)(eN,e6),eC=(0,d.Zi)();eT[28]!==eC?(z={input:{slateEditor:eC}},eT[28]=eC,eT[29]=z):z=eT[29];let ez=(0,l.qf)(eZ,z);eT[30]!==K?(R=K??[],eT[30]=K,eT[31]=R):R=eT[31],eT[32]!==eN?($=eN.getSnapshot(),eT[32]=eN,eT[33]=$):$=eT[33];let eR=!eN.getSnapshot().matches({setup:"setting up"});eT[34]!==ej||eT[35]!==eC||eT[36]!==R||eT[37]!==$.context.schema||eT[38]!==eR?(L={input:{rangeDecorations:R,readOnly:ej,schema:$.context.schema,slateEditor:eC,skipSetup:eR}},eT[34]=ej,eT[35]=eC,eT[36]=R,eT[37]=$.context.schema,eT[38]=eR,eT[39]=L):L=eT[39];let e$=(0,l.qf)(eH,L),eL=(0,l.d4)(e$,e8);eT[40]!==e$||eT[41]!==ej?(V=()=>{e$.send({type:"update read only",readOnly:ej})},G=[e$,ej],eT[40]=e$,eT[41]=ej,eT[42]=V,eT[43]=G):(V=eT[42],G=eT[43]),(0,i.useEffect)(V,G),eT[44]!==K||eT[45]!==e$?(U=()=>{e$.send({type:"range decorations updated",rangeDecorations:K??[]})},F=[e$,K],eT[44]=K,eT[45]=e$,eT[46]=U,eT[47]=F):(U=eT[46],F=eT[47]),(0,i.useEffect)(U,F),ej||(function(e,t,n){let o=["enter","tab","shift","delete","end"],i=n??{};return function(n){return n.pteWithHotKeys=r=>{Object.keys(i).forEach(a=>{var l,s;if("marks"===a)for(let t in i[a]){if(o.includes(t))throw Error(`The hotkey ${t} is reserved!`);if(l=r.nativeEvent,eG(eV(t),l)){r.preventDefault();let o=i[a];if(o){let i=o[t];eF(`HotKey ${t} to toggle ${i}`),e.send({type:"behavior event",behaviorEvent:{type:"decorator.toggle",decorator:i},editor:n})}}}if("custom"===a)for(let e in i[a]){if(o.includes(e))throw Error(`The hotkey ${e} is reserved!`);if(s=r.nativeEvent,eG(eV(e),s)){let n=i[a];n&&(0,n[e])(r,t)}}})},n}})(eN,eA,n)(eC),eT[48]!==ej||eT[49]!==A||eT[50]!==O||eT[51]!==N||eT[52]!==M||eT[53]!==P?(H=e=>(0,a.jsx)(e_,{...e,readOnly:ej,renderBlock:A,renderChild:O,renderListItem:N,renderStyle:M,spellCheck:P}),eT[48]=ej,eT[49]=A,eT[50]=O,eT[51]=N,eT[52]=M,eT[53]=P,eT[54]=H):H=eT[54];let eU=H;eT[55]!==ej||eT[56]!==T||eT[57]!==O||eT[58]!==D||eT[59]!==I?(J=e=>(0,a.jsx)(eI,{...e,readOnly:ej,renderAnnotation:T,renderChild:O,renderDecorator:D,renderPlaceholder:I}),eT[55]=ej,eT[56]=T,eT[57]=O,eT[58]=D,eT[59]=I,eT[60]=J):J=eT[60];let eQ=J;eT[61]!==eN||eT[62]!==B||eT[63]!==eC?(Y=()=>{if(B){e3(`Selection from props ${JSON.stringify(B)}`);let e=function(e,t){if(!e||!t||0===t.length)return null;let n=null,o=null,{anchor:i,focus:r}=e;return i&&t.find(e=>y({_key:e._key},i.path[0]))&&(n=eo(i,t)),r&&t.find(e=>y({_key:e._key},r.path[0]))&&(o=eo(r,t)),n&&o?{anchor:n,focus:o,backward:e.backward}:null}(B,Q(eC.children,eN.getSnapshot().context.schema.block.name));if(null!==e){e3(`Normalized selection from props ${JSON.stringify(e)}`);let t=ei({context:{schema:eN.getSnapshot().context.schema,value:eC.value,selection:e},blockIndexMap:eC.blockIndexMap});t&&(c.gB.select(eC,t),eC.operations.some(e7)||eN.send({type:"update selection",selection:e}),eC.onChange())}}},eT[61]=eN,eT[62]=B,eT[63]=eC,eT[64]=Y):Y=eT[64];let eJ=Y;eT[65]!==eN||eT[66]!==e$||eT[67]!==eJ?(q=()=>{let e=eN.on("ready",()=>{e$.send({type:"ready"}),eJ()}),t=eN.on("invalid value",()=>{eD(!0)}),n=eN.on("value changed",()=>{eD(!1)});return()=>{e.unsubscribe(),t.unsubscribe(),n.unsubscribe()}},Z=[e$,eN,eJ],eT[65]=eN,eT[66]=e$,eT[67]=eJ,eT[68]=q,eT[69]=Z):(q=eT[68],Z=eT[69]),(0,i.useEffect)(q,Z),eT[70]!==eO||eT[71]!==B||eT[72]!==eJ?(X=()=>{B&&!eO&&eJ()},ee=[eO,B,eJ],eT[70]=eO,eT[71]=B,eT[72]=eJ,eT[73]=X,eT[74]=ee):(X=eT[73],ee=eT[74]),(0,i.useEffect)(X,ee),eT[75]!==eN||eT[76]!==u||eT[77]!==eC?(er=e=>{if(u)void 0!==u(e)&&e.preventDefault();else if(e.nativeEvent.clipboardData){e.stopPropagation(),e.preventDefault();let t=eC.selection?et({schema:eN.getSnapshot().context.schema,editor:eC,range:eC.selection}):void 0,n=t?{selection:t}:void 0;if(!n)return void console.warn("Could not find position for copy event");eN.send({type:"behavior event",behaviorEvent:{type:"clipboard.copy",originEvent:{dataTransfer:e.nativeEvent.clipboardData},position:n},editor:eC,nativeEvent:e})}},eT[75]=eN,eT[76]=u,eT[77]=eC,eT[78]=er):er=eT[78];let eY=er;eT[79]!==eN||eT[80]!==g||eT[81]!==eC?(el=e=>{if(g)void 0!==g(e)&&e.preventDefault();else if(e.nativeEvent.clipboardData){e.stopPropagation(),e.preventDefault();let t=eN.getSnapshot().context.selection,n=t?{selection:t}:void 0;if(!n)return void console.warn("Could not find position for cut event");eN.send({type:"behavior event",behaviorEvent:{type:"clipboard.cut",originEvent:{dataTransfer:e.nativeEvent.clipboardData},position:n},editor:eC,nativeEvent:e})}},eT[79]=eN,eT[80]=g,eT[81]=eC,eT[82]=el):el=eT[82];let eq=el;eT[83]!==eN||eT[84]!==S||eT[85]!==eA||eT[86]!==eM||eT[87]!==eC?(es=e=>{let t=Q(eC.children,eN.getSnapshot().context.schema.block.name,e1.get(eC)),n=(eC.selection?et({schema:eN.getSnapshot().context.schema,editor:eC,range:eC.selection}):null)?.focus.path||[],o=S?.({event:e,value:t,path:n,schemaTypes:eA.schemaTypes});if(o||!eC.selection)e.preventDefault(),eM.send({type:"loading"}),Promise.resolve(o).then(t=>{if(e3("Custom paste function from client resolved",t),t&&t.insert)t.insert?eN.send({type:"behavior event",behaviorEvent:{type:"insert.blocks",blocks:(0,f.SV)({context:{keyGenerator:eN.getSnapshot().context.keyGenerator,schema:eN.getSnapshot().context.schema},blocks:t.insert,options:{removeUnusedMarkDefs:!0,validateFields:!1}}),placement:"auto"},editor:eC}):console.warn("Your onPaste function returned something unexpected:",t);else{e3("No result from custom paste handler, pasting normally");let t=eN.getSnapshot().context.selection,n=t?{selection:t}:void 0;if(!n)return void console.warn("Could not find position for paste event");eN.send({type:"behavior event",behaviorEvent:{type:"clipboard.paste",originEvent:{dataTransfer:e.clipboardData},position:n},editor:eC,nativeEvent:e})}}).catch(e9).finally(()=>{eM.send({type:"done loading"})});else if(e.nativeEvent.clipboardData){e.preventDefault(),e.stopPropagation();let t=eN.getSnapshot().context.selection,n=t?{selection:t}:void 0;if(!n)return void console.warn("Could not find position for paste event");eN.send({type:"behavior event",behaviorEvent:{type:"clipboard.paste",originEvent:{dataTransfer:e.nativeEvent.clipboardData},position:n},editor:eC,nativeEvent:e})}e3("No result from custom paste handler, pasting normally")},eT[83]=eN,eT[84]=S,eT[85]=eA,eT[86]=eM,eT[87]=eC,eT[88]=es):es=eT[88];let eX=es;eT[89]!==eN||eT[90]!==w||eT[91]!==eM||eT[92]!==eC?(ec=e=>{w&&w(e),e.isDefaultPrevented()||(eM.send({type:"focused",event:e}),!eC.selection&&W(eC.children,eN.getSnapshot().context.schema)&&(c.gB.select(eC,c.KE.start(eC,[])),eC.onChange()))},eT[89]=eN,eT[90]=w,eT[91]=eM,eT[92]=eC,eT[93]=ec):ec=eT[93];let e0=ec;eT[94]!==eN||eT[95]!==h||eT[96]!==eC?(ed=e=>{if(h&&h(e),e.isDefaultPrevented()||e.isPropagationStopped())return;let t=en({editorActor:eN,slateEditor:eC,event:e.nativeEvent});t&&eN.send({type:"behavior event",behaviorEvent:{type:"mouse.click",position:t},editor:eC,nativeEvent:e})},eT[94]=eN,eT[95]=h,eT[96]=eC,eT[97]=ed):ed=eT[97];let e2=ed;eT[98]!==p||eT[99]!==eM?(ep=e=>{p&&p(e),e.isPropagationStopped()||eM.send({type:"blurred",event:e})},eT[98]=p,eT[99]=eM,eT[100]=ep):ep=eT[100];let e4=ep;eT[101]!==r?(eh=e=>{r&&r(e)},eT[101]=r,eT[102]=eh):eh=eT[102];let te=eh;eT[103]!==eN||eT[104]!==e||eT[105]!==eC?(eu=t=>{e.onKeyDown&&e.onKeyDown(t),t.isDefaultPrevented()||eC.pteWithHotKeys(t),t.isDefaultPrevented()||eN.send({type:"behavior event",behaviorEvent:{type:"keyboard.keydown",originEvent:{key:t.key,code:t.code,altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey}},editor:eC,nativeEvent:t})},eT[103]=eN,eT[104]=e,eT[105]=eC,eT[106]=eu):eu=eT[106];let tt=eu;eT[107]!==eN||eT[108]!==e||eT[109]!==eC?(ef=t=>{e.onKeyUp&&e.onKeyUp(t),t.isDefaultPrevented()||eN.send({type:"behavior event",behaviorEvent:{type:"keyboard.keyup",originEvent:{key:t.key,code:t.code,altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey}},editor:eC,nativeEvent:t})},eT[107]=eN,eT[108]=e,eT[109]=eC,eT[110]=ef):ef=eT[110];let tn=ef;e:{let e;if(void 0===C){ey=void 0;break e}if(null===C){ey=s;break e}eT[111]!==eA||eT[112]!==C?(e=(e,t)=>{C(eA,t)},eT[111]=eA,eT[112]=C,eT[113]=e):e=eT[113],ey=e}let to=ey;eT[114]!==eN||eT[115]!==eC?(eg=()=>{let e=d.rL.getWindow(eC),t=()=>{eN.send({type:"dragend"})},n=()=>{eN.send({type:"drop"})};return e.document.addEventListener("dragend",t),e.document.addEventListener("drop",n),()=>{e.document.removeEventListener("dragend",t),e.document.removeEventListener("drop",n)}},em=[eC,eN],eT[114]=eN,eT[115]=eC,eT[116]=eg,eT[117]=em):(eg=eT[116],em=eT[117]),(0,i.useEffect)(eg,em),eT[118]!==eN||eT[119]!==_||eT[120]!==eC?(ek=e=>{if(_?.(e),e.isDefaultPrevented()||e.isPropagationStopped())return;let t=en({editorActor:eN,slateEditor:eC,event:e.nativeEvent});return t?(eN.send({type:"dragstart",origin:t}),eN.send({type:"behavior event",behaviorEvent:{type:"drag.dragstart",originEvent:{clientX:e.clientX,clientY:e.clientY,dataTransfer:e.dataTransfer},position:t},editor:eC}),!0):void console.warn("Could not find position for dragstart event")},eT[118]=eN,eT[119]=_,eT[120]=eC,eT[121]=ek):ek=eT[121];let ti=ek;eT[122]!==eN||eT[123]!==m||eT[124]!==eC?(ev=e=>{if(m?.(e),!(e.isDefaultPrevented()||e.isPropagationStopped()||!en({editorActor:eN,slateEditor:eC,event:e.nativeEvent})))return eN.send({type:"behavior event",behaviorEvent:{type:"drag.drag",originEvent:{dataTransfer:e.dataTransfer}},editor:eC}),!0},eT[122]=eN,eT[123]=m,eT[124]=eC,eT[125]=ev):ev=eT[125];let tr=ev;eT[126]!==eN||eT[127]!==k||eT[128]!==eC?(eb=e=>{if(k?.(e),!(e.isDefaultPrevented()||e.isPropagationStopped()))return eN.send({type:"behavior event",behaviorEvent:{type:"drag.dragend",originEvent:{dataTransfer:e.dataTransfer}},editor:eC}),!0},eT[126]=eN,eT[127]=k,eT[128]=eC,eT[129]=eb):eb=eT[129];let ta=eb;eT[130]!==eN||eT[131]!==v||eT[132]!==eC?(ex=e=>{if(v?.(e),e.isDefaultPrevented()||e.isPropagationStopped())return;let t=en({editorActor:eN,slateEditor:eC,event:e.nativeEvent});if(t)return eN.send({type:"behavior event",behaviorEvent:{type:"drag.dragenter",originEvent:{dataTransfer:e.dataTransfer},position:t},editor:eC}),!0},eT[130]=eN,eT[131]=v,eT[132]=eC,eT[133]=ex):ex=eT[133];let tl=ex;eT[134]!==eN||eT[135]!==x||eT[136]!==eC?(eE=e=>{if(x?.(e),e.isDefaultPrevented()||e.isPropagationStopped())return;let t=en({editorActor:eN,slateEditor:eC,event:e.nativeEvent});if(t)return eN.send({type:"behavior event",behaviorEvent:{type:"drag.dragover",originEvent:{dataTransfer:e.dataTransfer},dragOrigin:eN.getSnapshot().context.internalDrag?.origin,position:t},editor:eC,nativeEvent:e}),!0},eT[134]=eN,eT[135]=x,eT[136]=eC,eT[137]=eE):eE=eT[137];let ts=eE;eT[138]!==eN||eT[139]!==E||eT[140]!==eC?(ew=e=>{if(E?.(e),e.isDefaultPrevented()||e.isPropagationStopped())return;let t=en({editorActor:eN,slateEditor:eC,event:e.nativeEvent});return t?(eN.send({type:"behavior event",behaviorEvent:{type:"drag.drop",originEvent:{dataTransfer:e.dataTransfer},dragOrigin:eN.getSnapshot().context.internalDrag?.origin,position:t},editor:eC,nativeEvent:e}),!0):void console.warn("Could not find position for drop event")},eT[138]=eN,eT[139]=E,eT[140]=eC,eT[141]=ew):ew=eT[141];let tc=ew;eT[142]!==eN||eT[143]!==b||eT[144]!==eC?(eS=e=>{if(b?.(e),!(e.isDefaultPrevented()||e.isPropagationStopped()||!en({editorActor:eN,slateEditor:eC,event:e.nativeEvent})))return eN.send({type:"behavior event",behaviorEvent:{type:"drag.dragleave",originEvent:{dataTransfer:e.dataTransfer}},editor:eC}),!0},eT[142]=eN,eT[143]=b,eT[144]=eC,eT[145]=eS):eS=eT[145];let td=eS;eT[146]!==t||eT[147]!==ez?(eB=e=>{if("function"==typeof t?t(e):t&&(t.current=e),e){let t=new MutationObserver(()=>{ez.send({type:"validate selection",editorElement:e})});return t.observe(e,{attributeOldValue:!1,attributes:!1,characterData:!1,childList:!0,subtree:!0}),()=>{t.disconnect()}}},eT[146]=t,eT[147]=ez,eT[148]=eB):eB=eT[148];let tp=eB;return eA?(eT[149]!==tp||eT[150]!==eL||eT[151]!==e2||eT[152]!==eY||eT[153]!==eq||eT[154]!==tr||eT[155]!==ta||eT[156]!==tl||eT[157]!==td||eT[158]!==ts||eT[159]!==ti||eT[160]!==tc||eT[161]!==tt||eT[162]!==tn||eT[163]!==te||eT[164]!==e4||eT[165]!==e0||eT[166]!==eX||eT[167]!==eO||eT[168]!==ej||eT[169]!==eU||eT[170]!==eQ||eT[171]!==j||eT[172]!==to?(eK=eO?null:(0,a.jsx)(d.Fo,{...j,ref:tp,"data-read-only":ej,autoFocus:!1,className:j.className||"pt-editable",decorate:eL,onBlur:e4,onCopy:eY,onCut:eq,onClick:e2,onDOMBeforeInput:te,onDragStart:ti,onDrag:tr,onDragEnd:ta,onDragEnter:tl,onDragOver:ts,onDrop:tc,onDragLeave:td,onFocus:e0,onKeyDown:tt,onKeyUp:tn,onPaste:eX,readOnly:ej,renderPlaceholder:void 0,renderElement:eU,renderLeaf:eQ,renderText:e5,scrollSelectionIntoView:to}),eT[149]=tp,eT[150]=eL,eT[151]=e2,eT[152]=eY,eT[153]=eq,eT[154]=tr,eT[155]=ta,eT[156]=tl,eT[157]=td,eT[158]=ts,eT[159]=ti,eT[160]=tc,eT[161]=tt,eT[162]=tn,eT[163]=te,eT[164]=e4,eT[165]=e0,eT[166]=eX,eT[167]=eO,eT[168]=ej,eT[169]=eU,eT[170]=eQ,eT[171]=j,eT[172]=to,eT[173]=eK):eK=eT[173],eK):null});function e6(e){return e.matches({"edit mode":"read only"})}function e8(e){return e.context.decorate?.fn}function e5(e){return(0,a.jsx)(ej,{...e})}function e7(e){return"set_selection"===e.type}function e9(e){return console.warn(e),e}e4.displayName="ForwardRef(PortableTextEditable)";let te=(e,t)=>{t(e);let n=e.getSnapshot().children;n&&Object.values(n).forEach(e=>{te(e,t)})};function tt(e){let t=[];te(e,e=>{t.push([e,e.getSnapshot()]),e.observers=new Set});let n=e.system.getSnapshot?.();e.stop(),e.system._snapshot=n,t.forEach(([e,t])=>{e._processingStatus=0,e._snapshot=t})}let tn={mimeType:"application/json",serialize:({snapshot:e,event:t})=>{let n=e.context.converters.find(e=>"application/x-portable-text"===e.mimeType);return n?{...n.serialize({snapshot:e,event:t}),mimeType:"application/json",originEvent:t.originEvent}:{type:"serialization.failure",mimeType:"application/json",originEvent:t.originEvent,reason:"No application/x-portable-text Converter found"}},deserialize:({snapshot:e,event:t})=>{let n=e.context.converters.find(e=>"application/x-portable-text"===e.mimeType);return n?{...n.deserialize({snapshot:e,event:t}),mimeType:"application/json"}:{type:"deserialization.failure",mimeType:"application/json",reason:"No application/x-portable-text Converter found"}}},to={mimeType:"application/x-portable-text",serialize:({snapshot:e,event:t})=>{if(!e.context.selection)return{type:"serialization.failure",mimeType:"application/x-portable-text",originEvent:t.originEvent,reason:"No selection"};let n=(0,k.lN)(e);return 0===n.length?{type:"serialization.failure",mimeType:"application/x-portable-text",reason:"No blocks serialized",originEvent:t.originEvent}:{type:"serialization.success",data:JSON.stringify(n),mimeType:"application/x-portable-text",originEvent:t.originEvent}},deserialize:({snapshot:e,event:t})=>{let n=JSON.parse(t.data);if(!Array.isArray(n))return{type:"deserialization.failure",mimeType:"application/x-portable-text",reason:"Data is not an array"};let o=n.flatMap(t=>{let n=(0,f.rT)({context:e.context,block:t,options:{removeUnusedMarkDefs:!0,validateFields:!1}});return n?[n]:[]});return 0===o.length&&n.length>0?{type:"deserialization.failure",mimeType:"application/x-portable-text",reason:"No blocks were parsed"}:{type:"deserialization.success",data:o,mimeType:"application/x-portable-text"}}},ti={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},tr=new Map;function ta(e,{blockIndexMap:t,listIndexMap:n}){let o;t.clear(),n.clear(),tr.clear();for(let i=0;i<e.value.length;i++){let r=e.value.at(i);if(void 0===r)continue;if(t.set(r._key,i),!(0,g.zS)(e,r)||void 0===r.listItem||void 0===r.level){tr.clear(),o=void 0;continue}if(!o||o.listItem===r.listItem&&o.level<r.level){let e=tr.get(r.listItem)??new Map;e.set(r.level,1),tr.set(r.listItem,e),n.set(r._key,1),o={listItem:r.listItem,level:r.level};continue}tr.forEach((e,t)=>{if(t===r.listItem)return;let n=[];e.forEach((e,t)=>{t>=r.level&&n.push(t)}),n.forEach(t=>{e.delete(t)})});let a=tr.get(r.listItem)??new Map,l=a.get(r.level)??0;a.set(r.level,l+1),tr.set(r.listItem,a),n.set(r._key,l+1),o={listItem:r.listItem,level:r.level}}}function tl(e){return{_type:e.schema.block.name,_key:e.keyGenerator(),style:e.schema.styles[0].name??"normal",markDefs:[],children:[{_type:e.schema.span.name,_key:e.keyGenerator(),text:"",marks:[]}]}}function ts(e,t){let n=tc(e)||!1;eX.set(e,!0),t(),eX.set(e,n)}function tc(e){return eX.get(e)}let td=new WeakMap,tp=new WeakMap;function th(e){return td.get(e)??!1}function tu(e){return tp.get(e)??!1}let tf=G("plugin:withPortableTextMarkModel");function ty(e){let[t,n]=e;return[t,n]}function tg(e,t){let n=e,o=t,i=n.length,r=o.length;if(0===i||0===r)return 0;i>r?n=n.substring(i-r):i<r&&(o=o.substring(0,i));let a=Math.min(i,r);if(n===o)return a;let l=0,s=1;for(let e=0;-1!==e;){let t=n.substring(a-s);if(-1===(e=o.indexOf(t)))break;s+=e,(0===e||n.substring(a-s)===o.substring(0,s))&&(l=s,s++)}return l}function tm(e,t){if(!e||!t||e[0]!==t[0])return 0;let n=0,o=Math.min(e.length,t.length),i=o,r=0;for(;n<i;)e.substring(r,i)===t.substring(r,i)?r=n=i:o=i,i=Math.floor((o-n)/2+n);return i}function tk(e,t){if(!e||!t||e[e.length-1]!==t[t.length-1])return 0;let n=0,o=Math.min(e.length,t.length),i=o,r=0;for(;n<i;)e.substring(e.length-i,e.length-r)===t.substring(t.length-i,t.length-r)?r=n=i:o=i,i=Math.floor((o-n)/2+n);return i}function tv(e,t,n,o,i){let r=e.substring(0,n),a=t.substring(0,o),l=e.substring(n),s=t.substring(o),c=tK(r,a,{checkLines:!1,deadline:i}),d=tK(l,s,{checkLines:!1,deadline:i});return c.concat(d)}function tb(e,t,n){let o=e.slice(n,n+Math.floor(e.length/4)),i=-1,r="",a,l,s,c;for(;-1!==(i=t.indexOf(o,i+1));){let o=tm(e.slice(n),t.slice(i)),d=tk(e.slice(0,n),t.slice(0,i));r.length<d+o&&(r=t.slice(i-d,i)+t.slice(i,i+o),a=e.slice(0,n-d),l=e.slice(n+o),s=t.slice(0,i-d),c=t.slice(i+o))}return 2*r.length>=e.length?[a||"",l||"",s||"",c||"",r||""]:null}var tx=Object.defineProperty,t_=Object.getOwnPropertySymbols,tE=Object.prototype.hasOwnProperty,tw=Object.prototype.propertyIsEnumerable,tS=(e,t,n)=>t in e?tx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;function tB(e,t,n){if(null===e||null===t)throw Error("Null input. (diff)");let o=tK(e,t,function(e){let t;var n,o={checkLines:!0,deadline:(n=e.timeout||1,t=1,"u">typeof n&&(t=n<=0?Number.MAX_VALUE:n),Date.now()+1e3*t)},i=e;for(var r in i||(i={}))tE.call(i,r)&&tS(o,r,i[r]);if(t_)for(var r of t_(i))tw.call(i,r)&&tS(o,r,i[r]);return o}(n||{}));return function(e){for(let t=0;t<e.length;t++){let[n,o]=e[t];if(0===o.length)continue;let i=o[0];(function(e){let t=e.charCodeAt(0);return t>=55296&&t<=56319})(o[o.length-1])&&0===n&&tO(e,t,1),function(e){let t=e.charCodeAt(0);return t>=56320&&t<=57343}(i)&&0===n&&tO(e,t,-1)}for(let t=0;t<e.length;t++)0===e[t][1].length&&e.splice(t,1)}(o),o}function tK(e,t,n){let o=e,i=t;if(o===i)return o?[[0,o]]:[];let r=tm(o,i),a=o.substring(0,r);r=tk(o=o.substring(r),i=i.substring(r));let l=o.substring(o.length-r),s=function(e,t,n){let o;if(!e)return[[1,t]];if(!t)return[[-1,e]];let i=e.length>t.length?e:t,r=e.length>t.length?t:e,a=i.indexOf(r);if(-1!==a)return o=[[1,i.substring(0,a)],[0,r],[1,i.substring(a+r.length)]],e.length>t.length&&(o[0][0]=-1,o[2][0]=-1),o;if(1===r.length)return[[-1,e],[1,t]];let l=function(e,t,n=1){let o,i,r,a,l;if(n<=0)return null;let s=e.length>t.length?e:t,c=e.length>t.length?t:e;if(s.length<4||2*c.length<s.length)return null;let d=tb(s,c,Math.ceil(s.length/4)),p=tb(s,c,Math.ceil(s.length/2));if(d&&p)o=d[4].length>p[4].length?d:p;else{if(!d&&!p)return null;p?d||(o=p):o=d}if(!o)throw Error("Unable to find a half match.");return e.length>t.length?(i=o[0],r=o[1],a=o[2],l=o[3]):(a=o[0],l=o[1],i=o[2],r=o[3]),[i,r,a,l,o[4]]}(e,t);if(l){let e=l[0],t=l[1],o=l[2],i=l[3],r=l[4],a=tK(e,o,n),s=tK(t,i,n);return a.concat([[0,r]],s)}return n.checkLines&&e.length>100&&t.length>100?function(e,t,n){let o=e,i=t,r=function(e,t){let n=[],o={};function i(e){let t="",i=0,a=-1,l=n.length;for(;a<e.length-1;){-1===(a=e.indexOf(`
`,i))&&(a=e.length-1);let s=e.slice(i,a+1);(o.hasOwnProperty?o.hasOwnProperty(s):void 0!==o[s])?t+=String.fromCharCode(o[s]):(l===r&&(s=e.slice(i),a=e.length),t+=String.fromCharCode(l),o[s]=l,n[l++]=s),i=a+1}return t}n[0]="";let r=4e4,a=i(e);return r=65535,{chars1:a,chars2:i(t),lineArray:n}}(o,i);o=r.chars1,i=r.chars2;let a=r.lineArray,l=tK(o,i,{checkLines:!1,deadline:n.deadline});(function(e,t){for(let n=0;n<e.length;n++){let o=e[n][1],i=[];for(let e=0;e<o.length;e++)i[e]=t[o.charCodeAt(e)];e[n][1]=i.join("")}})(l,a),(l=function(e){let t=e.map(e=>ty(e)),n=!1,o=[],i=0,r=null,a=0,l=0,s=0,c=0,d=0;for(;a<t.length;)0===t[a][0]?(o[i++]=a,l=c,s=d,c=0,d=0,r=t[a][1]):(1===t[a][0]?c+=t[a][1].length:d+=t[a][1].length,r&&r.length<=Math.max(l,s)&&r.length<=Math.max(c,d)&&(t.splice(o[i-1],0,[-1,r]),t[o[i-1]+1][0]=1,i--,a=--i>0?o[i-1]:-1,l=0,s=0,c=0,d=0,r=null,n=!0)),a++;for(n&&(t=tP(t)),t=tC(t),a=1;a<t.length;){if(-1===t[a-1][0]&&1===t[a][0]){let e=t[a-1][1],n=t[a][1],o=tg(e,n),i=tg(n,e);o>=i?(o>=e.length/2||o>=n.length/2)&&(t.splice(a,0,[0,n.substring(0,o)]),t[a-1][1]=e.substring(0,e.length-o),t[a+1][1]=n.substring(o),a++):(i>=e.length/2||i>=n.length/2)&&(t.splice(a,0,[0,e.substring(0,i)]),t[a-1][0]=1,t[a-1][1]=n.substring(0,n.length-i),t[a+1][0]=-1,t[a+1][1]=e.substring(i),a++),a++}a++}return t}(l)).push([0,""]);let s=0,c=0,d=0,p="",h="";for(;s<l.length;){switch(l[s][0]){case 1:d++,h+=l[s][1];break;case -1:c++,p+=l[s][1];break;case 0:if(c>=1&&d>=1){l.splice(s-c-d,c+d),s=s-c-d;let e=tK(p,h,{checkLines:!1,deadline:n.deadline});for(let t=e.length-1;t>=0;t--)l.splice(s,0,e[t]);s+=e.length}d=0,c=0,p="",h="";break;default:throw Error("Unknown diff operation.")}s++}return l.pop(),l}(e,t,n):function(e,t,n){let o=e.length,i=t.length,r=Math.ceil((o+i)/2),a=2*r,l=Array(a),s=Array(a);for(let e=0;e<a;e++)l[e]=-1,s[e]=-1;l[r+1]=0,s[r+1]=0;let c=o-i,d=c%2!=0,p=0,h=0,u=0,f=0;for(let y=0;y<r&&!(Date.now()>n);y++){for(let u=-y+p;u<=y-h;u+=2){let f,g=r+u,m=(f=u===-y||u!==y&&l[g-1]<l[g+1]?l[g+1]:l[g-1]+1)-u;for(;f<o&&m<i&&e.charAt(f)===t.charAt(m);)f++,m++;if(l[g]=f,f>o)h+=2;else if(m>i)p+=2;else if(d){let i=r+c-u;if(i>=0&&i<a&&-1!==s[i]&&f>=o-s[i])return tv(e,t,f,m,n)}}for(let p=-y+u;p<=y-f;p+=2){let h,g=r+p,m=(h=p===-y||p!==y&&s[g-1]<s[g+1]?s[g+1]:s[g-1]+1)-p;for(;h<o&&m<i&&e.charAt(o-h-1)===t.charAt(i-m-1);)h++,m++;if(s[g]=h,h>o)f+=2;else if(m>i)u+=2;else if(!d){let i=r+c-p;if(i>=0&&i<a&&-1!==l[i]){let a=l[i],s=r+a-i;if(a>=(h=o-h))return tv(e,t,a,s,n)}}}}return[[-1,e],[1,t]]}(e,t,n.deadline)}(o=o.substring(0,o.length-r),i=i.substring(0,i.length-r),n);return a&&s.unshift([0,a]),l&&s.push([0,l]),s=tP(s)}function tT(e,t,n){return 1===n?e+t:t+e}function tA(e,t){return 1===t?[e.substring(0,e.length-1),e[e.length-1]]:[e.substring(1),e[0]]}function tO(e,t,n){var o,i;let r=1===n?-1:1,a=null,l=null,s=t+n;for(;s>=0&&s<e.length&&(null===a||null===l);s+=n){let[o,i]=e[s];if(0!==i.length){if(1===o){null===a&&(a=s);continue}else if(-1===o){null===l&&(l=s);continue}else if(0===o){if(null===a&&null===l){let[o,i]=tA(e[t][1],n);e[t][1]=o,e[s][1]=tT(e[s][1],i,r);return}break}}}if(null!==a&&null!==l&&(o=a,i=l,1===n?e[o][1][e[o][1].length-1]===e[i][1][e[i][1].length-1]:e[o][1][0]===e[i][1][0])){let[o,i]=tA(e[a][1],r),[s]=tA(e[l][1],r);e[a][1]=o,e[l][1]=s,e[t][1]=tT(e[t][1],i,n);return}let[c,d]=tA(e[t][1],n);e[t][1]=c,null===a?(e.splice(s,0,[1,d]),null!==l&&l>=s&&l++):e[a][1]=tT(e[a][1],d,r),null===l?e.splice(s,0,[-1,d]):e[l][1]=tT(e[l][1],d,r)}let tD=/[^a-zA-Z0-9]/,tN=/\s/,tI=/[\r\n]/,tM=/\n\r?\n$/,tj=/^\r?\n\r?\n/;function tC(e){let t=e.map(e=>ty(e));function n(e,t){if(!e||!t)return 6;let n=e.charAt(e.length-1),o=t.charAt(0),i=n.match(tD),r=o.match(tD),a=i&&n.match(tN),l=r&&o.match(tN),s=a&&n.match(tI),c=l&&o.match(tI),d=s&&e.match(tM),p=c&&t.match(tj);return d||p?5:s||c?4:i&&!a&&l?3:a||l?2:i||r?1:0}let o=1;for(;o<t.length-1;){if(0===t[o-1][0]&&0===t[o+1][0]){let e=t[o-1][1],i=t[o][1],r=t[o+1][1],a=tk(e,i);if(a){let t=i.substring(i.length-a);e=e.substring(0,e.length-a),i=t+i.substring(0,i.length-a),r=t+r}let l=e,s=i,c=r,d=n(e,i)+n(i,r);for(;i.charAt(0)===r.charAt(0);){e+=i.charAt(0),i=i.substring(1)+r.charAt(0),r=r.substring(1);let t=n(e,i)+n(i,r);t>=d&&(d=t,l=e,s=i,c=r)}t[o-1][1]!==l&&(l?t[o-1][1]=l:(t.splice(o-1,1),o--),t[o][1]=s,c?t[o+1][1]=c:(t.splice(o+1,1),o--))}o++}return t}function tP(e){let t=e.map(e=>ty(e));t.push([0,""]);let n=0,o=0,i=0,r="",a="",l;for(;n<t.length;)switch(t[n][0]){case 1:i++,a+=t[n][1],n++;break;case -1:o++,r+=t[n][1],n++;break;case 0:o+i>1?(0!==o&&0!==i&&(0!==(l=tm(a,r))&&(n-o-i>0&&0===t[n-o-i-1][0]?t[n-o-i-1][1]+=a.substring(0,l):(t.splice(0,0,[0,a.substring(0,l)]),n++),a=a.substring(l),r=r.substring(l)),0!==(l=tk(a,r))&&(t[n][1]=a.substring(a.length-l)+t[n][1],a=a.substring(0,a.length-l),r=r.substring(0,r.length-l))),n-=o+i,t.splice(n,o+i),r.length&&(t.splice(n,0,[-1,r]),n++),a.length&&(t.splice(n,0,[1,a]),n++),n++):0!==n&&0===t[n-1][0]?(t[n-1][1]+=t[n][1],t.splice(n,1)):n++,i=0,o=0,r="",a="";break;default:throw Error("Unknown diff operation")}""===t[t.length-1][1]&&t.pop();let s=!1;for(n=1;n<t.length-1;)0===t[n-1][0]&&0===t[n+1][0]&&(t[n][1].substring(t[n][1].length-t[n-1][1].length)===t[n-1][1]?(t[n][1]=t[n-1][1]+t[n][1].substring(0,t[n][1].length-t[n-1][1].length),t[n+1][1]=t[n-1][1]+t[n+1][1],t.splice(n-1,1),s=!0):t[n][1].substring(0,t[n+1][1].length)===t[n+1][1]&&(t[n-1][1]+=t[n+1][1],t[n][1]=t[n][1].substring(t[n+1][1].length)+t[n+1][1],t.splice(n+1,1),s=!0)),n++;return s&&(t=tP(t)),t}var tz=Object.defineProperty,tR=Object.getOwnPropertySymbols,t$=Object.prototype.hasOwnProperty,tL=Object.prototype.propertyIsEnumerable,tV=(e,t,n)=>t in e?tz(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,tG=(e,t)=>{for(var n in t||(t={}))t$.call(t,n)&&tV(e,n,t[n]);if(tR)for(var n of tR(t))tL.call(t,n)&&tV(e,n,t[n]);return e};let tU={threshold:.5,distance:1e3};function tF(e,t,n,o={}){if(null===e||null===t||null===n)throw Error("Null input. (match())");let i=Math.max(0,Math.min(n,e.length));return e===t?0:e.length?e.substring(i,i+t.length)===t?i:function(e,t,n,o={}){if(t.length>32)throw Error("Pattern too long for this browser.");let i=tG(tG({},tU),o),r=function(e){let t={};for(let n=0;n<e.length;n++)t[e.charAt(n)]=0;for(let n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t}(t);function a(e,o){let r=e/t.length,a=Math.abs(n-o);return i.distance?r+a/i.distance:a?1:r}let l=i.threshold,s=e.indexOf(t,n);-1!==s&&(l=Math.min(a(0,s),l),-1!==(s=e.lastIndexOf(t,n+t.length))&&(l=Math.min(a(0,s),l)));let c=1<<t.length-1;s=-1;let d,p,h=t.length+e.length,u=[];for(let o=0;o<t.length;o++){for(d=0,p=h;d<p;)a(o,n+p)<=l?d=p:h=p,p=Math.floor((h-d)/2+d);h=p;let i=Math.max(1,n-p+1),f=Math.min(n+p,e.length)+t.length,y=Array(f+2);y[f+1]=(1<<o)-1;for(let t=f;t>=i;t--){let d=r[e.charAt(t-1)];if(0===o?y[t]=(y[t+1]<<1|1)&d:y[t]=(y[t+1]<<1|1)&d|((u[t+1]|u[t])<<1|1)|u[t+1],y[t]&c){let e=a(o,t-1);if(e<=l)if(l=e,(s=t-1)>n)i=Math.max(1,2*n-s);else break}}if(a(o+1,n)>l)break;u=y}return s}(e,t,i,o):-1}function tH(e){let t=[];for(let n=0;n<e.length;n++)1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")}function tQ(e){let t=[];for(let n=0;n<e.length;n++)-1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")}function tW(e,t){let n=0,o=0,i=0,r=0,a;for(a=0;a<e.length&&(1!==e[a][0]&&(n+=e[a][1].length),-1!==e[a][0]&&(o+=e[a][1].length),!(n>t));a++)i=n,r=o;return e.length!==a&&-1===e[a][0]?r:r+(t-i)}function tJ(e){let t=0;for(let n=0;n<e.length;n++){let o=e.codePointAt(n);if(typeof o>"u")throw Error("Failed to get codepoint");t+=tY(o)}return t}function tY(e){return e<=127?1:e<=2047?2:e<=65535?3:4}function tq(e,t){return{diffs:[],start1:e,start2:t,utf8Start1:e,utf8Start2:t,length1:0,length2:0,utf8Length1:0,utf8Length2:0}}let tZ=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;function tX(e){if(!e)return[];let t=[],n=e.split(`
`),o=0;for(;o<n.length;){let e=n[o].match(tZ);if(!e)throw Error(`Invalid patch string: ${n[o]}`);let i=tq(t0(e[1]),t0(e[3]));for(t.push(i),""===e[2]?(i.start1--,i.utf8Start1--,i.length1=1,i.utf8Length1=1):"0"===e[2]?(i.length1=0,i.utf8Length1=0):(i.start1--,i.utf8Start1--,i.utf8Length1=t0(e[2]),i.length1=i.utf8Length1),""===e[4]?(i.start2--,i.utf8Start2--,i.length2=1,i.utf8Length2=1):"0"===e[4]?(i.length2=0,i.utf8Length2=0):(i.start2--,i.utf8Start2--,i.utf8Length2=t0(e[4]),i.length2=i.utf8Length2),o++;o<n.length;){let e,t=n[o],r=t.charAt(0);if("@"===r)break;if(""===r){o++;continue}try{e=decodeURI(t.slice(1))}catch{throw Error(`Illegal escape in parse: ${t}`)}let a=tJ(e)-e.length;if("-"===r)i.diffs.push([-1,e]),i.length1-=a;else if("+"===r)i.diffs.push([1,e]),i.length2-=a;else if(" "===r)i.diffs.push([0,e]),i.length1-=a,i.length2-=a;else throw Error(`Invalid patch mode "${r}" in: ${e}`);o++}}return t}function t0(e){return parseInt(e,10)}let t1=new WeakMap;function t2(e){return t1.get(e)?.undoStepId}function t3(e){t1.set(e,{undoStepId:(0,f.OL)()})}function t4(e){t1.set(e,void 0)}let t6=G("plugin:withUndoRedo"),t8=new WeakMap,t5=new WeakMap,t7=e=>{let t=t8.get(e);return void 0===t||t},t9=e=>(t5.get(e)||t5.set(e,[]),t5.get(e)||[]);function ne(e,t,n,o,i){let r={...n};if("insert"===t.type&&1===t.path.length){let e=(o||[]).findIndex(e=>y({_key:e._key},t.path[0]));return t6(`Adjusting block path (+${t.items.length}) for '${r.type}' operation and patch '${t.type}'`),[nt(r,t.items.length,e)]}if("unset"===t.type&&1===t.path.length){let e=(i||[]).findIndex(e=>y({_key:e._key},t.path[0]));return"path"in r&&Array.isArray(r.path)&&r.path[0]===e?(t6("Skipping transformation that targeted removed block"),[]):[nt(r,-1,e)]}if("unset"===t.type&&0===t.path.length)return t6(`Adjusting selection for unset everything patch and ${n.type} operation`),[];if("diffMatchPatch"===t.type){var a,l;let n,o=(a=e,"set_selection"===(l=r).type&&a.selection?n=a.children[a.selection.focus.path[0]]:"path"in l&&(n=a.children[l.path[0]]),n);return o&&y({_key:o._key},t.path[0])&&tX(t.value).forEach(e=>{let t=0,n=e.utf8Start1,{diffs:o}=e;if(o.forEach((e,i)=>{let[r,a]=e;1===r?(t+=a.length,n+=a.length):-1===r?(t-=a.length,n-=a.length):0===r&&(o.slice(i).every(([e])=>0===e)||(n+=a.length))}),"insert_text"===r.type&&n<r.offset&&(r.offset+=t),"remove_text"===r.type&&n<=r.offset-r.text.length&&(r.offset+=t),"set_selection"===r.type){let e=r.properties?.focus?{...r.properties.focus}:void 0,o=r?.properties?.anchor?{...r.properties.anchor}:void 0,i=r?.newProperties?.focus?{...r.newProperties.focus}:void 0,a=r?.newProperties?.anchor?{...r.newProperties.anchor}:void 0;(e&&o||i&&a)&&([e,o,i,a].forEach(e=>{e&&n<e.offset&&(e.offset+=t)}),e&&o&&(r.properties={focus:e,anchor:o}),i&&a&&(r.newProperties={focus:i,anchor:a}))}}),[r]}return[r]}function nt(e,t,n){let o={...e};if(n>=0&&"set_selection"!==o.type&&Array.isArray(o.path)&&o.path[0]>=n+t&&o.path[0]+t>-1){let e=[o.path[0]+t,...o.path.slice(1)];o.path=e}if("set_selection"===o.type){let e=o.properties?.focus?{...o.properties.focus}:void 0,i=o?.properties?.anchor?{...o.properties.anchor}:void 0,r=o?.newProperties?.focus?{...o.newProperties.focus}:void 0,a=o?.newProperties?.anchor?{...o.newProperties.anchor}:void 0;(e&&i||r&&a)&&([e,i,r,a].forEach(e=>{e&&e.path[0]>=n+t&&e.path[0]+t>-1&&(e.path=[e.path[0]+t,...e.path.slice(1)])}),e&&i&&(o.properties={focus:e,anchor:i}),r&&a&&(o.newProperties={focus:r,anchor:a}))}return o}function nn(e,t){let n=t7(e);t8.set(e,!1),t(),t8.set(e,n)}function no(e,t,n){let o=h.wE.toDOMRange(e,t).getBoundingClientRect(),i=h.wE.toDOMRange(e,n).getBoundingClientRect();return ni(o,i)&&ni(i,o)}function ni(e,t){let n=(t.top+t.bottom)/2;return e.top<=n&&e.bottom>=n}let nr={"annotation.add":({context:e,operation:t})=>{let n=(0,f.fr)({annotation:{_type:t.annotation.name,...t.annotation.value},context:e,options:{validateFields:!0}});if(!n)throw Error(`Failed to parse annotation ${JSON.stringify(t.annotation)}`);let o=t.editor;if(!o.selection||c.Q6.isCollapsed(o.selection))return;let i=c.KE.nodes(o,{at:o.selection,match:e=>o.isTextBlock(e),reverse:c.Q6.isBackward(o.selection)}),r=0;for(let[t,a]of i){if(0===t.children.length||1===t.children.length&&""===t.children[0].text)continue;let i=0===r?n._key:e.keyGenerator(),l=t.markDefs??[];for(let[e,t]of(void 0===l.find(e=>e._type===n._type&&e._key===i)&&c.gB.setNodes(o,{markDefs:[...l,{...n,_key:i}]},{at:a}),c.gB.setNodes(o,{},{match:c.EY.isText,split:!0}),c.bP.children(o,a))){if(!o.isTextSpan(e)||!c.Q6.includes(o.selection,t))continue;let n=e.marks??[];c.gB.setNodes(o,{marks:[...n,i]},{at:t})}r++}},"annotation.remove":({operation:e})=>{let t=e.editor;if(t.selection)if(c.Q6.isCollapsed(t.selection)){let[n,o]=c.KE.node(t,t.selection,{depth:1});if(!t.isTextBlock(n))return;let i=(n.markDefs??[]).filter(t=>t._type===e.annotation.name),[r,a]=c.KE.node(t,t.selection,{depth:2});if(!t.isTextSpan(r))return;let l=r.marks?.find(e=>i.some(t=>t._key===e));if(!l)return;let s=[];for(let[e,n]of c.bP.children(t,o,{reverse:!0}))if(t.isTextSpan(e)&&c.wA.isBefore(n,a))if(e.marks?.includes(l))s.push([e,n]);else break;let d=[];for(let[e,n]of c.bP.children(t,o))if(t.isTextSpan(e)&&c.wA.isAfter(n,a))if(e.marks?.includes(l))d.push([e,n]);else break;for(let[e,n]of[...s,[r,a],...d])c.gB.setNodes(t,{marks:e.marks?.filter(e=>e!==l)},{at:n})}else for(let[n,o]of(c.gB.setNodes(t,{},{match:e=>t.isTextSpan(e),split:!0,hanging:!0}),c.KE.nodes(t,{at:t.selection,match:e=>t.isTextBlock(e)})))for(let[i,r]of c.bP.children(t,o)){if(!t.isTextSpan(i)||!c.Q6.includes(t.selection,r))continue;let o=n.markDefs??[],a=i.marks??[],l=a.filter(t=>o.find(e=>e._key===t)?._type!==e.annotation.name);l.length!==a.length&&c.gB.setNodes(t,{marks:l},{at:r})}},"block.set":({context:e,operation:t})=>{let n=t.editor.blockIndexMap.get(t.at[0]._key);if(void 0===n)throw Error(`Unable to find block index for block at ${JSON.stringify(t.at)}`);let o=t.editor.value.at(n);if(!o)throw Error(`Unable to find block at ${JSON.stringify(t.at)}`);let{_type:i,...r}=t.props,a={...o,...r},l=(0,f.rT)({context:e,block:a,options:{removeUnusedMarkDefs:!1,validateFields:!0}});if(!l)throw Error(`Unable to update block at ${JSON.stringify(t.at)}`);let s=H([l],{schemaTypes:e.schema})?.at(0);if(!s)throw Error("Unable to convert block to Slate value");c.gB.setNodes(t.editor,s,{at:[n]})},"block.unset":({context:e,operation:t})=>{let n=ei({context:{schema:e.schema,value:t.editor.value,selection:{anchor:{path:t.at,offset:0},focus:{path:t.at,offset:0}}},blockIndexMap:t.editor.blockIndexMap});if(!n)throw Error(`Unable to convert ${JSON.stringify(t.at)} into a Slate Range`);let o=c.KE.node(t.editor,n,{depth:1})?.[0];if(!o)throw Error(`Unable to find block at ${JSON.stringify(t.at)}`);let i=Q([o],e.schema.block.name,e1.get(t.editor)).at(0);if(!i)throw Error(`Unable to parse block at ${JSON.stringify(t.at)}`);if((0,g.zS)(e,i)){let o=t.props.filter(e=>"_type"!==e),r=(0,f.rT)({context:e,block:D(i,o),options:{removeUnusedMarkDefs:!0,validateFields:!0}});if(!r)throw Error(`Unable to update block at ${JSON.stringify(t.at)}`);let a={};for(let e of o)e in r?a[e]=r[e]:a[e]=void 0;c.gB.setNodes(t.editor,a,{at:n});return}let r=(0,f.rT)({context:e,block:D(i,t.props.filter(e=>"_type"!==e)),options:{removeUnusedMarkDefs:!0,validateFields:!0}});if(!r)throw Error(`Unable to update block at ${JSON.stringify(t.at)}`);let{_type:a,_key:l,...s}=r;c.gB.setNodes(t.editor,{_type:a,_key:l,value:s},{at:n})},"child.set":({context:e,operation:t})=>{let n=ei({context:{schema:e.schema,value:t.editor.value,selection:{anchor:{path:t.at,offset:0},focus:{path:t.at,offset:0}}},blockIndexMap:t.editor.blockIndexMap});if(!n)throw Error(`Unable to convert ${JSON.stringify(t.at)} into a Slate Range`);let o=c.KE.node(t.editor,n,{depth:2}),i=o?.[0],r=o?.[1];if(!i||!r)throw Error(`Unable to find child at ${JSON.stringify(t.at)}`);if(t.editor.isTextSpan(i)){let{_type:e,text:n,...o}=t.props;c.gB.setNodes(t.editor,{...i,...o},{at:r}),"string"==typeof n&&i.text!==n&&(t.editor.apply({type:"remove_text",path:r,offset:0,text:i.text}),t.editor.apply({type:"insert_text",path:r,offset:0,text:n}));return}if(c.Hg.isElement(i)){let n=e.schema.inlineObjects.find(e=>e.name===i._type);if(!n)throw Error(`Unable to find schema definition for Inline Object type ${i._type}`);let o="value"in i&&"object"==typeof i.value?i.value:{},{_type:a,_key:l,...s}=t.props;for(let e in s)n.fields.some(t=>t.name===e)||delete s[e];c.gB.setNodes(t.editor,{...i,_key:"string"==typeof l?l:i._key,value:{...o,...s}},{at:r});return}throw Error(`Unable to determine the type of child at ${JSON.stringify(t.at)}`)},"child.unset":({context:e,operation:t})=>{let n=ei({context:{schema:e.schema,value:t.editor.value,selection:{anchor:{path:t.at,offset:0},focus:{path:t.at,offset:0}}},blockIndexMap:t.editor.blockIndexMap});if(!n)throw Error(`Unable to convert ${JSON.stringify(t.at)} into a Slate Range`);let o=c.KE.node(t.editor,n,{depth:2}),i=o?.[0],r=o?.[1];if(!i||!r)throw Error(`Unable to find child at ${JSON.stringify(t.at)}`);if(t.editor.isTextSpan(i)){t.props.includes("text")&&t.editor.apply({type:"remove_text",path:r,offset:0,text:i.text});let n={};for(let o of t.props)if("_type"!==o){if("_key"===o){n._key=e.keyGenerator();continue}n[o]=null}c.gB.setNodes(t.editor,n,{at:r});return}if(c.Hg.isElement(i)){let n="value"in i&&"object"==typeof i.value?i.value:{},o=t.props.map(e=>({type:"unset",path:[e]})),a=(0,N.yl)(n,o);c.gB.setNodes(t.editor,{...i,_key:t.props.includes("_key")?e.keyGenerator():i._key,value:a},{at:r});return}throw Error(`Unable to determine the type of child at ${JSON.stringify(t.at)}`)},"decorator.add":({context:e,operation:t})=>{let n=t.editor,o=t.decorator,i=Q(n.children,e.schema.block.name,e1.get(n)),r=t.at?.anchor?(0,f.m4)({context:{...e,value:i},blockOffset:t.at.anchor,direction:"backward"}):void 0,a=t.at?.focus?(0,f.m4)({context:{...e,value:i},blockOffset:t.at.focus,direction:"forward"}):void 0,l=r&&a?{anchor:r,focus:a}:void 0,s=l?ei({context:{schema:e.schema,value:t.editor.value,selection:l},blockIndexMap:t.editor.blockIndexMap})??n.selection:n.selection;if(!s)return;let d=et({schema:e.schema,editor:n,range:s}),p=d?(0,M.e)({context:{...e,value:i},selectionPoint:d.anchor}):void 0,h=d?(0,M.e)({context:{...e,value:i},selectionPoint:d.focus}):void 0;if(!p||!h)throw Error("Unable to find anchor or focus offset");if(c.Q6.isExpanded(s)){c.gB.setNodes(n,{},{at:s,match:c.EY.isText,split:!0,hanging:!0});let i=Q(n.children,e.schema.block.name,e1.get(n)),r=(0,I.lv)({context:{...e,value:i},offsets:{anchor:p,focus:h},backward:d?.backward}),a=(0,m.bu)({blockIndexMap:n.blockIndexMap,context:{converters:[],keyGenerator:e.keyGenerator,readOnly:!1,schema:e.schema,selection:r,value:i},decoratorState:n.decoratorState});if(!a)throw Error("Unable to find trimmed selection");let l=ei({context:{schema:e.schema,value:t.editor.value,selection:a},blockIndexMap:t.editor.blockIndexMap});if(!l)throw Error("Unable to find new selection");for(let[e,t]of c.Q6.isRange(l)?[...c.KE.nodes(n,{at:l,match:e=>c.EY.isText(e)})]:[]){let i=[...(Array.isArray(e.marks)?e.marks:[]).filter(e=>e!==o),o];c.gB.setNodes(n,{marks:i},{at:t,match:c.EY.isText,split:!0,hanging:!0})}}else{if(!Array.from(c.KE.nodes(n,{at:s,match:e=>n.isTextSpan(e)}))?.at(0))return;let[e,t]=c.KE.node(n,s,{depth:1}),i=n.isTextBlock(e)&&1===e.children.length&&n.isTextSpan(e.children[0])&&""===e.children[0].text?e.children[0]:void 0;if(i){let e=i.marks??[],r=e.filter(e=>e!==o);c.gB.setNodes(n,{marks:e.length===r.length?[...e,o]:r},{at:t,match:e=>n.isTextSpan(e)})}else n.decoratorState[o]=!0}if(n.selection){let e=n.selection;n.selection={...e}}},"decorator.remove":({operation:e})=>{let t=e.editor,n=e.decorator,{selection:o}=t;if(o){if(c.Q6.isExpanded(o))c.gB.setNodes(t,{},{match:c.EY.isText,split:!0,hanging:!0}),t.selection&&[...c.KE.nodes(t,{at:t.selection,match:c.EY.isText})].forEach(([e,o])=>{let i=t.children[o[0]];c.Hg.isElement(i)&&i.children.includes(e)&&c.gB.setNodes(t,{marks:(Array.isArray(e.marks)?e.marks:[]).filter(e=>e!==n),_type:"span"},{at:o})});else{let[e,i]=c.KE.node(t,o,{depth:1}),r=t.isTextBlock(e)&&1===e.children.length&&t.isTextSpan(e.children[0])&&""===e.children[0].text?e.children[0]:void 0;if(r){let e=(r.marks??[]).filter(e=>e!==n);c.gB.setNodes(t,{marks:e},{at:i,match:e=>t.isTextSpan(e)})}else t.decoratorState[n]=!1}if(t.selection){let e=t.selection;t.selection={...e}}}},delete:({context:e,operation:t})=>{let n=(0,f.XE)(t.at.anchor),o=(0,f.XE)(t.at.focus),i=t.at.backward?o:n,r=t.at.backward?n:o,a=t.at.backward?t.at.focus.offset:t.at.anchor.offset;if(!i)throw Error("Failed to get start block key");if(!r)throw Error("Failed to get end block key");let l=t.editor.blockIndexMap.get(i);if(void 0===l)throw Error("Failed to get start block index");let s=t.editor.value.at(l);if(!s)throw Error("Failed to get start block");let d=t.editor.blockIndexMap.get(r);if(void 0===d)throw Error("Failed to get end block index");let p=t.editor.value.at(d);if(!p)throw Error("Failed to get end block");if("block"===t.unit){c.gB.removeNodes(t.editor,{at:{anchor:{path:[l],offset:0},focus:{path:[d],offset:0}},mode:"highest"}),0===t.editor.children.length&&c.gB.insertNodes(t.editor,tl(e));return}let h=ei({context:{schema:e.schema,value:t.editor.value,selection:t.at},blockIndexMap:t.editor.blockIndexMap});if(!h)throw Error(`Failed to get Slate Range for selection ${JSON.stringify(t.at)}`);if("backward"===t.direction&&"line"===t.unit){let e=c.KE.above(t.editor,{match:e=>c.Hg.isElement(e)&&c.KE.isBlock(t.editor,e),at:h});if(e){let[,n]=e,o=c.KE.range(t.editor,n,h.anchor),i=function(e,t){let n=c.KE.range(e,c.Q6.end(t)),o=Array.from(c.KE.positions(e,{at:t})),i=0,r=o.length,a=Math.floor(r/2);if(no(e,c.KE.range(e,o[i]),n))return c.KE.range(e,o[i],n);if(o.length<2)return c.KE.range(e,o[o.length-1],n);for(;a!==o.length&&a!==i;)no(e,c.KE.range(e,o[a]),n)?r=a:i=a,a=Math.floor((i+r)/2);return c.KE.range(e,o[i],n)}(t.editor,o);if(!c.Q6.isCollapsed(i))return void c.gB.delete(t.editor,{at:i})}}let u=(0,g.zS)(e,p)&&0===a;(0,c.JG)(t.editor,{at:h,reverse:"backward"===t.direction,unit:t.unit,hanging:u}),t.editor.selection&&(0,g.zS)(e,s)&&(0,g.zS)(e,p)&&(0,c.td)(t.editor,{anchor:t.editor.selection.focus,focus:t.editor.selection.focus})},"history.redo":({operation:e})=>{let t=e.editor,{redos:n}=t.history,o=t9(t);if(n.length>0){let e=n[n.length-1];if(t6("Redoing",e),e.operations.length>0){let n=o.filter(t=>t.time>=e.timestamp),i=e.operations;n.forEach(e=>{i=O(i.map(n=>ne(t,e.patch,n,e.snapshot,e.previousSnapshot)))});try{c.KE.withoutNormalizing(t,()=>{!function(e,t){let n=tu(e);tp.set(e,!0),t(),tp.set(e,n)}(t,()=>{nn(t,()=>{i.forEach(e=>{t.apply(e)})})})})}catch(e){t6("Could not perform redo step",e),o.splice(0,o.length),c.gB.deselect(t),t.history={undos:[],redos:[]},t8.set(t,!0),tp.set(t,!1),t.onChange();return}t.history.undos.push(e),t.history.redos.pop()}}},"history.undo":({operation:e})=>{let t=e.editor,{undos:n}=t.history,o=t9(t);if(n.length>0){let e=n[n.length-1];if(t6("Undoing",e),e.operations.length>0){let n=o.filter(t=>t.time>=e.timestamp),i=e.operations;n.forEach(e=>{i=O(i.map(n=>ne(t,e.patch,n,e.snapshot,e.previousSnapshot)))});let r=i.map(c.I.inverse).reverse();try{c.KE.withoutNormalizing(t,()=>{!function(e,t){let n=th(e);td.set(e,!0),t(),td.set(e,n)}(t,()=>{nn(t,()=>{r.forEach(e=>{t.apply(e)})})})})}catch(e){t6("Could not perform undo step",e),o.splice(0,o.length),c.gB.deselect(t),t.history={undos:[],redos:[]},t8.set(t,!0),td.set(t,!1),t.onChange();return}t.history.redos.push(e),t.history.undos.pop()}}},"insert.block":({context:e,operation:t})=>{let n=(0,f.rT)({block:t.block,context:e,options:{removeUnusedMarkDefs:!0,validateFields:!0}});if(!n)throw Error(`Failed to parse block ${JSON.stringify(t.block)}`);let o=H([n],{schemaTypes:e.schema})[0];if(!o)throw Error(`Failed to convert block to Slate fragment ${JSON.stringify(n)}`);!function({context:e,block:t,placement:n,select:o,editor:i}){let[r,a]=function({editor:e}){if(!e.selection)return[void 0,void 0];let t=c.Q6.start(e.selection);return Y({editor:e,point:t})}({editor:i}),[l,s]=function({editor:e}){if(!e.selection)return[void 0,void 0];let t=c.Q6.end(e.selection);return Y({editor:e,point:t})}({editor:i});if(i.selection&&r&&a&&l&&s)if("before"===n){let e=i.selection,n=c.Q6.start(e);c.gB.insertNodes(i,[t],{at:[n.path[0]],select:!1}),"start"===o?c.gB.select(i,c.KE.start(i,[n.path[0]])):"end"===o&&c.gB.select(i,c.KE.end(i,[n.path[0]]))}else if("after"===n){let e=i.selection,n=[c.Q6.end(e).path[0]+1];c.gB.insertNodes(i,[t],{at:n,select:!1}),"start"===o?c.gB.select(i,c.KE.start(i,n)):"end"===o&&c.gB.select(i,c.KE.end(i,n))}else{let n=i.selection,r=c.KE.start(i,s);if(c.Q6.isExpanded(n)&&!i.isTextBlock(t)){c.gB.delete(i,{at:n});let r=i.selection,[a,l]=J({editor:i});c.gB.insertNodes(i,[t],{voids:!0});let s=0===r.anchor.offset?c.Q6.transform(r,{type:"insert_node",node:t,path:[r.anchor.path[0]]}):r;"none"===o&&s&&c.gB.select(i,s),a&&W([a],e.schema)&&c.gB.removeNodes(i,{at:l});return}if(i.isTextBlock(l)&&i.isTextBlock(t)){let a=c.Q6.start(n);if(W([l],e.schema)){let e=i.selection;c.gB.insertNodes(i,[t],{at:s,select:!1}),c.gB.removeNodes(i,{at:c.wA.next(s)}),"start"===o?c.gB.select(i,a):"end"===o?c.gB.select(i,c.KE.end(i,s)):c.gB.select(i,e);return}let d=l.children.map(e=>e._key),p=l.markDefs?.map(e=>e._key)??[],h=new Map,u=t.markDefs?.map(t=>{if(p.includes(t._key)){let n=e.keyGenerator();return h.set(t._key,n),{...t,_key:n}}return t}),f=t.children.map(t=>{if((0,g.bl)(e,t)){let n=t.marks?.map(e=>h.get(e)||e)??[];if(!y(t.marks,n))return{...t,_key:d.includes(t._key)?e.keyGenerator():t._key,marks:n}}return d.includes(t._key)?{...t,_key:e.keyGenerator()}:t});c.gB.setNodes(i,{markDefs:[...l.markDefs??[],...u??[]]},{at:s});let m=y(t.children,f)?t:{...t,children:f};if("end"===o)return c.gB.insertFragment(i,[m],{voids:!0});c.gB.insertFragment(i,[m],{at:n,voids:!0}),"start"===o?c.gB.select(i,a):c.bR.equals(a,r)||c.gB.select(i,a)}else if(i.isTextBlock(l)){let r=c.KE.start(i,s),a=c.KE.end(i,s),d=c.Q6.start(n),p=c.Q6.end(n);if(c.Q6.isCollapsed(n)&&c.bR.equals(d,r))c.gB.insertNodes(i,[t],{at:s,select:!1}),("start"===o||"end"===o)&&c.gB.select(i,c.KE.start(i,s)),(0,u.wm)(e,l)&&c.gB.removeNodes(i,{at:c.wA.next(s)});else if(c.Q6.isCollapsed(n)&&c.bR.equals(p,a)){let e=[s[0]+1];c.gB.insertNodes(i,[t],{at:e,select:!1}),("start"===o||"end"===o)&&c.gB.select(i,c.KE.start(i,e))}else if(c.Q6.isExpanded(n)&&c.bR.equals(d,r)&&c.bR.equals(p,a))c.gB.insertFragment(i,[t],{at:n}),"start"===o?c.gB.select(i,c.KE.start(i,s)):"end"===o&&c.gB.select(i,c.KE.end(i,s));else if(c.Q6.isExpanded(n)&&c.bR.equals(d,r))c.gB.insertFragment(i,[t],{at:n}),"start"===o?c.gB.select(i,c.KE.start(i,s)):"end"===o&&c.gB.select(i,c.KE.end(i,s));else if(c.Q6.isExpanded(n)&&c.bR.equals(p,a))c.gB.insertFragment(i,[t],{at:n}),"start"===o?c.gB.select(i,c.KE.start(i,c.wA.next(s))):"end"===o&&c.gB.select(i,c.KE.end(i,c.wA.next(s)));else{let e=i.selection,[n]=function({editor:e}){let[t,n]=J({editor:e}),o=e.selection?.focus.path.at(1);if(!t||!n||void 0===o)return[void 0,void 0];try{let e=c.bP.child(t,o);return e?[e,[...n,o]]:[void 0,void 0]}catch{return[void 0,void 0]}}({editor:i});if(n&&i.isTextSpan(n))c.gB.splitNodes(i,{at:e}),c.gB.insertFragment(i,[t],{at:e}),"start"===o||"end"===o?c.gB.select(i,[s[0]+1]):c.gB.select(i,e);else{let n=[s[0]+1];c.gB.insertNodes(i,[t],{at:n,select:!1}),c.gB.select(i,e),"start"===o?c.gB.select(i,c.KE.start(i,n)):"end"===o&&c.gB.select(i,c.KE.end(i,n))}}}else{c.gB.insertNodes(i,[t],{select:!1});let e=[s[0]+1];"start"===o?c.gB.select(i,c.KE.start(i,e)):"end"===o&&c.gB.select(i,c.KE.end(i,e))}}else{"none"!==o&&h.wE.focus(i);let[r,a]=Z({editor:i});if("before"===n)c.gB.insertNodes(i,[t],{at:[0]}),"start"===o?c.gB.select(i,c.KE.start(i,[0])):"end"===o&&c.gB.select(i,c.KE.end(i,[0]));else if("after"===n){let e=a?[a[0]+1]:[0];c.gB.insertNodes(i,[t],{at:e}),"start"===o?c.gB.select(i,c.KE.start(i,e)):"end"===o&&c.gB.select(i,c.KE.end(i,e))}else{if(r&&W([r],e.schema)){c.gB.removeNodes(i,{at:a}),c.gB.insertNodes(i,[t],{at:a,select:!1}),c.gB.deselect(i),"start"===o?c.gB.select(i,c.KE.start(i,a)):"end"===o&&c.gB.select(i,c.KE.end(i,a));return}if(i.isTextBlock(t)&&r&&i.isTextBlock(r)){let e=c.KE.end(i,a);c.gB.insertFragment(i,[t],{at:c.KE.end(i,a)}),"start"===o?c.gB.select(i,e):"none"===o&&c.gB.deselect(i);return}let n=a?[a[0]+1]:[0];c.gB.insertNodes(i,[t],{at:n,select:!1}),"start"===o?c.gB.select(i,c.KE.start(i,n)):"end"===o&&c.gB.select(i,c.KE.end(i,n))}}}({context:e,block:o,placement:t.placement,select:t.select??"start",editor:t.editor})},"insert.child":({context:e,operation:t})=>{let n=t.editor.selection?.focus,o=n?.path.at(0),i=n?.path.at(1);if(void 0===o||void 0===i)throw Error("Unable to insert child without a focus");let[r,a]=J({editor:t.editor});if(!n||!r||!a)throw Error("Unable to insert child without a focus block");if(!(0,g.zS)(e,r))throw Error("Unable to insert child into a non-text block");let l=r.markDefs??[],s=new Map;for(let e of l)s.set(e._key,e._key);let d=(0,f.wr)({span:t.child,context:e,markDefKeyMap:s,options:{validateFields:!0}});if(d){let[e]=function({editor:e}){if(!e.selection)return[void 0,void 0];try{let[t]=J({editor:e});if(!t||!e.isTextBlock(t))return[void 0,void 0];let[n,o]=c.KE.node(e,e.selection.focus.path.slice(0,2));if(e.isTextSpan(n))return[n,o]}catch{}return[void 0,void 0]}({editor:t.editor});e?c.gB.insertNodes(t.editor,d,{at:n,select:!0}):c.gB.insertNodes(t.editor,d,{at:[o,i+1],select:!0}),h.hK.set(t.editor,t.editor.selection);return}let p=(0,f.lV)({inlineObject:t.child,context:e,options:{validateFields:!0}});if(p){let{_key:e,_type:n,...r}=p;c.gB.insertNodes(t.editor,{_key:e,_type:n,children:[{_key:U,_type:"span",text:"",marks:[]}],value:r,__inline:!0},{at:[o,i+1],select:!0});return}throw Error("Unable to parse child")},"insert.text":({operation:e})=>{c.gB.insertText(e.editor,e.text)},"move.backward":({operation:e})=>{c.gB.move(e.editor,{unit:"character",distance:e.distance,reverse:!0})},"move.block":({operation:e})=>{let t=(0,f.XE)({path:e.at});if(!t)throw Error("Failed to get block key from selection point");let n=e.editor.blockIndexMap.get(t);if(void 0===n)throw Error("Failed to get block index from block key");let o=(0,f.XE)({path:e.to});if(!o)throw Error("Failed to get block key from selection point");let i=e.editor.blockIndexMap.get(o);if(void 0===i)throw Error("Failed to get block index from block key");c.gB.moveNodes(e.editor,{at:[n],to:[i],mode:"highest"})},"move.forward":({operation:e})=>{c.gB.move(e.editor,{unit:"character",distance:e.distance})},select:({context:e,operation:t})=>{let n=ei({context:{schema:e.schema,value:t.editor.value,selection:t.at},blockIndexMap:t.editor.blockIndexMap});n?c.gB.select(t.editor,n):c.gB.deselect(t.editor),h.Rf.get(t.editor)&&h.dY.get(t.editor)&&h.Rf.set(t.editor,!1)}};function na({context:e,operation:t}){c.KE.withoutNormalizing(t.editor,()=>{try{switch(t.type){case"annotation.add":nr["annotation.add"]({context:e,operation:t});break;case"annotation.remove":nr["annotation.remove"]({context:e,operation:t});break;case"block.set":nr["block.set"]({context:e,operation:t});break;case"block.unset":nr["block.unset"]({context:e,operation:t});break;case"child.set":nr["child.set"]({context:e,operation:t});break;case"child.unset":nr["child.unset"]({context:e,operation:t});break;case"decorator.add":nr["decorator.add"]({context:e,operation:t});break;case"decorator.remove":nr["decorator.remove"]({context:e,operation:t});break;case"delete":nr.delete({context:e,operation:t});break;case"history.redo":nr["history.redo"]({context:e,operation:t});break;case"history.undo":nr["history.undo"]({context:e,operation:t});break;case"insert.block":nr["insert.block"]({context:e,operation:t});break;case"insert.child":nr["insert.child"]({context:e,operation:t});break;case"insert.text":nr["insert.text"]({context:e,operation:t});break;case"move.backward":nr["move.backward"]({context:e,operation:t});break;case"move.block":nr["move.block"]({context:e,operation:t});break;case"move.forward":nr["move.forward"]({context:e,operation:t});break;default:nr.select({context:e,operation:t})}}catch(e){console.error(Error(`Executing "${t.type}" failed due to: ${e.message}`))}})}let nl=new WeakMap;function ns(e,t){let n=nl.get(e);nl.set(e,!0),t(),nl.set(e,n)}function nc(e){return nl.get(e)??!1}function nd(e,t){let n=-1,o=e.find((e,o)=>{let i=(0,f.wE)(t[0])?e._key===t[0]._key:o===t[0];return i&&(n=o),i});if(o)return{node:o,index:n}}function np(e,t){let n=e.node;if(!c.Hg.isElement(n)||"children"!==t[1])return;let o=-1,i=n.children.find((e,n)=>{let i=(0,f.wE)(t[2])?e._key===t[2]._key:n===t[2];return i&&(o=n),i});if(i)return{node:i,index:o}}let nh=new WeakMap;function nu(e,t){var n;let o=(n=e,nh.get(n));nh.set(e,!1),t(),nh.set(e,o)}let nf=G("plugin:withPatches"),ny=G("plugin:withPlaceholderBlock"),ng=G("plugin:withSchemaTypes");function nm(e){return"object"==typeof e&&null!==e&&!("_type"in e)&&"children"in e&&Array.isArray(e.children)}function nk(e,t){return(0,f.Kk)(t)&&t._type===e.schema.block.name}function nv(e,t){return"object"==typeof t&&null!==t&&!("children"in t)&&("_type"in t?t._type===e.schema.span.name:"text"in t)}function nb(e){return"object"==typeof e&&null!==e&&"text"in e&&"string"==typeof e.text}function nx(e,t){let n=t.at(0);if(void 0!==n&&1===t.length)return e.children.at(n)}function n_(e,t,n){if(0===n.length)return t;if(1===n.length)return nx(t,n);if(2===n.length){let o=nx(t,n.slice(0,1));return o&&nk(e,o)&&o.children.at(n[1])||void 0}}function nE(e,t,n){let o=n_(e,t,n);if(o&&nv(e,o))return o}function nw(e,t,n){if(0===n.length)return;let o=n.slice(0,-1);if(0===o.length)return t;let i=o.at(0);if(void 0===i||1!==o.length)return;let r=t.children.at(i);if(r&&nk(e,r))return r}let nS=G("setup");function nB(e,t){return{getBlockNodes:e=>(function(e,t){if(!t.context.selection)return[];let n=ei(t);if(!n)return[];try{return Array.from(c.KE.nodes(e,{at:n,mode:"highest",match:e=>!c.KE.isEditor(e)})).map(([t])=>h.wE.toDOMNode(e,t))}catch{return[]}})(t,e),getChildNodes:e=>(function(e,t){if(!t.context.selection)return[];let n=ei(t);if(!n)return[];try{return Array.from(c.KE.nodes(e,{at:n,mode:"lowest",match:e=>!c.KE.isEditor(e)})).map(([t])=>h.wE.toDOMNode(e,t))}catch{return[]}})(t,e),setDragGhost:({event:t,ghost:n})=>(function({sendBack:e,event:t,ghost:n}){t.originEvent.dataTransfer.setDragImage(n.element,n.x,n.y),e({type:"set drag ghost",ghost:n.element})})({sendBack:e,event:t,ghost:n})}}let nK=(0,v.Ke)({on:"annotation.add",guard:({snapshot:e})=>{if(!(0,k.WV)(e))return!1;let t=(0,m.UH)(e);return!!t&&!!(0,k.gR)({context:{...e.context,selection:t}})&&{caretWordSelection:t}},actions:[({event:e},{caretWordSelection:t})=>[(0,v.xl)({type:"select",at:t}),(0,v.xl)({type:"annotation.add",annotation:e.annotation})]]}),nT=(0,v.Ke)({on:"annotation.add",guard:({snapshot:e,event:t})=>(0,m.kK)(t.annotation.name,{mode:"partial"})(e),actions:[({event:e})=>[(0,v.xl)({type:"annotation.remove",annotation:e.annotation}),(0,v.xl)(e)]]}),nA={arrowDown:(0,R.mn)({default:[{key:"ArrowDown",alt:!1,ctrl:!1,meta:!1,shift:!1}]}),arrowUp:(0,R.mn)({default:[{key:"ArrowUp",alt:!1,ctrl:!1,meta:!1,shift:!1}]}),backspace:(0,R.mn)({default:[{key:"Backspace",alt:!1,ctrl:!1,meta:!1,shift:!1}]}),break:(0,R.mn)({default:[{key:"Enter",shift:!1}]}),lineBreak:(0,R.mn)({default:[{key:"Enter",shift:!0}]}),decorators:{strong:R.Cr,em:R.TN,underline:R.V1,code:R.aY},delete:(0,R.mn)({default:[{key:"Delete",alt:!1,ctrl:!1,meta:!1,shift:!1}]}),history:{undo:R.tN,redo:R.ZS},tab:(0,R.mn)({default:[{key:"Tab",alt:!1,ctrl:!1,meta:!1,shift:!1}]}),shiftTab:(0,R.mn)({default:[{key:"Tab",alt:!1,ctrl:!1,meta:!1,shift:!0}]})},nO=(0,v.Ke)({on:"keyboard.keydown",guard:({snapshot:e,event:t})=>{if(!nA.arrowDown.guard(t.originEvent)||!(0,k.WV)(e))return!1;let n=(0,m.lA)(e),o=(0,m.RL)(e);return n&&!o},actions:[({snapshot:e})=>[(0,v.xl)({type:"insert.block",block:{_type:e.context.schema.block.name},placement:"after"})]]}),nD=(0,v.Ke)({on:"keyboard.keydown",guard:({snapshot:e,event:t})=>{if(!nA.arrowUp.guard(t.originEvent)||!(0,k.WV)(e))return!1;let n=(0,m.lA)(e),o=(0,m.HA)(e);return n&&!o},actions:[({snapshot:e})=>[(0,v.xl)({type:"insert.block",block:{_type:e.context.schema.block.name},placement:"before"})]]}),nN=(0,v.Ke)({on:"insert.break",guard:({snapshot:e})=>{let t=(0,m.lA)(e);return(0,k.WV)(e)&&void 0!==t},actions:[({snapshot:e})=>[(0,v.xl)({type:"insert.block",block:{_type:e.context.schema.block.name},placement:"after"})]]}),nI=(0,v.Ke)({on:"mouse.click",guard:({snapshot:e,event:t})=>{if(e.context.readOnly||e.context.selection&&!(0,k.WV)(e))return!1;let n=(0,m.lA)({...e,context:{...e.context,selection:t.position.selection}}),o=(0,m.HA)({...e,context:{...e.context,selection:t.position.selection}});return t.position.isEditor&&"start"===t.position.block&&n&&!o},actions:[({snapshot:e,event:t})=>[(0,v.xl)({type:"select",at:t.position.selection}),(0,v.xl)({type:"insert.block",block:{_type:e.context.schema.block.name},placement:"before",select:"start"})]]}),nM=(0,v.Ke)({on:"mouse.click",guard:({snapshot:e,event:t})=>{if(e.context.readOnly||e.context.selection&&!(0,k.WV)(e))return!1;let n=(0,m.lA)({...e,context:{...e.context,selection:t.position.selection}}),o=(0,m.RL)({...e,context:{...e.context,selection:t.position.selection}});return t.position.isEditor&&"end"===t.position.block&&n&&!o},actions:[({snapshot:e,event:t})=>[(0,v.xl)({type:"select",at:t.position.selection}),(0,v.xl)({type:"insert.block",block:{_type:e.context.schema.block.name},placement:"after",select:"start"})]]}),nj={arrowDownOnLonelyBlockObject:nO,arrowUpOnLonelyBlockObject:nD,breakingBlockObject:nN,clickingAboveLonelyBlockObject:nI,clickingBelowLonelyBlockObject:nM,deletingEmptyTextBlockAfterBlockObject:(0,v.Ke)({on:"delete.backward",guard:({snapshot:e})=>{let t=(0,k.hH)(e),n=(0,k.WV)(e),o=(0,m.HA)(e);return!!t&&!!n&&!!o&&!(!(0,u.wm)(e.context,t.node)||(0,g.zS)(e.context,o.node))&&{focusTextBlock:t,previousBlock:o}},actions:[(e,{focusTextBlock:t,previousBlock:n})=>[(0,v.xl)({type:"delete.block",at:t.path}),(0,v.xl)({type:"select",at:{anchor:{path:n.path,offset:0},focus:{path:n.path,offset:0}}})]]}),deletingEmptyTextBlockBeforeBlockObject:(0,v.Ke)({on:"delete.forward",guard:({snapshot:e})=>{let t=(0,k.hH)(e),n=(0,k.WV)(e),o=(0,m.RL)(e);return!!t&&!!n&&!!o&&!(!(0,u.wm)(e.context,t.node)||(0,g.zS)(e.context,o.node))&&{focusTextBlock:t,nextBlock:o}},actions:[(e,{focusTextBlock:t,nextBlock:n})=>[(0,v.xl)({type:"delete.block",at:t.path}),(0,v.xl)({type:"select",at:{anchor:{path:n.path,offset:0},focus:{path:n.path,offset:0}}})]]})},nC={strongShortcut:(0,v.Ke)({on:"keyboard.keydown",guard:({snapshot:e,event:t})=>nA.decorators.strong.guard(t.originEvent)&&e.context.schema.decorators.some(e=>"strong"===e.name),actions:[()=>[(0,v.xl)({type:"decorator.toggle",decorator:"strong"})]]}),emShortcut:(0,v.Ke)({on:"keyboard.keydown",guard:({snapshot:e,event:t})=>nA.decorators.em.guard(t.originEvent)&&e.context.schema.decorators.some(e=>"em"===e.name),actions:[()=>[(0,v.xl)({type:"decorator.toggle",decorator:"em"})]]}),underlineShortcut:(0,v.Ke)({on:"keyboard.keydown",guard:({snapshot:e,event:t})=>nA.decorators.underline.guard(t.originEvent)&&e.context.schema.decorators.some(e=>"underline"===e.name),actions:[()=>[(0,v.xl)({type:"decorator.toggle",decorator:"underline"})]]}),codeShortcut:(0,v.Ke)({on:"keyboard.keydown",guard:({snapshot:e,event:t})=>nA.decorators.code.guard(t.originEvent)&&e.context.schema.decorators.some(e=>"code"===e.name),actions:[()=>[(0,v.xl)({type:"decorator.toggle",decorator:"code"})]]})};function nP(e){if(0===e.length)return new DOMRect(0,0,0,0);let t=e.filter(e=>e instanceof Element),n=t.at(0)?.getBoundingClientRect();if(!n)return new DOMRect(0,0,0,0);let o=n.left,i=n.top,r=n.right,a=n.bottom;for(let e=1;e<t.length;e++){let n=t[e].getBoundingClientRect();o=Math.min(o,n.left),i=Math.min(i,n.top),r=Math.max(r,n.right),a=Math.max(a,n.bottom)}return new DOMRect(o,i,r-o,a-i)}let nz=[(0,v.Ke)({on:"drag.dragstart",guard:({snapshot:e,dom:t,event:n})=>{let o=eh({snapshot:e,eventSelection:n.position.selection}),i=(0,m.iE)({...e,context:{...e.context,selection:o}}),r={blockNodes:t.getBlockNodes({...e,context:{...e.context,selection:o}}),childNodes:t.getChildNodes({...e,context:{...e.context,selection:o}})};return{dragSelection:o,draggedDomNodes:r,selectingEntireBlocks:i}},actions:[({dom:e,event:t},{dragSelection:n,draggedDomNodes:o,selectingEntireBlocks:i})=>{let r=document.createElement("div");if(i){for(let e of o.blockNodes.map(e=>e.cloneNode(!0)))e instanceof HTMLElement&&(e.style.position="relative"),r.appendChild(e);let i=r.querySelector("[data-pt-drag-ghost-element]");if(i&&r.replaceChildren(i),r.setAttribute("data-dragged",""),r.style.position="absolute",r.style.left="-99999px",r.style.boxSizing="border-box",document.body.appendChild(r),i){let o=i.getBoundingClientRect(),a=t.originEvent.clientX-o.left,l=t.originEvent.clientY-o.top;return r.style.width=`${o.width}px`,r.style.height=`${o.height}px`,[(0,v.xl)({type:"select",at:n}),(0,v.QZ)(()=>{e.setDragGhost({event:t,ghost:{element:r,x:a,y:l}})}),(0,v.sY)(t)]}{let i=nP(o.blockNodes),a=t.originEvent.clientX-i.left,l=t.originEvent.clientY-i.top;return r.style.width=`${i.width}px`,r.style.height=`${i.height}px`,[(0,v.xl)({type:"select",at:n}),(0,v.QZ)(()=>{e.setDragGhost({event:t,ghost:{element:r,x:a,y:l}})}),(0,v.sY)(t)]}}{for(let e of o.childNodes.map(e=>e.cloneNode(!0)))r.appendChild(e);r.style.position="absolute",r.style.left="-99999px",r.style.boxSizing="border-box",document.body.appendChild(r);let i=nP(o.childNodes),a=t.originEvent.clientX-i.left,l=t.originEvent.clientY-i.top;return r.style.width=`${i.width}px`,r.style.height=`${i.height}px`,[(0,v.xl)({type:"select",at:n}),(0,v.QZ)(()=>{e.setDragGhost({event:t,ghost:{element:r,x:a,y:l}})}),(0,v.sY)(t)]}}]}),(0,v.Ke)({on:"drag.dragover",guard:({snapshot:e,event:t})=>{let n=t.dragOrigin;return!!n&&(0,m.Q)(t.position.selection)({...e,context:{...e.context,selection:n.selection}})},actions:[]}),(0,v.Ke)({on:"drag.drop",guard:({snapshot:e,event:t})=>{let n=t.dragOrigin,o=t.position.selection;return!!n&&(0,m.Q)(o)({...e,context:{...e.context,selection:n.selection}})},actions:[]}),(0,v.Ke)({on:"drag.drop",guard:({event:e})=>void 0!==e.dragOrigin,actions:[({event:e})=>[(0,v.xl)({type:"deserialize",originEvent:e})]]}),(0,v.Ke)({on:"drag.drop",actions:[({event:e})=>[(0,v.xl)({type:"select",at:e.position.selection}),(0,v.xl)({type:"deserialize",originEvent:e})]]}),(0,v.Ke)({on:"deserialization.success",guard:({snapshot:e,event:t})=>{if("drag.drop"!==t.originEvent.type||void 0===t.originEvent.dragOrigin)return!1;let n=t.originEvent.dragOrigin,o=eh({eventSelection:n.selection,snapshot:e}),i=t.originEvent.position.selection,r=!!n&&(0,m.Q)(i)({...e,context:{...e.context,selection:o}}),a=(0,m.iE)({...e,context:{...e.context,selection:o}}),l=(0,m.wx)({...e,context:{...e.context,selection:o}});return!r&&{dropPosition:i,draggingEntireBlocks:a,draggedBlocks:l,dragOrigin:n,originEvent:t.originEvent}},actions:[({event:e},{draggingEntireBlocks:t,draggedBlocks:n,dragOrigin:o,dropPosition:i,originEvent:r})=>[(0,v.xl)({type:"select",at:i}),...t?n.map(e=>(0,v.xl)({type:"delete.block",at:e.path})):[(0,v.xl)({type:"delete",at:o.selection})],(0,v.xl)({type:"insert.blocks",blocks:e.data,placement:t?"start"===r.position.block?"before":"end"===r.position.block?"after":"auto":"auto"})]]})],nR=[(0,v.Ke)({on:"insert.text",guard:({snapshot:e})=>{if(!(0,k.d2)(e))return!1;let t=(0,m.JB)(e),n=(0,m.rm)(e),o=(0,m.N2)(e);if(t&&"unchanged"===t.state){let o=(t.marks??[]).filter(t=>e.context.schema.decorators.map(e=>e.name).includes(t));if(o.length===n.length&&o.every(e=>n.includes(e)))return!1}return{activeDecorators:n,activeAnnotations:o}},actions:[({snapshot:e,event:t},{activeDecorators:n,activeAnnotations:o})=>[(0,v.xl)({type:"insert.child",child:{_type:e.context.schema.span.name,text:t.text,marks:[...n,...o]}})]]})],n$=(0,v.Ke)({on:"insert.break",guard:({snapshot:e})=>{let t=(0,k.hH)(e),n=(0,k.WV)(e);if(!e.context.selection||!t||!n)return!1;let o=(0,m.Qm)(t)(e),i=t.node.listItem,r=t.node.level;return!!o&&{focusListItem:i,focusLevel:r}},actions:[({snapshot:e},{focusListItem:t,focusLevel:n})=>[(0,v.xl)({type:"insert.block",block:{_type:e.context.schema.block.name,children:[{_type:e.context.schema.span.name,text:"",marks:[]}],markDefs:[],listItem:t,level:n,style:e.context.schema.styles[0]?.name},placement:"after"})]]}),nL=(0,v.Ke)({on:"insert.break",guard:({snapshot:e})=>{let t=(0,k.hH)(e),n=(0,k.WV)(e);if(!e.context.selection||!t||!n)return!1;let o=(0,k.d2)(e),i=o?.node.marks?.filter(t=>e.context.schema.decorators.some(e=>e.name===t)??[]),r=o?.node.marks?.filter(t=>!e.context.schema.decorators.some(e=>e.name===t))??[],a=t.node.listItem,l=t.node.level;return!!(0,m.HX)(t)(e)&&{focusAnnotations:r,focusDecorators:i,focusListItem:a,focusLevel:l}},actions:[({snapshot:e},{focusAnnotations:t,focusDecorators:n,focusListItem:o,focusLevel:i})=>[(0,v.xl)({type:"insert.block",block:{_type:e.context.schema.block.name,children:[{_type:e.context.schema.span.name,marks:0===t.length?n:[],text:""}],listItem:o,level:i,style:e.context.schema.styles[0]?.name},placement:"before",select:"none"})]]}),nV=(0,v.Ke)({on:"insert.break",guard:({snapshot:e})=>{if(!e.context.selection||!(0,k.gR)(e))return!1;let t=(0,m.W2)(e),n=(0,m.qm)(e);if(!t||!n)return!1;let o=(0,f.u3)({context:e.context,block:t}),i=(0,f.Jo)(e.context.selection),r=(0,u.J8)({context:e.context,block:n}),a=(0,f.aR)(e.context.selection);return!!((0,u._Q)(o,i)&&(0,u._Q)(r,a))&&{selection:e.context.selection}},actions:[(e,{selection:t})=>[(0,v.xl)({type:"delete",at:t})]]}),nG={breakingAtTheEndOfTextBlock:n$,breakingAtTheStartOfTextBlock:nL,breakingEntireDocument:nV,breakingEntireBlocks:(0,v.Ke)({on:"insert.break",guard:({snapshot:e})=>{if(!e.context.selection||!(0,k.gR)(e))return!1;let t=(0,m.wx)(e),n=(0,m.GB)(e),o=(0,m.P$)(e);if(!n||!o)return!1;let i=(0,f.u3)({context:e.context,block:n}),r=(0,f.Jo)(e.context.selection),a=(0,u.J8)({context:e.context,block:o}),l=(0,f.aR)(e.context.selection);return!!((0,u._Q)(r,i)&&(0,u._Q)(l,a))&&{selectedBlocks:t}},actions:[({snapshot:e},{selectedBlocks:t})=>[(0,v.xl)({type:"insert.block",block:{_type:e.context.schema.block.name,children:[{_type:e.context.schema.span.name,text:"",marks:[]}]},placement:"before",select:"start"}),...t.map(e=>(0,v.xl)({type:"delete.block",at:e.path}))]]}),breakingInlineObject:(0,v.Ke)({on:"insert.break",guard:({snapshot:e})=>{let t=(0,k.WV)(e),n=(0,m.Rt)(e);return t&&n},actions:[()=>[(0,v.xl)({type:"move.forward",distance:1}),(0,v.xl)({type:"split"})]]})};function nU({context:e,block:t}){return!!(0,g.zS)(e,t)&&!!e.selection&&!!(0,u.WV)(e.selection)&&(0,f.qX)(e.selection.focus)===t.children[0]._key&&0===e.selection.focus.offset}let nF=(0,v.Ke)({on:"delete.backward",guard:({snapshot:e})=>{let t=(0,k.hH)(e);return!!t&&1===t.node.level&&!!nU({context:e.context,block:t.node})&&{focusTextBlock:t}},actions:[(e,{focusTextBlock:t})=>[(0,v.xl)({type:"block.unset",props:["listItem","level"],at:t.path})]]}),nH=(0,v.Ke)({on:"delete.backward",guard:({snapshot:e})=>{let t=(0,k.WV)(e),n=(0,k.hH)(e),o=(0,k.d2)(e);return!!t&&!!n&&!!o&&n.node.children[0]._key===o.node._key&&e.context.selection?.focus.offset===0&&void 0!==n.node.level&&n.node.level>1&&{focusTextBlock:n,level:n.node.level-1}},actions:[(e,{focusTextBlock:t,level:n})=>[(0,v.xl)({type:"block.set",props:{level:n},at:t.path})]]}),nQ=(0,v.Ke)({on:"delete.forward",guard:({snapshot:e})=>{let t=(0,m.iL)(e),n=(0,m.RL)(e);return!!t&&!!n&&!!(0,g.zS)(e.context,n.node)&&!!(0,u.wm)(e.context,t.node)&&{focusListBlock:t,nextBlock:n}},actions:[(e,{nextBlock:t})=>[(0,v.xl)({type:"insert.block",block:t.node,placement:"auto",select:"start"}),(0,v.xl)({type:"delete.block",at:t.path})]]}),nW=(0,v.Ke)({on:"delete.backward",guard:({snapshot:e})=>{let t=(0,k.hH)(e),n=(0,m.HA)(e);return!!t&&!!n&&!!nU({context:e.context,block:t.node})&&!!(0,f.Eg)(e.context,n.node)&&!!(0,u.wm)(e.context,n.node)&&{focusTextBlock:t,previousBlockEndPoint:(0,u.J8)({context:e.context,block:n})}},actions:[(e,{focusTextBlock:t,previousBlockEndPoint:n})=>[(0,v.xl)({type:"select",at:{anchor:n,focus:n}}),(0,v.xl)({type:"insert.block",block:t.node,placement:"auto",select:"start"}),(0,v.xl)({type:"delete.block",at:t.path})]]}),nJ=(0,v.Ke)({on:"delete",guard:({snapshot:e,event:t})=>{let n=(0,m.wx)({...e,context:{...e.context,selection:t.at}});if(n.length<2)return!1;let o=n.at(0)?.node,i=n.slice(1,-1),r=n.at(-1)?.node;if(!(0,f.Eg)(e.context,o)||!(0,f.Eg)(e.context,r))return!1;let a=(0,k.Jo)({context:{...e.context,selection:t.at}}),l=(0,m.aR)({context:{...e.context,selection:t.at}});if(!a||!l)return!1;let s=(0,f.u3)({context:e.context,block:{node:o,path:[{_key:o._key}]}});if(!(0,u._Q)(a,s))return!1;let c=(0,u.J8)({context:e.context,block:{node:o,path:[{_key:o._key}]}}),d=(0,u.J8)({context:e.context,block:{node:r,path:[{_key:r._key}]}}),p=(0,M.B)({context:{schema:e.context.schema,selection:{anchor:l,focus:d}},block:r});return{startBlockStartPoint:s,startBlockEndPoint:c,middleBlocks:i,endBlock:r,slicedEndBlock:p}},actions:[(e,{startBlockStartPoint:t,startBlockEndPoint:n,middleBlocks:o,endBlock:i,slicedEndBlock:r})=>[...o.map(e=>(0,v.xl)({type:"delete.block",at:e.path})),(0,v.xl)({type:"delete.block",at:[{_key:i._key}]}),(0,v.xl)({type:"select",at:{anchor:n,focus:n}}),(0,v.xl)({type:"insert.block",block:r,placement:"auto",select:"none"}),(0,v.xl)({type:"delete",at:{anchor:t,focus:n}})]]}),nY=(0,v.Ke)({on:"insert.break",guard:({snapshot:e})=>{let t=(0,k.WV)(e),n=(0,m.iL)(e);return!!t&&!!n&&!!(0,u.wm)(e.context,n.node)&&{focusListBlock:n}},actions:[(e,{focusListBlock:t})=>[(0,v.xl)({type:"block.unset",props:["listItem","level"],at:t.path})]]}),nq=(0,v.Ke)({on:"keyboard.keydown",guard:({snapshot:e,event:t})=>{if(!nA.tab.guard(t.originEvent))return!1;let n=(0,m.wx)(e),o=n.flatMap(t=>(0,f.Eg)(e.context,t.node)?[{node:t.node,path:t.path}]:[]);return o.length===n.length&&{selectedListBlocks:o}},actions:[(e,{selectedListBlocks:t})=>t.map(e=>(0,v.xl)({type:"block.set",props:{level:Math.min(10,Math.max(1,e.node.level+1))},at:e.path}))]}),nZ=(0,v.Ke)({on:"keyboard.keydown",guard:({snapshot:e,event:t})=>{if(!nA.shiftTab.guard(t.originEvent))return!1;let n=(0,m.wx)(e),o=n.flatMap(t=>(0,f.Eg)(e.context,t.node)?[{node:t.node,path:t.path}]:[]);return o.length===n.length&&{selectedListBlocks:o}},actions:[(e,{selectedListBlocks:t})=>t.map(e=>(0,v.xl)({type:"block.set",props:{level:Math.min(10,Math.max(1,e.node.level-1))},at:e.path}))]}),nX=(0,v.Ke)({on:"insert.blocks",guard:({snapshot:e,event:t})=>{let n=(0,m.iL)(e);if(!n)return!1;let o=t.blocks.at(0),i=t.blocks.at(1),r=(0,f.Eg)(e.context,o)?o:(0,f.Eg)(e.context,i)?i:void 0;if(!r)return!1;let a=n.node.level-r.level;return 0!==a&&{levelDifference:a,insertedListBlock:r}},actions:[({snapshot:e,event:t},{levelDifference:n,insertedListBlock:o})=>{let i=!0,r=!1;return[(0,v.xl)({...t,blocks:t.blocks.map(t=>(t._key===o._key&&(r=!0),i?r&&i&&(0,f.Eg)(e.context,t)?{...t,level:Math.min(10,Math.max(1,t.level+n))}:(r&&(i=!1),t):t))})]}]}),n0={clearListOnBackspace:nF,unindentListOnBackspace:nH,mergeTextIntoListOnDelete:nQ,mergeTextIntoListOnBackspace:nW,deletingListFromStart:nJ,clearListOnEnter:nY,indentListOnTab:nq,unindentListOnShiftTab:nZ,inheritListLevel:nX,inheritListItem:(0,v.Ke)({on:"insert.blocks",guard:({snapshot:e,event:t})=>{let n=(0,m.iL)(e);if(!n||(0,u.wm)(e.context,n.node))return!1;let o=t.blocks.at(0),i=t.blocks.at(1),r=(0,f.Eg)(e.context,o)?o:(0,f.Eg)(e.context,i)?i:void 0;return!!r&&n.node.level===r.level&&n.node.listItem!==r.listItem&&{listItem:n.node.listItem,insertedListBlock:r}},actions:[({snapshot:e,event:t},{listItem:n,insertedListBlock:o})=>{let i=!0,r=!1;return[(0,v.xl)({...t,blocks:t.blocks.map(t=>(t._key===o._key&&(r=!0),i?r&&i&&(0,f.Eg)(e.context,t)?{...t,listItem:t.level===o.level?n:t.listItem}:(r&&(i=!1),t):t))})]}]}),inheritListProperties:(0,v.Ke)({on:"insert.block",guard:({snapshot:e,event:t})=>{if("auto"!==t.placement||t.block._type!==e.context.schema.block.name||void 0!==t.block.listItem)return!1;let n=(0,m.iL)(e);return!!n&&!!(0,u.wm)(e.context,n.node)&&{level:n.node.level,listItem:n.node.listItem}},actions:[({event:e},{level:t,listItem:n})=>[(0,v.xl)({...e,block:{...e.block,level:t,listItem:n}})]]})},n1=[nK,nT,nC.strongShortcut,nC.emShortcut,nC.underlineShortcut,nC.codeShortcut,...nz,nj.clickingAboveLonelyBlockObject,nj.clickingBelowLonelyBlockObject,nj.arrowDownOnLonelyBlockObject,nj.arrowUpOnLonelyBlockObject,nj.breakingBlockObject,nj.deletingEmptyTextBlockAfterBlockObject,nj.deletingEmptyTextBlockBeforeBlockObject,...nR,n0.clearListOnBackspace,n0.unindentListOnBackspace,n0.mergeTextIntoListOnDelete,n0.mergeTextIntoListOnBackspace,n0.deletingListFromStart,n0.clearListOnEnter,n0.indentListOnTab,n0.unindentListOnShiftTab,n0.inheritListLevel,n0.inheritListItem,n0.inheritListProperties,nG.breakingAtTheEndOfTextBlock,nG.breakingAtTheStartOfTextBlock,nG.breakingEntireDocument,nG.breakingEntireBlocks,nG.breakingInlineObject].map(e=>({behavior:e,priority:ep})),n2=[(0,v.Ke)({on:"annotation.set",guard:({snapshot:e,event:t})=>{let n=t.at[0]._key,o=t.at[2]._key,i=(0,k.hH)({...e,context:{...e.context,selection:{anchor:{path:[{_key:n}],offset:0},focus:{path:[{_key:n}],offset:0}}}});return!!i&&{blockKey:n,updatedMarkDefs:i.node.markDefs?.map(e=>e._key===o?{...e,...t.props}:e)}},actions:[(e,{blockKey:t,updatedMarkDefs:n})=>[(0,v.xl)({type:"block.set",at:[{_key:t}],props:{markDefs:n}})]]}),(0,v.Ke)({on:"annotation.toggle",guard:({snapshot:e,event:t})=>(0,m.kK)(t.annotation.name)(e),actions:[({event:e})=>[(0,v.xl)({type:"annotation.remove",annotation:e.annotation})]]}),(0,v.Ke)({on:"annotation.toggle",guard:({snapshot:e,event:t})=>!(0,m.kK)(t.annotation.name)(e),actions:[({event:e})=>[(0,v.xl)({type:"annotation.add",annotation:e.annotation})]]})],n3=[(0,v.Ke)({on:"decorator.toggle",guard:({snapshot:e,event:t})=>(0,m.Y1)(t.decorator)(e),actions:[({event:e})=>[(0,v.xl)({type:"decorator.remove",decorator:e.decorator})]]}),(0,v.Ke)({on:"decorator.toggle",guard:({snapshot:e,event:t})=>{let n=t.at?(0,I.lv)({context:e.context,offsets:t.at}):null;return n?!(0,m.Y1)(t.decorator)({...e,context:{...e.context,selection:n}}):!(0,m.Y1)(t.decorator)(e)},actions:[({event:e})=>[(0,v.xl)({...e,type:"decorator.add"})]]})],n4=[(0,v.Ke)({on:"delete.backward",guard:({snapshot:e})=>!!e.context.selection&&{selection:e.context.selection},actions:[({event:e},{selection:t})=>[(0,v.xl)({type:"delete",direction:"backward",unit:e.unit,at:t})]]}),(0,v.Ke)({on:"delete",guard:({snapshot:e,event:t})=>{if("backward"!==t.direction)return!1;let n=(0,m.HA)(e),o=(0,k.hH)(e);if(!n||!o||!(0,m.HX)(o)(e))return!1;let i=(0,u.J8)({context:e.context,block:n});return!!(0,g.zS)(e.context,n.node)&&{previousBlockEndPoint:i,focusTextBlock:o}},actions:[(e,{previousBlockEndPoint:t,focusTextBlock:n})=>[(0,v.xl)({type:"delete.block",at:n.path}),(0,v.xl)({type:"select",at:{anchor:t,focus:t}}),(0,v.xl)({type:"insert.block",block:n.node,placement:"auto",select:"start"})]]}),(0,v.Ke)({on:"delete.forward",guard:({snapshot:e})=>!!e.context.selection&&{selection:e.context.selection},actions:[({event:e},{selection:t})=>[(0,v.xl)({type:"delete",direction:"forward",unit:e.unit,at:t})]]}),(0,v.Ke)({on:"delete",guard:({snapshot:e,event:t})=>{if("forward"!==t.direction)return!1;let n=(0,m.RL)({...e,context:{...e.context,selection:t.at}}),o=(0,k.hH)({...e,context:{...e.context,selection:t.at}});return!!n&&!!o&&!!(0,u.wm)(e.context,o.node)&&{focusTextBlock:o,nextBlockStartPoint:(0,f.u3)({context:e.context,block:n})}},actions:[(e,{focusTextBlock:t,nextBlockStartPoint:n})=>[(0,v.xl)({type:"delete.block",at:t.path}),(0,v.xl)({type:"select",at:{anchor:n,focus:n}})]]}),(0,v.Ke)({on:"delete",guard:({snapshot:e,event:t})=>{if("forward"!==t.direction)return!1;let n=(0,m.RL)(e),o=(0,k.hH)(e);return!!n&&!!o&&!!(0,m.Qm)(o)(e)&&!!(0,g.zS)(e.context,n.node)&&{nextBlock:n}},actions:[(e,{nextBlock:t})=>[(0,v.xl)({type:"delete.block",at:t.path}),(0,v.xl)({type:"insert.block",block:t.node,placement:"auto",select:"none"})]]}),(0,v.Ke)({on:"delete.block",actions:[({event:e})=>[(0,v.xl)({type:"delete",at:{anchor:{path:e.at,offset:0},focus:{path:e.at,offset:0}},unit:"block"})]]}),(0,v.Ke)({on:"delete.child",guard:({snapshot:e,event:t})=>{let n=(0,k.jR)({...e,context:{...e.context,selection:{anchor:{path:t.at,offset:0},focus:{path:t.at,offset:0}}}});return!!n&&((0,g.bl)(e.context,n.node)?{selection:{anchor:{path:t.at,offset:0},focus:{path:t.at,offset:n.node.text.length}}}:{selection:{anchor:{path:t.at,offset:0},focus:{path:t.at,offset:0}}})},actions:[(e,{selection:t})=>[(0,v.xl)({type:"delete",at:t})]]}),(0,v.Ke)({on:"delete.text",guard:({snapshot:e,event:t})=>{let n=(0,I.lv)({context:e.context,offsets:t.at});if(!n)return!1;let o=(0,m.bu)({...e,context:{...e.context,value:e.context.value,selection:n}});return!!o&&{selection:o}},actions:[(e,{selection:t})=>[(0,v.xl)({type:"delete",at:t})]]})],n6=[(0,v.Ke)({on:"deserialize",guard:({event:e})=>{let t=e.originEvent.originEvent.dataTransfer.getData("application/x-portable-text");if(t)return{type:"deserialize.data",mimeType:"application/x-portable-text",data:t,originEvent:e.originEvent};let n=e.originEvent.originEvent.dataTransfer.getData("application/json");if(n)return{type:"deserialize.data",mimeType:"application/json",data:n,originEvent:e.originEvent};let o=e.originEvent.originEvent.dataTransfer.getData("text/html");if(o)return{type:"deserialize.data",mimeType:"text/html",data:o,originEvent:e.originEvent};let i=e.originEvent.originEvent.dataTransfer.getData("text/plain");return!!i&&{type:"deserialize.data",mimeType:"text/plain",data:i,originEvent:e.originEvent}},actions:[(e,t)=>[(0,v.xl)(t)]]}),(0,v.Ke)({on:"deserialize",actions:[({event:e})=>[(0,v.xl)({type:"deserialization.failure",mimeType:"*/*",reason:"No Behavior was able to handle the incoming data",originEvent:e.originEvent})]]}),(0,v.Ke)({on:"deserialize.data",guard:({snapshot:e,event:t})=>{let n=e.context.converters.find(e=>e.mimeType===t.mimeType);return!!n&&n.deserialize({snapshot:e,event:{type:"deserialize",data:t.data}})},actions:[({event:e},t)=>[(0,v.xl)({...t,originEvent:e.originEvent})]]}),(0,v.Ke)({on:"deserialization.success",guard:({snapshot:e,event:t})=>{if((0,k.hH)(e)&&"text/plain"===t.mimeType&&"clipboard.paste"===t.originEvent.type){let n=(0,m.rm)(e);return{activeAnnotations:(0,m.Bg)(e),activeDecorators:n,textRuns:t.data.flatMap(t=>(0,g.zS)(e.context,t)?[(0,f.so)(t)]:[])}}return!1},actions:[(e,{activeAnnotations:t,activeDecorators:n,textRuns:o})=>o.flatMap((e,i)=>i!==o.length-1?[(0,v.xl)({type:"insert.span",text:e,decorators:n,annotations:t.map(({_key:e,_type:t,...n})=>({name:t,value:n}))}),(0,v.xl)({type:"insert.break"})]:[(0,v.xl)({type:"insert.span",text:e,decorators:n,annotations:t.map(({_key:e,_type:t,...n})=>({name:t,value:n}))})])]}),(0,v.Ke)({on:"deserialization.success",actions:[({event:e})=>[(0,v.xl)({type:"insert.blocks",blocks:e.data,placement:"auto"})]]}),(0,v.Ke)({on:"deserialization.failure",guard:({event:e})=>{if("application/x-portable-text"===e.mimeType){let t=e.originEvent.originEvent.dataTransfer.getData("application/json");if(t)return{type:"deserialize.data",mimeType:"application/json",data:t,originEvent:e.originEvent}}if("application/json"===e.mimeType){let t=e.originEvent.originEvent.dataTransfer.getData("text/html");if(t)return{type:"deserialize.data",mimeType:"text/html",data:t,originEvent:e.originEvent}}if("text/html"===e.mimeType){let t=e.originEvent.originEvent.dataTransfer.getData("text/plain");if(t)return{type:"deserialize.data",mimeType:"text/plain",data:t,originEvent:e.originEvent}}return!1},actions:[(e,t)=>[(0,v.xl)(t)]]}),(0,v.Ke)({on:"deserialization.failure",actions:[({event:e})=>[{type:"effect",effect:()=>{console.warn(`Deserialization of ${e.mimeType} failed with reason "${e.reason}"`)}}]]})],n8=[(0,v.Ke)({on:"insert.blocks",guard:({event:e})=>{let t=1===e.blocks.length?e.blocks.at(0):void 0;return!!t&&{onlyBlock:t}},actions:[({event:e},{onlyBlock:t})=>[(0,v.xl)({type:"insert.block",block:t,placement:e.placement,select:e.select??"end"})]]}),(0,v.Ke)({on:"insert.blocks",guard:({snapshot:e,event:t})=>"before"===t.placement&&{firstBlockKey:t.blocks.at(0)?._key??e.context.keyGenerator(),lastBlockKey:t.blocks.at(-1)?._key??e.context.keyGenerator()},actions:[({snapshot:e,event:t},{firstBlockKey:n,lastBlockKey:o})=>[...t.blocks.map((e,n)=>(0,v.xl)({type:"insert.block",block:e,placement:0===n?"before":"after",select:n!==t.blocks.length-1?"end":"none"})),..."none"===t.select?[(0,v.xl)({type:"select",at:e.context.selection})]:"start"===t.select?[(0,v.xl)({type:"select.block",at:[{_key:n}],select:"start"})]:[(0,v.xl)({type:"select.block",at:[{_key:o}],select:"end"})]]]}),(0,v.Ke)({on:"insert.blocks",guard:({snapshot:e,event:t})=>"after"===t.placement&&{firstBlockKey:t.blocks.at(0)?._key??e.context.keyGenerator(),lastBlockKey:t.blocks.at(-1)?._key??e.context.keyGenerator()},actions:[({snapshot:e,event:t},{firstBlockKey:n,lastBlockKey:o})=>[...t.blocks.map((e,n)=>(0,v.xl)({type:"insert.block",block:e,placement:"after",select:n!==t.blocks.length-1?"end":"none"})),..."none"===t.select?[(0,v.xl)({type:"select",at:e.context.selection})]:"start"===t.select?[(0,v.xl)({type:"select.block",at:[{_key:n}],select:"start"})]:[(0,v.xl)({type:"select.block",at:[{_key:o}],select:"end"})]]]}),(0,v.Ke)({on:"insert.blocks",guard:({snapshot:e,event:t})=>{if("auto"!==t.placement)return!1;let n=(0,k.hH)(e);return!!n&&!!(0,u.wm)(e.context,n.node)&&{focusTextBlock:n,firstBlockKey:t.blocks.at(0)?._key??e.context.keyGenerator(),lastBlockKey:t.blocks.at(-1)?._key??e.context.keyGenerator()}},actions:[({event:e},{firstBlockKey:t,lastBlockKey:n})=>[...e.blocks.map((t,n)=>(0,v.xl)({type:"insert.block",block:t,placement:0===n?"auto":"after",select:n!==e.blocks.length-1?"end":"none"})),..."none"===e.select||"start"===e.select?[(0,v.xl)({type:"select.block",at:[{_key:t}],select:"start"})]:[(0,v.xl)({type:"select.block",at:[{_key:n}],select:"end"})]]]}),(0,v.Ke)({on:"insert.blocks",guard:({snapshot:e,event:t})=>{if("auto"!==t.placement)return!1;let n=(0,k.hH)(e);if(!n||!e.context.selection)return!1;let o=(0,f.u3)({context:e.context,block:n}),i=(0,u.J8)({context:e.context,block:n}),r=(0,M.B)({context:{schema:e.context.schema,selection:{anchor:e.context.selection.focus,focus:i}},block:n.node});return{firstBlockKey:t.blocks.at(0)?._key??e.context.keyGenerator(),focusBlockStartPoint:o,focusBlockEndPoint:i,focusTextBlockAfter:r,selection:e.context.selection}},actions:[({event:e},{focusBlockEndPoint:t,focusTextBlockAfter:n,selection:o,firstBlockKey:i,focusBlockStartPoint:r})=>[...e.blocks.flatMap((i,r)=>0===r?[...(0,u._Q)(o.focus,t)?[]:[(0,v.xl)({type:"delete",at:{anchor:o.focus,focus:t}})],(0,v.xl)({type:"insert.block",block:i,placement:"auto",select:"end"})]:r===e.blocks.length-1?[(0,v.xl)({type:"insert.block",block:i,placement:"after",select:"end"}),(0,v.xl)({type:"insert.block",block:n,placement:"auto",select:"end"===e.select?"none":"end"})]:[(0,v.xl)({type:"insert.block",block:i,placement:"after",select:"end"})]),..."none"===e.select?[(0,v.xl)({type:"select",at:o})]:"start"===e.select?[(0,u._Q)(o.focus,r)?(0,v.xl)({type:"select.block",at:[{_key:i}],select:"start"}):(0,v.xl)({type:"select",at:{anchor:o.focus,focus:o.focus}})]:[]]]}),(0,v.Ke)({on:"insert.blocks",guard:({event:e})=>"auto"===e.placement,actions:[({event:e})=>e.blocks.map((t,n)=>(0,v.xl)({type:"insert.block",block:t,placement:0===n?"auto":"after",select:e.select??"end"}))]}),(0,v.Ke)({on:"insert.break",actions:[()=>[(0,v.xl)({type:"split"})]]}),(0,v.Ke)({on:"insert.child",guard:({snapshot:e})=>{let t=(0,m.qm)(e);return!!t&&!e.context.selection&&{lastBlockEndPoint:(0,u.J8)({context:e.context,block:t})}},actions:[({event:e},{lastBlockEndPoint:t})=>[(0,v.xl)({type:"select",at:{anchor:t,focus:t}}),(0,v.xl)(e)]]}),(0,v.Ke)({on:"insert.child",guard:({snapshot:e})=>{let t=(0,k.hH)(e);return e.context.selection&&!t},actions:[({snapshot:e,event:t})=>[(0,v.xl)({type:"insert.block",block:{_type:e.context.schema.block.name,children:[{_type:e.context.schema.span.name,text:"",marks:[]}]},placement:"auto",select:"end"}),(0,v.xl)(t)]]}),(0,v.Ke)({on:"insert.inline object",actions:[({event:e})=>[(0,v.xl)({type:"insert.child",child:{_type:e.inlineObject.name,...e.inlineObject.value}})]]}),(0,v.Ke)({on:"insert.soft break",actions:[()=>[(0,v.xl)({type:"insert.text",text:`
`})]]}),(0,v.Ke)({on:"insert.span",guard:({snapshot:e})=>!(0,k.hH)(e),actions:[({snapshot:e,event:t})=>[(0,v.xl)({type:"insert.block",block:{_type:e.context.schema.block.name,children:[{_type:e.context.schema.span.name,text:"",marks:[]}]},placement:"auto",select:"end"}),(0,v.xl)(t)]]}),(0,v.Ke)({on:"insert.span",guard:({snapshot:e,event:t})=>{let n=(0,k.hH)(e);return{markDefs:t.annotations?.map(t=>({_type:t.name,_key:e.context.keyGenerator(),...t.value}))??[],focusTextBlock:n}},actions:[({snapshot:e,event:t},{markDefs:n,focusTextBlock:o})=>[...o?[(0,v.xl)({type:"block.set",at:o.path,props:{markDefs:[...o.node.markDefs??[],...n]}})]:[],(0,v.xl)({type:"insert.child",child:{_type:e.context.schema.span.name,text:t.text,marks:[...t.decorators??[],...n.map(e=>e._key)]}})]]})],n5=(0,R.mn)({default:[{key:"ArrowLeft",shift:!0,meta:!1,ctrl:!1,alt:!1}]}),n7=[(0,v.Ke)({on:"keyboard.keydown",guard:({snapshot:e,event:t})=>nA.backspace.guard(t.originEvent)&&(0,k.WV)(e)&&(0,m.Rt)(e),actions:[()=>[(0,v.xl)({type:"delete.backward",unit:"character"})]]}),(0,v.Ke)({on:"keyboard.keydown",guard:({snapshot:e,event:t})=>nA.delete.guard(t.originEvent)&&(0,k.WV)(e)&&(0,m.Rt)(e),actions:[()=>[(0,v.xl)({type:"delete.forward",unit:"character"})]]}),(0,v.Ke)({on:"keyboard.keydown",guard:({snapshot:e,event:t})=>nA.break.guard(t.originEvent)&&(0,k.WV)(e)&&(0,m.Rt)(e),actions:[()=>[(0,v.xl)({type:"insert.break"})]]}),(0,v.Ke)({on:"keyboard.keydown",guard:({snapshot:e,event:t})=>nA.break.guard(t.originEvent)&&(0,k.gR)(e),actions:[()=>[(0,v.xl)({type:"insert.break"})]]}),(0,v.Ke)({on:"keyboard.keydown",guard:({event:e})=>nA.lineBreak.guard(e.originEvent),actions:[()=>[(0,v.xl)({type:"insert.soft break"})]]}),(0,v.Ke)({on:"keyboard.keydown",guard:({event:e})=>nA.history.undo.guard(e.originEvent),actions:[()=>[(0,v.xl)({type:"history.undo"})]]}),(0,v.Ke)({on:"keyboard.keydown",guard:({event:e})=>nA.history.redo.guard(e.originEvent),actions:[()=>[(0,v.xl)({type:"history.redo"})]]}),(0,v.Ke)({on:"keyboard.keydown",guard:({snapshot:e,event:t})=>{if(!e.context.selection||!n5.guard(t.originEvent))return!1;let n=(0,k.gU)(e);if(!n)return!1;let o=(0,m.HA)({...e,context:{...e.context,selection:{anchor:{path:n.path,offset:0},focus:{path:n.path,offset:0}}}});return!!(o&&(0,g.zS)(e.context,n.node)&&0===e.context.selection.focus.offset&&(0,u.wm)(e.context,n.node))&&{previousBlock:o,selection:e.context.selection}},actions:[({snapshot:e},{previousBlock:t,selection:n})=>[(0,v.xl)({type:"select",at:{anchor:n.anchor,focus:(0,u.J8)({context:e.context,block:t})}})]]})],n9=[(0,v.Ke)({on:"list item.add",guard:({snapshot:e,event:t})=>!!e.context.schema.lists.some(e=>e.name===t.listItem)&&{selectedTextBlocks:(0,m.Lw)(e)},actions:[({event:e},{selectedTextBlocks:t})=>t.map(t=>(0,v.xl)({type:"block.set",at:t.path,props:{level:t.node.level??1,listItem:e.listItem}}))]}),(0,v.Ke)({on:"list item.remove",guard:({snapshot:e})=>({selectedTextBlocks:(0,m.Lw)(e)}),actions:[(e,{selectedTextBlocks:t})=>t.map(e=>(0,v.xl)({type:"block.unset",at:e.path,props:["level","listItem"]}))]}),(0,v.Ke)({on:"list item.toggle",guard:({snapshot:e,event:t})=>(0,m.oZ)(t.listItem)(e),actions:[({event:e})=>[(0,v.xl)({type:"list item.remove",listItem:e.listItem})]]}),(0,v.Ke)({on:"list item.toggle",guard:({snapshot:e,event:t})=>!(0,m.oZ)(t.listItem)(e),actions:[({event:e})=>[(0,v.xl)({type:"list item.add",listItem:e.listItem})]]})],oe=[(0,v.Ke)({on:"move.block up",guard:({snapshot:e,event:t})=>{let n=(0,m.HA)({...e,context:{...e.context,selection:{anchor:{path:t.at,offset:0},focus:{path:t.at,offset:0}}}});return!!n&&{previousBlock:n}},actions:[({event:e},{previousBlock:t})=>[(0,v.xl)({type:"move.block",at:e.at,to:t.path})]]}),(0,v.Ke)({on:"move.block down",guard:({snapshot:e,event:t})=>{let n=(0,m.RL)({...e,context:{...e.context,selection:{anchor:{path:t.at,offset:0},focus:{path:t.at,offset:0}}}});return!!n&&{nextBlock:n}},actions:[({event:e},{nextBlock:t})=>[(0,v.xl)({type:"move.block",at:e.at,to:t.path})]]})],ot=[(0,v.Ke)({on:"select.block",guard:({snapshot:e,event:t})=>{if("end"!==t.select)return!1;let n=(0,k.gU)({...e,context:{...e.context,selection:{anchor:{path:t.at,offset:0},focus:{path:t.at,offset:0}}}});return!!n&&{blockEndPoint:(0,u.J8)({context:e.context,block:n})}},actions:[(e,{blockEndPoint:t})=>[(0,v.xl)({type:"select",at:{anchor:t,focus:t}})]]}),(0,v.Ke)({on:"select.block",actions:[({event:e})=>[(0,v.xl)({type:"select",at:{anchor:{path:e.at,offset:0},focus:{path:e.at,offset:0}}})]]}),(0,v.Ke)({on:"select.previous block",guard:({snapshot:e})=>{let t=(0,m.HA)(e);return!!t&&{previousBlock:t}},actions:[({event:e},{previousBlock:t})=>[(0,v.xl)({type:"select.block",at:t.path,select:e.select})]]}),(0,v.Ke)({on:"select.next block",guard:({snapshot:e})=>{let t=(0,m.RL)(e);return!!t&&{nextBlock:t}},actions:[({event:e},{nextBlock:t})=>[(0,v.xl)({type:"select.block",at:t.path,select:e.select})]]})],on=[(0,v.Ke)({on:"serialize",actions:[({event:e})=>[(0,v.xl)({type:"serialize.data",mimeType:"application/x-portable-text",originEvent:e.originEvent}),(0,v.xl)({type:"serialize.data",mimeType:"application/json",originEvent:e.originEvent}),(0,v.xl)({type:"serialize.data",mimeType:"text/html",originEvent:e.originEvent}),(0,v.xl)({type:"serialize.data",mimeType:"text/plain",originEvent:e.originEvent})]]}),(0,v.Ke)({on:"serialize.data",guard:({snapshot:e,event:t})=>{let n=e.context.converters.find(e=>e.mimeType===t.mimeType);return!!n&&n.serialize({snapshot:e,event:{type:"serialize",originEvent:t.originEvent.type}})},actions:[({event:e},t)=>[(0,v.xl)({...t,originEvent:e.originEvent})]]}),(0,v.Ke)({on:"serialization.success",actions:[({event:e})=>[{type:"effect",effect:()=>{e.originEvent.originEvent.dataTransfer.setData(e.mimeType,e.data)}}]]}),(0,v.Ke)({on:"serialization.failure",actions:[({event:e})=>[{type:"effect",effect:()=>{console.warn(`Serialization of ${e.mimeType} failed with reason "${e.reason}"`)}}]]})],oo=[(0,v.Ke)({on:"split",guard:({snapshot:e})=>(0,u.WV)(e.context.selection)&&(0,m.Rt)(e),actions:[]}),(0,v.Ke)({on:"split",guard:({snapshot:e})=>(0,u.WV)(e.context.selection)&&(0,m.lA)(e),actions:[]}),(0,v.Ke)({on:"split",guard:({snapshot:e})=>{let t=e.context.selection;if(!t||(0,u.WV)(t))return!1;let n=(0,m.GB)(e),o=(0,m.P$)(e);return!!n&&!!o&&!!(!(0,g.zS)(e.context,n.node)&&(0,g.zS)(e.context,o.node))&&{selection:t}},actions:[(e,{selection:t})=>[(0,v.xl)({type:"delete",at:t})]]}),(0,v.Ke)({on:"split",guard:({snapshot:e})=>{let t=e.context.selection;if(!t||(0,u.WV)(t))return!1;let n=(0,m.GB)(e),o=(0,m.P$)(e);if(!n||!o||n.node._key===o.node._key)return!1;let i=(0,f.Jo)(t),r=(0,u.J8)({context:e.context,block:n}),a=(0,f.aR)(t);return{startPoint:i,startBlockEndPoint:r,endPoint:a,endBlockStartPoint:(0,f.u3)({context:e.context,block:o}),blocksInBetween:(0,k.lN)(e).filter(e=>e._key!==n.node._key&&e._key!==o.node._key)}},actions:[(e,{startPoint:t,startBlockEndPoint:n,endPoint:o,endBlockStartPoint:i,blocksInBetween:r})=>[(0,v.xl)({type:"delete",at:{anchor:t,focus:n}}),...r.map(e=>(0,v.xl)({type:"delete.block",at:[{_key:e._key}]})),(0,v.xl)({type:"delete",at:{anchor:i,focus:o}})]]}),(0,v.Ke)({on:"split",guard:({snapshot:e})=>{let t=e.context.selection;return!(!t||(0,u.WV)(t))&&{selection:t}},actions:[(e,{selection:t})=>[(0,v.xl)({type:"delete",at:t}),(0,v.xl)({type:"split"})]]}),(0,v.Ke)({on:"split",guard:({snapshot:e})=>{let t=e.context.selection;if(!t||!(0,u.WV)(t))return!1;let n=(0,f.Jo)(t),o=(0,k.hH)(e);if(!o)return!1;let i={anchor:n,focus:(0,u.J8)({context:e.context,block:o})},r=(0,f.rT)({block:(0,M.B)({context:{...e.context,selection:i},block:o.node}),context:e.context,options:{removeUnusedMarkDefs:!0,validateFields:!1}});return!!r&&{newTextBlock:r,newTextBlockSelection:i}},actions:[(e,{newTextBlock:t,newTextBlockSelection:n})=>(0,u.WV)(n)?[(0,v.xl)({type:"insert.block",block:t,placement:"after",select:"start"})]:[(0,v.xl)({type:"delete",at:n}),(0,v.xl)({type:"insert.block",block:t,placement:"after",select:"start"})]]})],oi=[(0,v.Ke)({on:"style.add",guard:({snapshot:e})=>({selectedTextBlocks:(0,m.Lw)(e)}),actions:[({event:e},{selectedTextBlocks:t})=>t.map(t=>(0,v.xl)({type:"block.set",at:t.path,props:{style:e.style}}))]}),(0,v.Ke)({on:"style.remove",guard:({snapshot:e})=>({selectedTextBlocks:(0,m.Lw)(e)}),actions:[(e,{selectedTextBlocks:t})=>t.map(e=>(0,v.xl)({type:"block.unset",at:e.path,props:["style"]}))]}),(0,v.Ke)({on:"style.toggle",guard:({snapshot:e,event:t})=>(0,m.ER)(t.style)(e),actions:[({event:e})=>[(0,v.xl)({type:"style.remove",style:e.style})]]}),(0,v.Ke)({on:"style.toggle",guard:({snapshot:e,event:t})=>!(0,m.ER)(t.style)(e),actions:[({event:e})=>[(0,v.xl)({type:"style.add",style:e.style})]]})],or=[(0,v.Ke)({on:"clipboard.copy",guard:({snapshot:e})=>{let t=(0,k.d2)(e),n=(0,k.WV)(e);return t&&n},actions:[]}),(0,v.Ke)({on:"clipboard.copy",actions:[({event:e})=>[(0,v.xl)({type:"serialize",originEvent:e})]]}),(0,v.Ke)({on:"clipboard.cut",guard:({snapshot:e})=>{let t=(0,k.d2)(e),n=(0,k.WV)(e);return t&&n},actions:[]}),(0,v.Ke)({on:"clipboard.cut",guard:({snapshot:e})=>!!e.context.selection&&{selection:e.context.selection},actions:[({event:e},{selection:t})=>[(0,v.xl)({type:"serialize",originEvent:e}),(0,v.xl)({type:"delete",at:t})]]}),(0,v.Ke)({on:"drag.dragstart",actions:[({event:e})=>[(0,v.xl)({type:"serialize",originEvent:e})]]}),(0,v.Ke)({on:"clipboard.paste",guard:({snapshot:e})=>!!(e.context.selection&&(0,k.gR)(e))&&{selection:e.context.selection},actions:[({event:e},{selection:t})=>[(0,v.xl)({type:"delete",at:t}),(0,v.xl)({type:"deserialize",originEvent:e})]]}),(0,v.Ke)({on:"clipboard.paste",actions:[({event:e})=>[(0,v.xl)({type:"deserialize",originEvent:e})]]}),(0,v.Ke)({on:"input.*",actions:[({event:e})=>[(0,v.xl)({type:"deserialize",originEvent:e})]]}),...n2,...n3,...n4,...n6,...n8,...n7,...n9,...oe,...oi,...ot,...on,...oo];function oa(e){return!op(e)&&!od(e)&&!os(e)}let ol=["annotation.set","annotation.toggle","decorator.toggle","delete.backward","delete.block","delete.child","delete.forward","delete.text","deserialize","deserialize.data","deserialization.success","deserialization.failure","insert.blocks","insert.break","insert.inline object","insert.soft break","insert.span","list item.add","list item.remove","list item.toggle","move.block down","move.block up","select.block","select.previous block","select.next block","serialize","serialize.data","serialization.success","serialization.failure","split","style.add","style.remove","style.toggle"];function os(e){return ol.includes(e.type)}let oc=["clipboard.copy","clipboard.cut","clipboard.paste","drag.dragstart","drag.drag","drag.dragend","drag.dragenter","drag.dragover","drag.dragleave","drag.drop","input.*","keyboard.keydown","keyboard.keyup","mouse.click"];function od(e){return oc.includes(e.type)}function op(e){return e.type.startsWith("custom.")}let oh=G("behaviors:event");function ou(e){return od(e)?"native":os(e)?"synthetic":op(e)?"custom":"synthetic"}let of=G("editor machine");function oy({event:e,slateEditor:t}){switch(e.type){case"blur":return{type:"blur",editor:t};case"focus":return{type:"focus",editor:t};case"insert.block object":return{type:"behavior event",behaviorEvent:{type:"insert.block",block:{_type:e.blockObject.name,...e.blockObject.value??{}},placement:e.placement},editor:t};default:return{type:"behavior event",behaviorEvent:e,editor:t}}}let og=(0,x.mj)({types:{context:{},events:{},emitted:{},input:{},tags:{}},actions:{"add behavior to context":(0,_.a)({behaviors:({context:e,event:t})=>((0,x.DT)(t,"add behavior"),new Set([...e.behaviors,t.behaviorConfig])),behaviorsSorted:!1}),"remove behavior from context":(0,_.a)({behaviors:({context:e,event:t})=>((0,x.DT)(t,"remove behavior"),e.behaviors.delete(t.behaviorConfig),new Set([...e.behaviors]))}),"emit patch event":(0,S.a)(({event:e})=>((0,x.DT)(e,"internal.patch"),e)),"emit mutation event":(0,S.a)(({event:e})=>((0,x.DT)(e,"mutation"),e)),"emit read only":(0,S.a)({type:"read only"}),"emit editable":(0,S.a)({type:"editable"}),"defer event":(0,_.a)({pendingEvents:({context:e,event:t})=>((0,x.DT)(t,["internal.patch","mutation"]),[...e.pendingEvents,t])}),"emit pending events":(0,S.e)(({context:e,enqueue:t})=>{for(let n of e.pendingEvents)t.emit(n)}),"emit ready":(0,S.a)({type:"ready"}),"clear pending events":(0,_.a)({pendingEvents:[]}),"defer incoming patches":(0,_.a)({pendingIncomingPatchesEvents:({context:e,event:t})=>"patches"===t.type?[...e.pendingIncomingPatchesEvents,t]:e.pendingIncomingPatchesEvents}),"emit pending incoming patches":(0,S.e)(({context:e,enqueue:t})=>{for(let n of e.pendingIncomingPatchesEvents)t.emit(n)}),"clear pending incoming patches":(0,_.a)({pendingIncomingPatchesEvents:[]}),"handle blur":({event:e})=>{(0,x.DT)(e,"blur");try{d.rL.blur(e.editor)}catch(e){console.error(Error(`Failed to blur editor: ${e.message}`))}},"handle focus":({context:e})=>{if(!e.slateEditor)return void console.error("No Slate editor found to focus");try{let t=e.slateEditor.selection;d.rL.focus(e.slateEditor),t&&c.gB.select(e.slateEditor,t)}catch(e){console.error(Error(`Failed to focus editor: ${e.message}`))}},"handle behavior event":({context:e,event:t,self:n})=>{(0,x.DT)(t,["behavior event"]);try{let o=[...e.behaviors.values()].map(e=>e.behavior);!function e({mode:t,behaviors:n,remainingEventBehaviors:o,event:i,editor:r,keyGenerator:a,schema:l,getSnapshot:s,nativeEvent:d,sendBack:p}){"send"!==t||od(i)||t3(r),oh(`(${t}:${ou(i)})`,JSON.stringify(i,null,2));let h=[...o,...or].filter(e=>{if("*"===e.on)return!0;let[t]=e.on.includes("*")&&e.on.includes(".")?e.on.split("."):[void 0],[n]=i.type.includes(".")?i.type.split("."):[void 0];return void 0!==t&&void 0!==n&&t===n||void 0!==t&&void 0===n&&t===i.type||e.on===i.type});if(0===h.length&&oa(i)){d?.preventDefault(),"send"===t&&t4(r),ns(r,()=>{oh(`(execute:${ou(i)})`,JSON.stringify(i,null,2)),na({context:{keyGenerator:a,schema:l},operation:{...i,editor:r}})}),r.onChange();return}let u=s(),f=!1,y=!1,g=-1;for(let v of h){g++;let b=!1;try{b=void 0===v.guard||v.guard({snapshot:u,event:i,dom:nB(p,r)})}catch(e){console.error(Error(`Evaluating guard for "${i.type}" failed due to: ${e.message}`))}if(!b)continue;y=!0,0===v.actions.length&&(f=!0);let x=-1;for(let u of v.actions){var m,k;x++;let y=s(),v=[];try{v=u({snapshot:y,event:i,dom:nB(p,r)},b)}catch(e){console.error(Error(`Evaluating actions for "${i.type}" failed due to: ${e.message}`))}if(0===v.length)continue;f=v.some(e=>"raise"===e.type||"execute"===e.type)||!v.some(e=>"forward"===e.type);let _=!1;x>0&&(t3(r),_=!0),!_&&v.some(e=>"execute"===e.type)&&(t3(r),_=!0);let E=v.map(e=>e.type),w=new Set(E),S=E.length>1&&1===w.size&&w.has("raise"),B=E.length>1&&1===w.size&&w.has("execute");m=()=>S||B,k=()=>{for(let c of v){if("effect"===c.type){try{c.effect({send:p})}catch(e){console.error(Error(`Executing effect as a result of "${i.type}" failed due to: ${e.message}`))}continue}if("forward"===c.type){e({mode:"execute"===t?"execute":"forward",behaviors:n,remainingEventBehaviors:h.slice(g+1),event:c.event,editor:r,keyGenerator:a,schema:l,getSnapshot:s,nativeEvent:d,sendBack:p});continue}if("raise"===c.type){e({mode:"execute"===t?"execute":"raise",behaviors:n,remainingEventBehaviors:"execute"===t?o:n,event:c.event,editor:r,keyGenerator:a,schema:l,getSnapshot:s,nativeEvent:d,sendBack:p});continue}e({mode:"execute",behaviors:n,remainingEventBehaviors:[],event:c.event,editor:r,keyGenerator:a,schema:l,getSnapshot:s,nativeEvent:void 0,sendBack:p})}},m()?c.KE.withoutNormalizing(r,k):k(),_&&t4(r)}break}!y&&oa(i)?(d?.preventDefault(),"send"===t&&t4(r),ns(r,()=>{oh(`(execute:${ou(i)})`,JSON.stringify(i,null,2)),na({context:{keyGenerator:a,schema:l},operation:{...i,editor:r}})}),r.onChange()):f&&d?.preventDefault()}({mode:"send",behaviors:o,remainingEventBehaviors:o,event:t.behaviorEvent,editor:t.editor,keyGenerator:e.keyGenerator,schema:e.schema,getSnapshot:()=>(function({converters:e,editor:t,keyGenerator:n,readOnly:o,schema:i}){let r=t.selection?et({schema:i,editor:t,range:t.selection}):null,a={converters:e,keyGenerator:n,readOnly:o,schema:i,selection:r,value:t.value};return{blockIndexMap:t.blockIndexMap,context:a,decoratorState:t.decoratorState}})({converters:[...e.converters],editor:t.editor,keyGenerator:e.keyGenerator,readOnly:n.getSnapshot().matches({"edit mode":"read only"}),schema:e.schema}),nativeEvent:t.nativeEvent,sendBack:e=>{if("set drag ghost"===e.type)return void n.send(e);n.send(oy({event:e,slateEditor:t.editor}))}})}catch(e){console.error(Error(`Raising "${t.behaviorEvent.type}" failed due to: ${e.message}`))}},"sort behaviors":(0,_.a)({behaviors:({context:e})=>e.behaviorsSorted?e.behaviors:new Set(function(e){if(0===e.length)return[];let t=e.filter(e=>void 0!==e.priority),n=e.filter(e=>void 0===e.priority);if(0===t.length)return e;let o=new Map(t.map(e=>[e.priority.id,e])),i=new Map,r=new Map;function a(e){i.has(e)||(i.set(e,new Set),r.set(e,0))}for(let e of t)a(e.priority.id);function l(e,t){i.has(e)&&i.has(t)&&(i.get(e)?.add(t),r.set(t,(r.get(t)??0)+1))}for(let e of t){let t=e.priority.id,n=new Set,o=e.priority.reference;for(;o;){let e=o.priority.id;if(a(e),n.has(e))throw Error("Circular dependency detected in priorities");n.add(e),"higher"===o.importance?l(t,e):l(e,t),o=o.priority.reference}}let s=[];for(let[e,t]of r)0===t&&s.push(e);let c=[];for(;s.length>0;){let e=s.shift(),t=o.get(e);for(let n of(t&&c.push(t),i.get(e)??[])){let e=(r.get(n)??0)-1;r.set(n,e),0===e&&s.push(n)}}for(let e of t)c.includes(e)||c.push(e);return[...c,...n]}([...e.behaviors.values()])),behaviorsSorted:!0})},guards:{"slate is busy":({context:e})=>!!e.slateEditor&&e.slateEditor.operations.length>0}}).createMachine({id:"editor",context:({input:e})=>({behaviors:new Set(n1),behaviorsSorted:!1,converters:new Set(e.converters??[]),getLegacySchema:e.getLegacySchema,keyGenerator:e.keyGenerator,pendingEvents:[],pendingIncomingPatchesEvents:[],schema:e.schema,selection:null,initialReadOnly:e.readOnly??!1,maxBlocks:e.maxBlocks,initialValue:e.initialValue}),on:{"add behavior":{actions:"add behavior to context"},"remove behavior":{actions:"remove behavior from context"},"update maxBlocks":{actions:(0,_.a)({maxBlocks:({event:e})=>e.maxBlocks})},"update selection":{actions:[(0,_.a)({selection:({event:e})=>e.selection}),(0,S.a)(({event:e})=>({...e,type:"selection"}))]},"set drag ghost":{actions:(0,_.a)({dragGhost:({event:e})=>e.ghost})}},type:"parallel",states:{"edit mode":{initial:"read only",states:{"read only":{initial:"determine initial edit mode",on:{"behavior event":{actions:["sort behaviors","handle behavior event"],guard:({event:e})=>"clipboard.copy"===e.behaviorEvent.type||"mouse.click"===e.behaviorEvent.type||"serialize"===e.behaviorEvent.type||"serialization.failure"===e.behaviorEvent.type||"serialization.success"===e.behaviorEvent.type||"select"===e.behaviorEvent.type}},states:{"determine initial edit mode":{entry:[()=>{of("entry: edit mode->read only->determine initial edit mode")}],exit:[()=>{of("exit: edit mode->read only->determine initial edit mode")}],on:{"done syncing value":[{target:"#editor.edit mode.read only.read only",guard:({context:e})=>e.initialReadOnly},{target:"#editor.edit mode.editable"}]}},"read only":{entry:[()=>{of("entry: edit mode->read only->read only")}],exit:[()=>{of("exit: edit mode->read only->read only")}],on:{"update readOnly":{guard:({event:e})=>!e.readOnly,target:"#editor.edit mode.editable",actions:["emit editable"]}}}}},editable:{on:{"update readOnly":{guard:({event:e})=>e.readOnly,target:"#editor.edit mode.read only.read only",actions:["emit read only"]},"behavior event":{actions:["sort behaviors","handle behavior event"]},blur:{actions:"handle blur"},focus:{target:".focusing",actions:[(0,_.a)({slateEditor:({event:e})=>e.editor})]}},initial:"idle",states:{idle:{entry:[()=>{of("entry: edit mode->editable->idle")}],exit:[()=>{of("exit: edit mode->editable-idle")}],on:{dragstart:{actions:[(0,_.a)({internalDrag:({event:e})=>({origin:e.origin})})],target:"dragging internally"}}},focusing:{initial:"checking if busy",states:{"checking if busy":{entry:[()=>{of("entry: edit mode->editable->focusing->checking if busy")}],exit:[()=>{of("exit: edit mode->editable->focusing->checking if busy")}],always:[{guard:"slate is busy",target:"busy"},{target:"#editor.edit mode.editable.idle",actions:["handle focus"]}]},busy:{entry:[()=>{of("entry: edit mode->editable->focusing-busy")}],exit:[()=>{of("exit: edit mode->editable->focusing->busy")}],after:{10:{target:"checking if busy"}}}}},"dragging internally":{entry:[()=>{of("entry: edit mode->editable->dragging internally")}],exit:[()=>{of("exit: edit mode->editable->dragging internally")},({context:e})=>{if(e.dragGhost)try{e.dragGhost.parentNode?.removeChild(e.dragGhost)}catch(e){console.error(Error(`Removing the drag ghost failed due to: ${e.message}`))}},(0,_.a)({dragGhost:void 0}),(0,_.a)({internalDrag:void 0})],tags:["dragging internally"],on:{dragend:{target:"idle"},drop:{target:"idle"}}}}}}},setup:{initial:"setting up",states:{"setting up":{entry:[()=>{of("entry: setup->setting up")}],exit:[()=>{of("exit: setup->setting up")},"emit ready","emit pending incoming patches","clear pending incoming patches"],on:{"internal.patch":{actions:"defer event"},mutation:{actions:"defer event"},"done syncing value":{target:"set up"},patches:{actions:["defer incoming patches"]}}},"set up":{type:"parallel",states:{"value sync":{initial:"idle",states:{idle:{entry:[()=>{of("entry: setup->set up->value sync->idle")}],exit:[()=>{of("exit: setup->set up->value sync->idle")}],on:{patches:{actions:[(0,S.a)(({event:e})=>e)]},"syncing value":{target:"syncing value"}}},"syncing value":{entry:[()=>{of("entry: setup->set up->value sync->syncing value")}],exit:[()=>{of("exit: setup->set up->value sync->syncing value")},"emit pending incoming patches","clear pending incoming patches"],on:{patches:{actions:["defer incoming patches"]},"done syncing value":{target:"idle"}}}}},writing:{initial:"pristine",states:{pristine:{initial:"idle",states:{idle:{entry:[()=>{of("entry: setup->set up->writing->pristine->idle")}],exit:[()=>{of("exit: setup->set up->writing->pristine->idle")}],on:{normalizing:{target:"normalizing"},"internal.patch":{actions:"defer event",target:"#editor.setup.set up.writing.dirty"},mutation:{actions:"defer event",target:"#editor.setup.set up.writing.dirty"}}},normalizing:{entry:[()=>{of("entry: setup->set up->writing->pristine->normalizing")}],exit:[()=>{of("exit: setup->set up->writing->pristine->normalizing")}],on:{"done normalizing":{target:"idle"},"internal.patch":{actions:"defer event"},mutation:{actions:"defer event"}}}}},dirty:{entry:[()=>{of("entry: setup->set up->writing->dirty")},"emit pending events","clear pending events"],exit:[()=>{of("exit: setup->set up->writing->dirty")}],on:{"internal.patch":{actions:"emit patch event"},mutation:{actions:"emit mutation event"}}}}}}}}}}}),om=G("mutation-machine"),ok=(0,x.mj)({types:{context:{},events:{},input:{},emitted:{}},actions:{"assign readOnly":(0,_.a)({readOnly:({context:e,event:t})=>"update readOnly"===t.type?t.readOnly:e.readOnly}),"emit patch":(0,S.a)(({event:e})=>((0,x.DT)(e,"patch"),{type:"patch",patch:e.patch})),"emit has pending mutations":(0,S.a)({type:"has pending mutations"}),"emit mutations":(0,S.e)(({context:e,enqueue:t})=>{for(let n of e.pendingMutations)t.emit({type:"mutation",patches:n.patches,snapshot:n.value})}),"clear pending mutations":(0,_.a)({pendingMutations:[]}),"defer mutation":(0,_.a)({pendingMutations:({context:e,event:t})=>{if((0,x.DT)(t,"patch"),0===e.pendingMutations.length)return[{operationId:t.operationId,value:t.value,patches:[t.patch]}];let n=e.pendingMutations.at(-1);return n&&n.operationId===t.operationId?e.pendingMutations.slice(0,-1).concat({value:t.value,operationId:n.operationId,patches:[...n.patches,t.patch]}):e.pendingMutations.concat({value:t.value,operationId:t.operationId,patches:[t.patch]})}}),"clear pending patch events":(0,_.a)({pendingPatchEvents:[]}),"defer patch":(0,_.a)({pendingPatchEvents:({context:e,event:t})=>"patch"===t.type?[...e.pendingPatchEvents,t]:e.pendingPatchEvents}),"emit pending patch events":(0,S.e)(({context:e,enqueue:t})=>{for(let n of e.pendingPatchEvents)t.emit(n)})},actors:{"type listener":(0,E.SP)(({input:e,sendBack:t})=>{let n=e.slateEditor.apply;return e.slateEditor.apply=e=>{"insert_text"===e.type||"remove_text"===e.type?t({type:"typing"}):t({type:"not typing"}),n(e)},()=>{e.slateEditor.apply=n}}),"mutation interval":(0,E.SP)(({sendBack:e})=>{let t=setInterval(()=>{e({type:"emit changes"})},1e3);return()=>{clearInterval(t)}})},guards:{"is read-only":({context:e})=>e.readOnly,"slate is normalizing":({context:e})=>c.KE.isNormalizing(e.slateEditor)},delays:{"type debounce":250}}).createMachine({id:"mutation",context:({input:e})=>({pendingMutations:[],pendingPatchEvents:[],readOnly:e.readOnly,schema:e.schema,slateEditor:e.slateEditor}),on:{"update readOnly":{actions:["assign readOnly"]}},type:"parallel",states:{typing:{initial:"idle",invoke:{src:"type listener",input:({context:e})=>({slateEditor:e.slateEditor})},states:{idle:{entry:[()=>{om("entry: typing->idle")}],exit:[()=>{om("exit: typing->idle"),om("entry: typing->typing")}],on:{typing:{target:"typing"}}},typing:{after:{"type debounce":{target:"idle",actions:[(0,w.r)({type:"emit changes"}),()=>{om("exit: typing->typing")}]}},on:{"not typing":{target:"idle",actions:[(0,w.r)({type:"emit changes"})]},typing:{target:"typing",reenter:!0}}}}},mutations:{initial:"idle",states:{idle:{entry:[()=>{om("entry: mutations->idle")}],exit:[()=>{om("exit: mutations->idle")}],on:{patch:[{guard:"is read-only",actions:["defer patch","defer mutation"],target:"has pending mutations"},{actions:["emit patch","defer mutation"],target:"has pending mutations"}]}},"has pending mutations":{entry:[()=>{om("entry: mutations->has pending mutations")},"emit has pending mutations"],exit:[()=>{om("exit: mutations->has pending mutations")}],invoke:{src:"mutation interval"},on:{"emit changes":{guard:(0,w.d)([(0,w.n)("is read-only"),"slate is normalizing"]),target:"idle",actions:["emit pending patch events","clear pending patch events","emit mutations","clear pending mutations"]},patch:[{guard:"is read-only",actions:["defer patch","defer mutation"]},{actions:["emit patch","defer mutation"]}]}}}}}}),ov=G("API:editable"),ob=(0,x.mj)({types:{context:{},events:{},emitted:{}}}).createMachine({id:"relay",context:{prevSelection:null,lastEventWasFocused:!1},on:{focused:{actions:[(0,_.a)({lastEventWasFocused:!0}),(0,S.a)(({event:e})=>e)]},selection:[{guard:({context:e})=>e.lastEventWasFocused,actions:[(0,_.a)({prevSelection:({event:e})=>e.selection}),(0,S.a)(({event:e})=>e),(0,_.a)({lastEventWasFocused:!1})]},{guard:({context:e,event:t})=>e.prevSelection!==t.selection,actions:[(0,_.a)({prevSelection:({event:e})=>e.selection}),(0,S.a)(({event:e})=>e),(0,_.a)({lastEventWasFocused:!1})]}],"*":{actions:[(0,S.a)(({event:e})=>e),(0,_.a)({lastEventWasFocused:!1})]}}});function ox(e,t,n){let o=null,i=!0,r=[t.span.name,...t.inlineObjects.map(e=>e.name)],a=[t.block.name,...t.blockObjects.map(e=>e.name)];return void 0===e?{valid:!0,resolution:null,value:e}:Array.isArray(e)&&0!==e.length?(e.some((e,l)=>{if(!$(e))return o={patches:[(0,N.wC)([l])],description:`Block must be an object, got ${String(e)}`,action:"Unset invalid item",item:e,i18n:{description:"inputs.portable-text.invalid-value.not-an-object.description",action:"inputs.portable-text.invalid-value.not-an-object.action",values:{index:l}}},!0;if(!e._key||"string"!=typeof e._key)return o={patches:[(0,N.hZ)({...e,_key:n()},[l])],description:`Block at index ${l} is missing required _key.`,action:"Set the block with a random _key value",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-key.description",action:"inputs.portable-text.invalid-value.missing-key.action",values:{index:l}}},!0;if(!e._type||!a.includes(e._type)){if("block"===e._type){let n=t.block.name;return o={patches:[(0,N.hZ)({...e,_type:n},[{_key:e._key}])],description:`Block with _key '${e._key}' has invalid type name '${e._type}'. According to the schema, the block type name is '${n}'`,action:`Use type '${n}'`,item:e,i18n:{description:"inputs.portable-text.invalid-value.incorrect-block-type.description",action:"inputs.portable-text.invalid-value.incorrect-block-type.action",values:{key:e._key,expectedTypeName:n}}},!0}return o=!e._type&&(0,g.zS)({schema:t},{...e,_type:t.block.name})?{patches:[(0,N.hZ)({...e,_type:t.block.name},[{_key:e._key}])],description:`Block with _key '${e._key}' is missing a type name. According to the schema, the block type name is '${t.block.name}'`,action:`Use type '${t.block.name}'`,item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-block-type.description",action:"inputs.portable-text.invalid-value.missing-block-type.action",values:{key:e._key,expectedTypeName:t.block.name}}}:e._type?{patches:[(0,N.wC)([{_key:e._key}])],description:`Block with _key '${e._key}' has invalid _type '${e._type}'`,action:"Remove the block",item:e,i18n:{description:"inputs.portable-text.invalid-value.disallowed-type.description",action:"inputs.portable-text.invalid-value.disallowed-type.action",values:{key:e._key,typeName:e._type}}}:{patches:[(0,N.wC)([{_key:e._key}])],description:`Block with _key '${e._key}' is missing an _type property`,action:"Remove the block",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-type.description",action:"inputs.portable-text.invalid-value.missing-type.action",values:{key:e._key}}},!0}if(e._type===t.block.name){if(e.children&&!Array.isArray(e.children))return o={patches:[(0,N.hZ)({children:[]},[{_key:e._key}])],description:`Text block with _key '${e._key}' has a invalid required property 'children'.`,action:"Reset the children property",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-or-invalid-children.description",action:"inputs.portable-text.invalid-value.missing-or-invalid-children.action",values:{key:e._key}}},!0;if(void 0===e.children||Array.isArray(e.children)&&0===e.children.length){let i={_type:t.span.name,_key:n(),text:"",marks:[]};return o={autoResolve:!0,patches:[(0,N.Wm)([],[{_key:e._key},"children"]),(0,N.Yr)([i],"after",[{_key:e._key},"children",0])],description:`Children for text block with _key '${e._key}' is empty.`,action:"Insert an empty text",item:e,i18n:{description:"inputs.portable-text.invalid-value.empty-children.description",action:"inputs.portable-text.invalid-value.empty-children.action",values:{key:e._key}}},!0}let a=b(O(e.children.filter(e=>e._type===t.span.name).map(e=>e.marks||[])));if(Array.isArray(e.markDefs)&&e.markDefs.length>0){let t=b(e.markDefs.map(e=>e._key).filter(e=>!a.includes(e)));if(t.length>0)return o={autoResolve:!0,patches:t.map(t=>(0,N.wC)([{_key:e._key},"markDefs",{_key:t}])),description:`Block contains orphaned data (unused mark definitions): ${t.join(", ")}.`,action:"Remove unused mark definition item",item:e,i18n:{description:"inputs.portable-text.invalid-value.orphaned-mark-defs.description",action:"inputs.portable-text.invalid-value.orphaned-mark-defs.action",values:{key:e._key,unusedMarkDefs:t.map(e=>e.toString())}}},!0}let l=a.filter(e=>!t.decorators.map(e=>e.name).includes(e)).filter(t=>void 0===e.markDefs||!e.markDefs.find(e=>e._key===t));if(l.length>0){let n=e.children.filter(e=>e._type===t.span.name&&Array.isArray(e.marks)&&e.marks.some(e=>l.includes(e)));if(n){let t=l.join(", ");return o={autoResolve:!0,patches:n.map(t=>(0,N.hZ)((t.marks||[]).filter(e=>!l.includes(e)),[{_key:e._key},"children",{_key:t._key},"marks"])),description:`Block with _key '${e._key}' contains marks (${t}) not supported by the current content model.`,action:"Remove invalid marks",item:e,i18n:{description:"inputs.portable-text.invalid-value.orphaned-marks.description",action:"inputs.portable-text.invalid-value.orphaned-marks.action",values:{key:e._key,orphanedMarks:l.map(e=>e.toString())}}},!0}}e.children.some((i,a)=>{if(!$(i))return o={patches:[(0,N.wC)([{_key:e._key},"children",a])],description:`Child at index '${a}' in block with key '${e._key}' is not an object.`,action:"Remove the item",item:e,i18n:{description:"inputs.portable-text.invalid-value.non-object-child.description",action:"inputs.portable-text.invalid-value.non-object-child.action",values:{key:e._key,index:a}}},!0;if(!i._key||"string"!=typeof i._key){let t={...i,_key:n()};return o={autoResolve:!0,patches:[(0,N.hZ)(t,[{_key:e._key},"children",a])],description:`Child at index ${a} is missing required _key in block with _key ${e._key}.`,action:"Set a new random _key on the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-child-key.description",action:"inputs.portable-text.invalid-value.missing-child-key.action",values:{key:e._key,index:a}}},!0}return i._type?r.includes(i._type)?i._type===t.span.name&&"string"!=typeof i.text&&(o={patches:[(0,N.hZ)({...i,text:""},[{_key:e._key},"children",{_key:i._key}])],description:`Child with _key '${i._key}' in block with key '${e._key}' has missing or invalid text property!`,action:"Write an empty text property to the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.invalid-span-text.description",action:"inputs.portable-text.invalid-value.invalid-span-text.action",values:{key:e._key,childKey:i._key}}},!0):(o={patches:[(0,N.wC)([{_key:e._key},"children",{_key:i._key}])],description:`Child with _key '${i._key}' in block with key '${e._key}' has invalid '_type' property (${i._type}).`,action:"Remove the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.disallowed-child-type.description",action:"inputs.portable-text.invalid-value.disallowed-child-type.action",values:{key:e._key,childKey:i._key,childType:i._type}}},!0):(o={patches:[(0,N.wC)([{_key:e._key},"children",{_key:i._key}])],description:`Child with _key '${i._key}' in block with key '${e._key}' is missing '_type' property.`,action:"Remove the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-child-type.description",action:"inputs.portable-text.invalid-value.missing-child-type.action",values:{key:e._key,childKey:i._key}}},!0)})&&(i=!1)}return!1})&&(i=!1),{valid:i,resolution:o,value:e}):{valid:!1,resolution:{patches:[(0,N.wC)([])],description:"Editor value must be an array of Portable Text blocks, or undefined.",action:"Unset the value",item:e,i18n:{description:"inputs.portable-text.invalid-value.not-an-array.description",action:"inputs.portable-text.invalid-value.not-an-array.action"}},value:e}}let o_=G("sync machine"),oE=(0,E.SP)(({sendBack:e,input:t})=>{oS({context:t.context,sendBack:e,slateEditor:t.slateEditor,value:t.value,streamBlocks:t.streamBlocks})}),ow=(0,x.mj)({types:{context:{},input:{},events:{},emitted:{}},actions:{"assign initial value synced":(0,_.a)({initialValueSynced:!0}),"assign readOnly":(0,_.a)({readOnly:({event:e})=>((0,x.DT)(e,"update readOnly"),e.readOnly)}),"assign pending value":(0,_.a)({pendingValue:({event:e})=>((0,x.DT)(e,"update value"),e.value)}),"clear pending value":(0,_.a)({pendingValue:void 0}),"assign previous value":(0,_.a)({previousValue:({event:e})=>((0,x.DT)(e,"done syncing"),e.value)}),"emit done syncing value":(0,S.a)({type:"done syncing value"}),"emit syncing value":(0,S.a)({type:"syncing value"})},guards:{"initial value synced":({context:e})=>e.initialValueSynced,"is busy":({context:e})=>{let t=e.isProcessingLocalChanges,n=tc(e.slateEditor)??!1,o=t||n;return o_("isBusy",{isBusy:o,isProcessingLocalChanges:t,isChanging:n}),o},"is empty value":({event:e})=>"update value"===e.type&&void 0===e.value,"is empty array":({event:e})=>"update value"===e.type&&Array.isArray(e.value)&&0===e.value.length,"is new value":({context:e,event:t})=>"update value"===t.type&&e.previousValue!==t.value,"value changed while syncing":({context:e,event:t})=>((0,x.DT)(t,"done syncing"),e.pendingValue!==t.value),"pending value equals previous value":({context:e})=>y(e.pendingValue,e.previousValue)},actors:{"sync value":oE}}).createMachine({id:"sync",context:({input:e})=>({initialValue:e.initialValue,initialValueSynced:!1,isProcessingLocalChanges:!1,keyGenerator:e.keyGenerator,schema:e.schema,readOnly:e.readOnly,slateEditor:e.slateEditor,pendingValue:void 0,previousValue:void 0}),entry:[(0,w.r)(({context:e})=>({type:"update value",value:e.initialValue}))],on:{"has pending mutations":{actions:(0,_.a)({isProcessingLocalChanges:!0})},mutation:{actions:(0,_.a)({isProcessingLocalChanges:!1})},"update readOnly":{actions:["assign readOnly"]}},initial:"idle",states:{idle:{entry:[()=>{o_("entry: syncing->idle")}],exit:[()=>{o_("exit: syncing->idle")}],on:{"update value":[{guard:(0,w.d)(["is empty value",(0,w.n)("initial value synced")]),actions:["assign initial value synced","emit done syncing value"]},{guard:(0,w.d)(["is empty array",(0,w.n)("initial value synced")]),actions:["assign initial value synced",(0,S.a)({type:"value changed",value:[]}),"emit done syncing value"]},{guard:(0,w.d)(["is busy","is new value"]),target:"busy",actions:["assign pending value"]},{guard:"is new value",target:"syncing",actions:["assign pending value"]},{guard:(0,w.n)("initial value synced"),actions:[()=>{o_("no new value – setting initial value as synced")},"assign initial value synced","emit done syncing value"]},{actions:[()=>{o_("no new value and initial value already synced")}]}]}},busy:{entry:[()=>{o_("entry: syncing->busy")}],exit:[()=>{o_("exit: syncing->busy")}],after:{1e3:[{guard:"is busy",target:".",reenter:!0,actions:[()=>{o_("reenter: syncing->busy")}]},{target:"syncing"}]},on:{"update value":[{guard:"is new value",actions:["assign pending value"]}]}},syncing:{entry:[()=>{o_("entry: syncing->syncing")},"emit syncing value"],exit:[()=>{o_("exit: syncing->syncing")},"emit done syncing value"],invoke:{src:"sync value",id:"sync value",input:({context:e})=>({context:{keyGenerator:e.keyGenerator,previousValue:e.previousValue,readOnly:e.readOnly,schema:e.schema},slateEditor:e.slateEditor,streamBlocks:!e.initialValueSynced,value:e.pendingValue})},on:{"update value":{guard:"is new value",actions:["assign pending value"]},patch:{actions:[(0,S.a)(({event:e})=>e)]},"invalid value":{actions:[(0,S.a)(({event:e})=>e)]},"value changed":{actions:[(0,S.a)(({event:e})=>e)]},"done syncing":[{guard:"value changed while syncing",actions:["assign previous value","assign initial value synced"],target:"syncing",reenter:!0},{target:"idle",actions:["clear pending value","assign previous value","assign initial value synced"]}]}}}});async function oS({context:e,sendBack:t,slateEditor:n,streamBlocks:o,value:i}){let r=!1,a=!1,l=!0,s=!!n.selection;if(i&&0!==i.length||(o_("Value is empty"),c.KE.withoutNormalizing(n,()=>{nn(n,()=>{ts(n,()=>{nu(n,()=>{if(r)return;s&&c.gB.deselect(n);let e=n.children.length;n.children.forEach((t,o)=>{c.gB.removeNodes(n,{at:[e-1-o]})}),c.gB.insertNodes(n,n.pteCreateTextBlock({decorators:[]}),{at:[0]}),s&&c.gB.select(n,[0,0])})})})}),a=!0),i&&i.length>0){let s=H(i,{schemaTypes:e.schema});o?await new Promise(o=>{c.KE.withoutNormalizing(n,()=>{ts(n,()=>{nu(n,()=>{if(r)return void o();a=oB({slateEditor:n,slateValueFromProps:s}),(async()=>{for await(let[o,r]of oK({slateValue:s})){let{blockChanged:s,blockValid:c}=oT({context:e,sendBack:t,block:o,index:r,slateEditor:n,value:i});if(a=s||a,!(l=l&&c))break}o()})()})})})}):c.KE.withoutNormalizing(n,()=>{ts(n,()=>{nu(n,()=>{if(r)return;a=oB({slateEditor:n,slateValueFromProps:s});let o=0;for(let r of s){let{blockChanged:s,blockValid:c}=oT({context:e,sendBack:t,block:r,index:o,slateEditor:n,value:i});if(a=s||a,l=l&&c,!c)break;o++}})})})}if(!l){o_("Invalid value, returning"),r=!0,t({type:"done syncing",value:i});return}if(a){o_("Server value changed, syncing editor");try{n.onChange()}catch(e){console.error(e),t({type:"invalid value",resolution:null,value:i}),r=!0,t({type:"done syncing",value:i});return}s&&!n.selection&&(c.gB.select(n,{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0}}),n.onChange()),t({type:"value changed",value:i})}else o_("Server value and editor value is equal, no need to sync.");r=!0,t({type:"done syncing",value:i})}function oB({slateEditor:e,slateValueFromProps:t}){let n=!1,o=e.children.length;if(t.length<o){for(let n=o-1;n>t.length-1;n--)c.gB.removeNodes(e,{at:[n]});n=!0}return n}async function*oK({slateValue:e}){let t=0;for await(let n of e)t%10==0&&await new Promise(e=>setTimeout(e,0)),yield[n,t],t++}function oT({context:e,sendBack:t,block:n,index:o,slateEditor:i,value:r}){let a=!1,l=!0,s=i.children[o],d=s&&!y(n,s);return c.KE.withoutNormalizing(i,()=>{ts(i,()=>{nu(i,()=>{if(d&&l){let d=[r[o]],p=ox(d,e.schema,e.keyGenerator);!p.valid&&p.resolution?.autoResolve&&p.resolution?.patches.length>0&&!e.readOnly&&e.previousValue&&e.previousValue!==r&&(console.warn(`${p.resolution.action} for block with _key '${d[0]._key}'. ${p.resolution?.description}`),p.resolution.patches.forEach(e=>{t({type:"patch",patch:e})})),p.valid||p.resolution?.autoResolve?(s._key===n._key?(o_.enabled&&o_("Updating block",s,n),function(e,t,n,o){if(c.gB.setNodes(e,t,{at:[o]}),e.isTextBlock(t)&&e.isTextBlock(n)){let i=n.children.length;t.children.length<i&&Array.from(Array(i-t.children.length)).forEach((t,n)=>{let r=i-1-n;r>0&&(o_("Removing child"),c.gB.removeNodes(e,{at:[o,r]}))}),t.children.forEach((t,i)=>{let r=n.children[i],a=!y(t,r),l=!y(t.text,r?.text),s=[o,i];if(a)if(t._key===r?._key){o_("Updating changed child",t,r),c.gB.setNodes(e,t,{at:s});let n=c.EY.isText(t)&&"span"===t._type&&c.EY.isText(r)&&"span"===r._type;n&&l?(r.text.length>0&&(0,c.JG)(e,{at:{focus:{path:s,offset:0},anchor:{path:s,offset:r.text.length}}}),c.gB.insertText(e,t.text,{at:s}),e.onChange()):n||(o_("Updating changed inline object child",t),c.gB.setNodes(e,{_key:U},{at:[...s,0],voids:!0}))}else r?(o_("Replacing child",t),c.gB.removeNodes(e,{at:[o,i]}),c.gB.insertNodes(e,t,{at:[o,i]}),e.onChange()):r||(o_("Inserting new child",t),c.gB.insertNodes(e,t,{at:[o,i]}),e.onChange())})}}(i,n,s,o)):(o_.enabled&&o_("Replacing block",s,n),function(e,t,n){let o=e.selection,i=o&&o.focus.path[0]===n;i&&c.gB.deselect(e),c.gB.removeNodes(e,{at:[n]}),c.gB.insertNodes(e,t,{at:[n]}),e.onChange(),i&&c.gB.select(e,o)}(i,n,o)),a=!0):(t({type:"invalid value",resolution:p.resolution,value:r}),l=!1)}if(!s&&l){let a=ox([r[o]],e.schema,e.keyGenerator);o_.enabled&&o_("Validating and inserting new block in the end of the value",n),a.valid||a.resolution?.autoResolve?c.gB.insertNodes(i,n,{at:[o]}):(o_("Invalid",a),t({type:"invalid value",resolution:a.resolution,value:r}),l=!1)}})})}),{blockChanged:a,blockValid:l}}let oA=G("setup");function oO(e){oA("Creating new Editor instance");let t=[],n=(0,w.c)(og,{input:function(e){let{legacySchema:t,schema:n}=function(e){var t;let n=e.schemaDefinition?(0,B.P$)(e.schemaDefinition):(0,B.rV)(e.schema.hasOwnProperty("jsonType")?e.schema:(t=e.schema,A.Sj.compile({name:"blockTypeSchema",types:[t]}).get(t.name))),o=e.schemaDefinition?(0,g.Fc)(e.schemaDefinition):(0,B.LI)(n);return{legacySchema:n,schema:o}}(e);return{converters:[tn,to,{mimeType:"text/html",serialize:({snapshot:e,event:t})=>{if(!e.context.selection)return{type:"serialization.failure",mimeType:"text/html",originEvent:t.originEvent,reason:"No selection"};let n=(0,k.lN)(e),o=(0,T.FE)(n,{onMissingComponent:!1,components:{unknownType:({children:e})=>void 0!==e?`${e}`:""}});return""===o?{type:"serialization.failure",mimeType:"text/html",originEvent:t.originEvent,reason:"Serialized HTML is empty"}:{type:"serialization.success",data:o,mimeType:"text/html",originEvent:t.originEvent}},deserialize:({snapshot:e,event:n})=>{let o=(0,K.l$)(n.data,t.portableText,{keyGenerator:e.context.keyGenerator,unstable_whitespaceOnPasteMode:t.block.options.unstable_whitespaceOnPasteMode}).flatMap(t=>{let n=(0,f.rT)({context:e.context,block:t,options:{removeUnusedMarkDefs:!0,validateFields:!1}});return n?[n]:[]});return 0===o.length?{type:"deserialization.failure",mimeType:"text/html",reason:"No blocks deserialized"}:{type:"deserialization.success",data:o,mimeType:"text/html"}}},{mimeType:"text/plain",serialize:({snapshot:e,event:t})=>e.context.selection?{type:"serialization.success",data:(0,k.lN)(e).map(n=>(0,g.zS)(e.context,n)?n.children.map(n=>n._type===e.context.schema.span.name?n.text:"drag.dragstart"===t.originEvent?`[${e.context.schema.inlineObjects.find(e=>e.name===n._type)?.title??"Object"}]`:"").join(""):"drag.dragstart"===t.originEvent?`[${e.context.schema.blockObjects.find(e=>e.name===n._type)?.title??"Object"}]`:"").filter(e=>""!==e).join(`

`),mimeType:"text/plain",originEvent:t.originEvent}:{type:"serialization.failure",mimeType:"text/plain",originEvent:t.originEvent,reason:"No selection"},deserialize:({snapshot:e,event:n})=>{let o=`<html><body>${String(n.data).replace(/[&<>"'`=/]/g,e=>ti[e]).split(/\n{2,}/).map(e=>e?`<p>${e.replace(/(?:\r\n|\r|\n)/g,"<br/>")}</p>`:"<p></p>").join("")}</body></html>`,i=(0,K.l$)(o,t.portableText,{keyGenerator:e.context.keyGenerator}).flatMap(t=>{let n=(0,f.rT)({context:e.context,block:t,options:{removeUnusedMarkDefs:!0,validateFields:!1}});return n?[n]:[]});return 0===i.length?{type:"deserialization.failure",mimeType:"text/plain",reason:"No blocks deserialized"}:{type:"deserialization.success",data:i,mimeType:"text/plain"}}}],getLegacySchema:()=>t,keyGenerator:e.keyGenerator??f.OL,maxBlocks:e.maxBlocks,readOnly:e.readOnly,schema:n,initialValue:e.initialValue}}(e)}),o=(0,w.c)(ob),i=function(e){nS("Creating new Slate editor instance");let t=((e,t)=>{var n,o,i,r,a;let{editorActor:l,relayActor:s}=t,d=(n=l,function(e){let{apply:t,normalizeNode:o}=e;return e.apply=o=>{if(tc(e)||th(e)||tu(e))return void t(o);if("split_node"===o.type){let i=[...c.bP.descendants(e)].map(([e])=>e._key);t({...o,properties:{...o.properties,_key:void 0===o.properties._key||i.includes(o.properties._key)?n.getSnapshot().context.keyGenerator():o.properties._key}});return}if("insert_node"===o.type&&!c.KE.isEditor(o.node)){let i=[...c.bP.descendants(e)].map(([e])=>e._key);t({...o,node:{...o.node,_key:void 0===o.node._key||i.includes(o.node._key)?n.getSnapshot().context.keyGenerator():o.node._key}});return}if("merge_node"===o.type){let i=o.path[o.path.length-1],r=c.wA.previous(o.path),a=r[r.length-1];if(1!==o.path.length||1!==r.length)return void t(o);let l=e.value.at(i),s=e.value.at(a);if(!l||!s||!(0,g.zS)(n.getSnapshot().context,l)||!(0,g.zS)(n.getSnapshot().context,s))return void t(o);let d=s.children.map(e=>e._key),p=s.markDefs?.map(e=>e._key)??[],h=new Map,u=l.markDefs?.map(e=>{if(p.includes(e._key)){let t=n.getSnapshot().context.keyGenerator();return h.set(e._key,t),{...e,_key:t}}return e}),f=0;for(let t of l.children){if((0,g.bl)(n.getSnapshot().context,t)){let n=t.marks?.map(e=>h.get(e)||e)??[];y(t.marks,n)||c.gB.setNodes(e,{marks:n},{at:[i,f]})}d.includes(t._key)&&c.gB.setNodes(e,{_key:n.getSnapshot().context.keyGenerator()},{at:[i,f]}),f++}return void t({...o,properties:{...o.properties,markDefs:u}})}t(o)},e.normalizeNode=t=>{let[i,r]=t;if(c.Hg.isElement(i)&&i._type===n.getSnapshot().context.schema.block.name){if(!i._key){n.send({type:"normalizing"}),c.gB.setNodes(e,{_key:n.getSnapshot().context.keyGenerator()},{at:r}),n.send({type:"done normalizing"});return}for(let[t,o]of c.bP.children(e,r))if(!t._key){n.send({type:"normalizing"}),c.gB.setNodes(e,{_key:n.getSnapshot().context.keyGenerator()},{at:o}),n.send({type:"done normalizing"});return}}o(t)},e}),p=function({editorActor:e}){return function(t){t.isTextBlock=t=>!c.KE.isEditor(t)&&(0,g.zS)(e.getSnapshot().context,t),t.isTextSpan=t=>!c.KE.isEditor(t)&&(0,g.bl)(e.getSnapshot().context,t),t.isListBlock=t=>!c.KE.isEditor(t)&&(0,f.Eg)(e.getSnapshot().context,t),t.isVoid=t=>!c.KE.isEditor(t)&&e.getSnapshot().context.schema.block.name!==t._type&&(e.getSnapshot().context.schema.blockObjects.map(e=>e.name).includes(t._type)||e.getSnapshot().context.schema.inlineObjects.map(e=>e.name).includes(t._type)),t.isInline=t=>!c.KE.isEditor(t)&&e.getSnapshot().context.schema.inlineObjects.map(e=>e.name).includes(t._type)&&"__inline"in t&&!0===t.__inline;let{normalizeNode:n}=t;return t.normalizeNode=o=>{let[i,r]=o;if(void 0===i._type&&2===r.length){ng("Setting span type on text node without a type");let n=i._key||e.getSnapshot().context.keyGenerator();e.send({type:"normalizing"}),c.gB.setNodes(t,{...i,_type:e.getSnapshot().context.schema.span.name,_key:n},{at:r}),e.send({type:"done normalizing"});return}if(void 0===i._key&&(1===r.length||2===r.length)){ng("Setting missing key on child node without a key");let n=e.getSnapshot().context.keyGenerator();e.send({type:"normalizing"}),c.gB.setNodes(t,{_key:n},{at:r}),e.send({type:"done normalizing"});return}n(o)},t}}({editorActor:l}),h=function({editorActor:e,relayActor:t,subscriptions:n}){var o;let i,r=(o=e.getSnapshot().context.schema,(e,t)=>{let n=!1;try{switch(t.type){case"insert":n=function(e,t,n){let o=nd(e.children,t.path);if(!o||t.path.length>1&&"children"!==t.path[1])return!1;if(1===t.path.length){let{items:i,position:r}=t,a=H(i,{schemaTypes:n},e0.get(e)),l=o.index,s="after"===r?l+1:l,d=W(e.children,n);return c.gB.insertNodes(e,a,{at:[s]}),d&&"number"==typeof t.path[0]&&0===t.path[0]&&c.gB.removeNodes(e,{at:["before"===r?l+1:l]}),!0}let{items:i,position:r}=t,a=np(o,t.path);if(!a)return!1;let l=H([{...o.node,children:i}],{schemaTypes:n},e0.get(e)),s="after"===r?a.index+1:a.index,d=[o.index,s];return l&&c.Hg.isElement(l[0])&&c.gB.insertNodes(e,l[0].children,{at:d}),!0}(e,t,o);break;case"unset":n=function(e,t){if(0===t.path.length){let t=e.selection;for(let[t,n]of(c.gB.deselect(e),c.bP.children(e,[],{reverse:!0})))c.gB.removeNodes(e,{at:n});return c.gB.insertNodes(e,e.pteCreateTextBlock({decorators:[]})),t&&c.gB.select(e,{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0}}),e.onChange(),!0}let n=nd(e.children,t.path);if(!n)return!1;if(1===t.path.length){if(1===e.children.length){let t=e.selection;return c.gB.deselect(e),c.gB.removeNodes(e,{at:[n.index]}),c.gB.insertNodes(e,e.pteCreateTextBlock({decorators:[]})),t&&c.gB.select(e,{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0}}),e.onChange(),!0}return c.gB.removeNodes(e,{at:[n.index]}),!0}let o=np(n,t.path);if(e.isTextBlock(n.node)&&o&&"children"===t.path[1]&&3===t.path.length)return c.gB.removeNodes(e,{at:[n.index,o.index]}),!0;if(o&&!c.EY.isText(o.node)){let i=t.path.slice(3).at(0);if(void 0===i||"string"==typeof i&&["_key","_type","children","__inline"].includes(i))return!1;let r="value"in o.node&&"object"==typeof o.node.value?o.node.value:{},a=(0,N.yl)(r,[{...t,path:t.path.slice(3)}]);return c.gB.setNodes(e,{...o.node,value:a},{at:[n.index,o.index]}),!0}if(o&&c.EY.isText(o.node)){let i=t.path.slice(3),r=i.at(0);if(void 0===r||"string"==typeof r&&["_key","_type"].includes(r))return!1;if("string"==typeof r&&"text"===r)return e.apply({type:"remove_text",path:[n.index,o.index],offset:0,text:o.node.text}),!0;let a=Object.keys((0,N.yl)(o.node,[{...t,path:i}])),l=Object.keys(o.node).filter(e=>!a.includes(e));return c.gB.unsetNodes(e,l,{at:[n.index,o.index]}),!0}if(!o&&"value"in n.node){let o=(0,N.yl)(n.node.value,[{...t,path:t.path.slice(1)}]);return c.gB.setNodes(e,{...n.node,value:o},{at:[n.index]}),!0}return!1}(e,t);break;case"set":n=function(e,t){let n=t.value;"string"==typeof t.path[3]&&((n={})[t.path[3]]=t.value);let o=nd(e.children,t.path);if(!o)return!1;let i=e.isTextBlock(o.node);if(i&&t.path.length>1&&"children"!==t.path[1])return!1;let r=np(o,t.path);if(i&&r)if(c.EY.isText(r.node))if(c.EY.isText(n)){let t=r.node.text,i=n.text;t!==i&&(e.apply({type:"remove_text",path:[o.index,r.index],offset:0,text:t}),e.apply({type:"insert_text",path:[o.index,r.index],offset:0,text:i}),e.onChange())}else{let n=t.path.slice(3),i=n.at(0);if(void 0===i||"string"==typeof i&&["_key","_type","text"].includes(i))return!1;let a=(0,N.yl)(r.node,[{...t,path:n}]);c.gB.setNodes(e,a,{at:[o.index,r.index]})}else{let n=t.path.slice(3).at(0);if(void 0===n||"string"==typeof n&&["_key","_type","children","__inline"].includes(n))return!1;let i="value"in r.node&&"object"==typeof r.node.value?r.node.value:{},a=(0,N.yl)(i,[{...t,path:t.path.slice(3)}]);c.gB.setNodes(e,{...r.node,value:a},{at:[o.index,r.index]})}else if(c.Hg.isElement(o.node)&&1===t.path.length){let{children:t,...i}=n,{children:r,...a}=o.node||{children:void 0};e.apply({type:"set_node",path:[o.index],properties:{...a},newProperties:i});let l=o.node;l.children.forEach((t,n)=>{e.apply({type:"remove_node",path:[o.index,l.children.length-1-n],node:t})}),Array.isArray(t)&&t.forEach((t,n)=>{e.apply({type:"insert_node",path:[o.index,n],node:t})})}else if(o&&"value"in o.node)if(!(t.path.length>1)||"children"===t.path[1])return!1;else{let n=(0,N.yl)(o.node.value,[{...t,path:t.path.slice(1)}]);c.gB.setNodes(e,{...o.node,value:n},{at:[o.index]})}return!0}(e,t);break;case"diffMatchPatch":n=function(e,t){let n=nd(e.children,t.path);if(!n)return!1;let o=np(n,t.path);if(!o||!(n&&e.isTextBlock(n.node)&&4===t.path.length&&"children"===t.path[1]&&"text"===t.path[3])||!c.EY.isText(o.node))return!1;let[i]=function(e,t,n={}){if("string"==typeof e)throw Error("Patches must be an array - pass the patch to `parsePatch()` first");let o=t;if(0===e.length)return[o,[]];let i=function(e,t,n={}){let o=0,i=0;function r(e){for(;o<e;){let e=t.codePointAt(i);if(typeof e>"u")return i;o+=tY(e),e>65535?i+=2:i+=1}if(!n.allowExceedingIndices&&o!==e)throw Error("Failed to determine byte offset");return i}let a=[];for(let t of e)a.push({diffs:t.diffs.map(e=>ty(e)),start1:r(t.start1),start2:r(t.start2),utf8Start1:t.utf8Start1,utf8Start2:t.utf8Start2,length1:t.length1,length2:t.length2,utf8Length1:t.utf8Length1,utf8Length2:t.utf8Length2});return a}(e,o,{allowExceedingIndices:n.allowExceedingIndices}),r=n.margin||4,a=n.deleteThreshold||.4,l=function(e,t=4){let n="";for(let e=1;e<=t;e++)n+=String.fromCharCode(e);for(let n of e)n.start1+=t,n.start2+=t,n.utf8Start1+=t,n.utf8Start2+=t;let o=e[0],i=o.diffs;if(0===i.length||0!==i[0][0])i.unshift([0,n]),o.start1-=t,o.start2-=t,o.utf8Start1-=t,o.utf8Start2-=t,o.length1+=t,o.length2+=t,o.utf8Length1+=t,o.utf8Length2+=t;else if(t>i[0][1].length){let e=i[0][1].length,r=t-e;i[0][1]=n.substring(e)+i[0][1],o.start1-=r,o.start2-=r,o.utf8Start1-=r,o.utf8Start2-=r,o.length1+=r,o.length2+=r,o.utf8Length1+=r,o.utf8Length2+=r}if(0===(i=(o=e[e.length-1]).diffs).length||0!==i[i.length-1][0])i.push([0,n]),o.length1+=t,o.length2+=t,o.utf8Length1+=t,o.utf8Length2+=t;else if(t>i[i.length-1][1].length){let e=t-i[i.length-1][1].length;i[i.length-1][1]+=n.substring(0,e),o.length1+=e,o.length2+=e,o.utf8Length1+=e,o.utf8Length2+=e}return n}(i,r);o=l+o+l,function(e,t=4){for(let n=0;n<e.length;n++){if(e[n].length1<=32)continue;let o=e[n];e.splice(n--,1);let i=o.start1,r=o.start2,a="";for(;0!==o.diffs.length;){let l=tq(i-a.length,r-a.length),s=!0;if(""!==a){let e=tJ(a);l.length1=a.length,l.utf8Length1=e,l.length2=a.length,l.utf8Length2=e,l.diffs.push([0,a])}for(;0!==o.diffs.length&&l.length1<32-t;){let e=o.diffs[0][0],n=o.diffs[0][1],a=tJ(n);if(1===e){l.length2+=n.length,l.utf8Length2+=a,r+=n.length;let e=o.diffs.shift();e&&l.diffs.push(e),s=!1}else -1===e&&1===l.diffs.length&&0===l.diffs[0][0]&&n.length>64?(l.length1+=n.length,l.utf8Length1+=a,i+=n.length,s=!1,l.diffs.push([e,n]),o.diffs.shift()):(a=tJ(n=n.substring(0,32-l.length1-t)),l.length1+=n.length,l.utf8Length1+=a,i+=n.length,0===e?(l.length2+=n.length,l.utf8Length2+=a,r+=n.length):s=!1,l.diffs.push([e,n]),n===o.diffs[0][1]?o.diffs.shift():o.diffs[0][1]=o.diffs[0][1].substring(n.length))}a=(a=tQ(l.diffs)).substring(a.length-t);let c=tH(o.diffs).substring(0,t),d=tJ(c);""!==c&&(l.length1+=c.length,l.length2+=c.length,l.utf8Length1+=d,l.utf8Length2+=d,0!==l.diffs.length&&0===l.diffs[l.diffs.length-1][0]?l.diffs[l.diffs.length-1][1]+=c:l.diffs.push([0,c])),s||e.splice(++n,0,l)}}}(i,r);let s=0,c=[];for(let e=0;e<i.length;e++){let t=i[e].start2+s,n=tH(i[e].diffs),r,l=-1;if(n.length>32?-1!==(r=tF(o,n.substring(0,32),t))&&(-1===(l=tF(o,n.substring(n.length-32),t+n.length-32))||r>=l)&&(r=-1):r=tF(o,n,t),-1===r)c[e]=!1,s-=i[e].length2-i[e].length1;else{let d;if(c[e]=!0,s=r-t,d=-1===l?o.substring(r,r+n.length):o.substring(r,l+32),n===d)o=o.substring(0,r)+tQ(i[e].diffs)+o.substring(r+n.length);else{let t=tB(n,d,{checkLines:!1});if(n.length>32&&function(e){let t=0,n=0,o=0;for(let i=0;i<e.length;i++){let r=e[i][0],a=e[i][1];switch(r){case 1:n+=a.length;break;case -1:o+=a.length;break;case 0:t+=Math.max(n,o),n=0,o=0;break;default:throw Error("Unknown diff operation.")}}return t+Math.max(n,o)}(t)/n.length>a)c[e]=!1;else{t=tC(t);let n=0,a=0;for(let l=0;l<i[e].diffs.length;l++){let s=i[e].diffs[l];0!==s[0]&&(a=tW(t,n)),1===s[0]?o=o.substring(0,r+a)+s[1]+o.substring(r+a):-1===s[0]&&(o=o.substring(0,r+a)+o.substring(r+tW(t,n+s[1].length))),-1!==s[0]&&(n+=s[1].length)}}}}}return[o=o.substring(l.length,o.length-l.length),c]}(tX(t.value),o.node.text,{allowExceedingIndices:!0}),r=function(e,t=4){let n=e.map(e=>ty(e)),o=!1,i=[],r=0,a=null,l=0,s=!1,c=!1,d=!1,p=!1;for(;l<n.length;)0===n[l][0]?(n[l][1].length<t&&(d||p)?(i[r++]=l,s=d,c=p,a=n[l][1]):(r=0,a=null),d=!1,p=!1):(-1===n[l][0]?p=!0:d=!0,a&&(s&&c&&d&&p||a.length<t/2&&3===function(...e){return e.reduce((e,t)=>e+ +!!t,0)}(s,c,d,p))&&(n.splice(i[r-1],0,[-1,a]),n[i[r-1]+1][0]=1,r--,a=null,s&&c?(d=!0,p=!0,r=0):(l=--r>0?i[r-1]:-1,d=!1,p=!1),o=!0)),l++;return o&&(n=tP(n)),n}(tB(o.node.text,i),5),a=0;for(let[t,i]of r)1===t?(e.apply({type:"insert_text",path:[n.index,o.index],offset:a,text:i}),a+=i.length):-1===t?e.apply({type:"remove_text",path:[n.index,o.index],offset:a,text:i}):0===t&&(a+=i.length);return!0}(e,t)}}catch(e){console.error(e)}return n});return function(o){eX.set(o,!1),nh.set(o,!0),i=[...o.children];let{apply:a}=o,l=[],s=({patches:e})=>{let t=e.filter(e=>"local"!==e.origin);0!==t.length&&(l=l.concat(t),(()=>{if(0===l.length)return;let e=l;l=[];let t=!1;ts(o,()=>{c.KE.withoutNormalizing(o,()=>{nu(o,()=>{nn(o,()=>{for(let n of e){nf.enabled&&nf(`Handling remote patch ${JSON.stringify(n)}`);try{t=r(o,n)}catch(e){console.error(`Applying patch ${JSON.stringify(n)} failed due to: ${e.message}`)}}})})}),t&&(o.normalize(),o.onChange())})})())};return n.push(()=>{nf("Subscribing to remote patches");let t=e.on("patches",s);return()=>{nf("Unsubscribing to remote patches"),t.unsubscribe()}}),o.apply=n=>{let r=[],l=W(i=o.children,e.getSnapshot().context.schema);a(n);let s=W(o.children,e.getSnapshot().context.schema);if(!nh.get(o))return o;switch(l&&!s&&"set_selection"!==n.type&&r.push((0,N.Yr)(i,"before",[0])),n.type){case"insert_text":r=[...r,...function(e,t,n,o){let i=(0,g.zS)({schema:e},t[n.path[0]])&&t[n.path[0]];if(!i)throw Error("Could not find block");let r=(0,g.zS)({schema:e},i)&&(0,g.bl)({schema:e},i.children[n.path[1]])&&i.children[n.path[1]];if(!r)throw Error("Could not find child");let a=[{_key:i._key},"children",{_key:r._key},"text"],l=o[n.path[0]],s=(0,g.zS)({schema:e},l)&&l.children[n.path[1]],c=(0,g.bl)({schema:e},s)?s.text:"",d=(0,N.jo)(c,r.text,a);return d.value.length?[d]:[]}(e.getSnapshot().context.schema,o.children,n,i)];break;case"remove_text":r=[...r,...function(e,t,n,o){let i=t[n.path[0]];if(!i)throw Error("Could not find block");let r=(0,g.zS)({schema:e},i)&&i.children[n.path[1]]||void 0,a=(0,g.bl)({schema:e},r)?r:void 0;if(r&&!a)throw Error("Expected span");if(!a)throw Error("Could not find child");let l=[{_key:i._key},"children",{_key:a._key},"text"],s=o[n.path[0]],c=(0,g.zS)({schema:e},s)&&s.children[n.path[1]],d=(0,g.bl)({schema:e},c)&&c.text,p=(0,N.jo)(d||"",a.text,l);return p.value?[p]:[]}(e.getSnapshot().context.schema,o.children,n,i)];break;case"remove_node":r=[...r,...function(e,t,n){let o=t[n.path[0]];if(1===n.path.length){if(o&&o._key)return[(0,N.wC)([{_key:o._key}])];throw Error("Block not found")}if(!(0,g.zS)({schema:e},o)||2!==n.path.length)return[];{let e=o.children[n.path[1]];return e?o.children.filter(e=>e._key===n.node._key).length>1?(console.warn(`Multiple spans have \`_key\` ${n.node._key}. It's ambiguous which one to remove.`,JSON.stringify(o,null,2)),[]):[(0,N.wC)([{_key:o._key},"children",{_key:e._key}])]:[]}}(e.getSnapshot().context.schema,i,n)];break;case"split_node":r=[...r,...function(e,t,n,o){let i=[],r=t[n.path[0]];if(!(0,g.zS)({schema:e},r))throw Error(`Block with path ${JSON.stringify(n.path[0])} is not a text block and can't be split`);if(1===n.path.length){let a=o[n.path[0]];if((0,g.zS)({schema:e},a)){let o=Q([t[n.path[0]+1]],e.block.name)[0];o&&(i.push((0,N.Yr)([o],"after",[{_key:r._key}])),a.children.slice(n.position).forEach(e=>{let t=[{_key:a._key},"children",{_key:e._key}];i.push((0,N.wC)(t))}))}return i}if(2===n.path.length){let t=r.children[n.path[1]];if((0,g.bl)({schema:e},t)){let o=Q([{...r,children:r.children.slice(n.path[1]+1,n.path[1]+2)}],e.block.name)[0].children;i.push((0,N.Yr)(o,"after",[{_key:r._key},"children",{_key:t._key}])),i.push((0,N.hZ)(t.text,[{_key:r._key},"children",{_key:t._key},"text"]))}}return i}(e.getSnapshot().context.schema,o.children,n,i)];break;case"insert_node":r=[...r,...function(e,t,n,o){let i=o[n.path[0]];if(1===n.path.length){let t=0===n.path[0]?"before":"after",r=o[n.path[0]-1],a=0===n.path[0]?i?._key:r?._key;return a?[(0,N.Yr)([Q([n.node],e.block.name)[0]],t,[{_key:a}])]:[(0,N.Wm)(o,[]),(0,N.Yr)([Q([n.node],e.block.name)[0]],"before",[n.path[0]])]}if((0,g.zS)({schema:e},i)&&2===n.path.length&&t[n.path[0]]){let t=0!==i.children.length&&i.children[n.path[1]-1]?"after":"before",o={...n.node};!o._type&&c.EY.isText(o)&&(o._type="span",o.marks=[]);let r=Q([{_key:"bogus",_type:e.block.name,children:[o]}],e.block.name)[0].children[0];return[(0,N.Yr)([r],t,[{_key:i._key},"children",i.children.length<=1||!i.children[n.path[1]-1]?0:{_key:i.children[n.path[1]-1]._key}])]}return[]}(e.getSnapshot().context.schema,o.children,n,i)];break;case"set_node":r=[...r,...function(e,t,n){if(1===n.path.length){let o=t[n.path[0]];if("string"!=typeof o._key)throw Error("Expected block to have a _key");let i=P({...t[n.path[0]],...n.newProperties},C);return[(0,N.hZ)(Q([i],e.block.name)[0],[{_key:o._key}])]}if(2===n.path.length){let o=t[n.path[0]];if((0,g.zS)({schema:e},o)){let e=o.children[n.path[1]];if(e){let t=o._key,i=e._key,r=[],a=Object.keys(n.newProperties);return a.forEach(l=>{if(1===a.length&&"_key"===l){let i=j(n.newProperties,l);r.push((0,N.hZ)(i,[{_key:t},"children",o.children.indexOf(e),l]))}else{let e=j(n.newProperties,l);r.push((0,N.hZ)(e,[{_key:t},"children",{_key:i},l]))}}),r}throw Error("Could not find a valid child")}throw Error("Could not find a valid block")}throw Error(`Unexpected path encountered: ${JSON.stringify(n.path)}`)}(e.getSnapshot().context.schema,o.children,n)];break;case"merge_node":r=[...r,...function(e,t,n,o){let i=[],r=o[n.path[0]],a=t[n.path[0]];if(1===n.path.length)if(r?._key){let o=Q([t[n.path[0]-1]],e.block.name)[0];i.push((0,N.hZ)(o,[{_key:o._key}])),i.push((0,N.wC)([{_key:r._key}]))}else throw Error("Target key not found!");else if((0,g.zS)({schema:e},r)&&(0,g.zS)({schema:e},a)&&2===n.path.length){let t=a.children[n.path[1]-1]&&(0,g.bl)({schema:e},a.children[n.path[1]-1])?a.children[n.path[1]-1]:void 0,o=r.children[n.path[1]]&&(0,g.bl)({schema:e},r.children[n.path[1]])?r.children[n.path[1]]:void 0;t&&(1===r.children.filter(e=>e._key===t._key).length?i.push((0,N.hZ)(t.text,[{_key:r._key},"children",{_key:t._key},"text"])):console.warn(`Multiple spans have \`_key\` ${t._key}. It's ambiguous which one to update.`,JSON.stringify(r,null,2))),o&&(1===r.children.filter(e=>e._key===o._key).length?i.push((0,N.wC)([{_key:r._key},"children",{_key:o._key}])):console.warn(`Multiple spans have \`_key\` ${o._key}. It's ambiguous which one to remove.`,JSON.stringify(r,null,2)))}return i}(e.getSnapshot().context.schema,o.children,n,i)];break;case"move_node":r=[...r,...function(e,t,n){let o=[],i=t[n.path[0]],r=t[n.newPath[0]];if(!r)return o;if(1===n.path.length){let t=n.path[0]>n.newPath[0]?"before":"after";o.push((0,N.wC)([{_key:i._key}])),o.push((0,N.Yr)([Q([i],e.block.name)[0]],t,[{_key:r._key}]))}else if(2===n.path.length&&(0,g.zS)({schema:e},i)&&(0,g.zS)({schema:e},r)){let t=i.children[n.path[1]],a=r.children[n.newPath[1]],l=n.newPath[1]===r.children.length?"after":"before",s=Q([i],e.block.name)[0].children[n.path[1]];o.push((0,N.wC)([{_key:i._key},"children",{_key:t._key}])),o.push((0,N.Yr)([s],l,[{_key:r._key},"children",{_key:a._key}]))}return o}(e.getSnapshot().context.schema,i,n)]}if(!l&&s&&["merge_node","set_node","remove_text","remove_node"].includes(n.type)&&(r=[...r,(0,N.wC)([])],t.send({type:"unset",previousValue:Q(i,e.getSnapshot().context.schema.block.name,e1.get(o))})),l&&r.length>0&&(r=[(0,N.Wm)([],[]),...r]),r.length>0)for(let t of r)e.send({type:"internal.patch",patch:{...t,origin:"local"},operationId:t2(o),value:o.value});return o},o}}({editorActor:l,relayActor:s,subscriptions:t.subscriptions}),u=(o=l,function(e){let{apply:t}=e;return e.apply=n=>{if(o.getSnapshot().matches({"edit mode":"read only"})||tc(e)||th(e)||tu(e))return void t(n);let i=o.getSnapshot().context.maxBlocks??-1;i>0&&e.children.length>=i&&("insert_node"===n.type||"split_node"===n.type)&&1===n.path.length||t(n)},e}),k=function(e){let{editorActor:t}=e;return n=>{let o=Q(n.children,t.getSnapshot().context.schema.block.name),i=t9(n),r=t2(n);e.subscriptions.push(()=>{t6("Subscribing to patches");let e=t.on("patches",({patches:e,snapshot:t})=>{let r=!1;e.forEach(e=>{if(!r&&"local"!==e.origin&&i){if("unset"===e.type&&0===e.path.length){t6("Someone else cleared the content, resetting undo/redo history"),n.history={undos:[],redos:[]},i.splice(0,i.length),t8.set(n,!0),r=!0;return}i.push({patch:e,time:new Date,snapshot:t,previousSnapshot:o})}}),o=t});return()=>{t6("Unsubscribing to patches"),e.unsubscribe()}}),n.history={undos:[],redos:[]};let{apply:a}=n;return n.apply=e=>{let o,i;if(t.getSnapshot().matches({"edit mode":"read only"})||tc(n)||th(n)||tu(n))return void a(e);let{operations:l,history:s}=n,{undos:d}=s,p=d[d.length-1],h=p&&p.operations&&p.operations[p.operations.length-1],u=(o=e,!!((i=h)&&"set_selection"===o.type&&"set_selection"===i.type)),f=t7(n),y=t2(n),g=y===r;if(f){let t,o;if(p?0===l.length&&(g=void 0===y&&void 0===r?(t=e,o=h,!!("set_selection"===t.type||o&&"insert_text"===t.type&&"insert_text"===o.type&&t.offset===o.offset+o.text.length&&c.wA.equals(t.path,o.path)&&" "!==t.text||o&&"remove_text"===t.type&&"remove_text"===o.type&&t.offset+t.text.length===o.offset&&c.wA.equals(t.path,o.path))||u):g):g=!1,p&&g)p.operations.push(e);else{var m;let t={operations:[...null===n.selection?[]:[{type:"set_selection",properties:{...(m=n).selection},newProperties:{...m.selection}}],e],timestamp:new Date};d.push(t),t6("Created new undo step",p)}for(;d.length>1e3;)d.shift();"set_selection"!==e.type&&(s.redos=[])}r=y,a(e)},n}}({editorActor:l,subscriptions:t.subscriptions}),v=(i=l,function(e){let{apply:t,normalizeNode:n}=e,o=i.getSnapshot().context.schema.decorators.map(e=>e.name);return e.normalizeNode=t=>{let[o,r]=t;if(e.isTextBlock(o))for(let[t,n]of c.bP.children(e,r)){let r=o.children[n[1]+1];if(e.isTextSpan(t)&&e.isTextSpan(r)&&t.marks?.every(e=>r.marks?.includes(e))&&r.marks?.every(e=>t.marks?.includes(e))){tf("Merging spans",JSON.stringify(t,null,2),JSON.stringify(r,null,2)),i.send({type:"normalizing"}),c.gB.mergeNodes(e,{at:[n[0],n[1]+1],voids:!0}),i.send({type:"done normalizing"});return}}if(e.isTextBlock(o)&&!Array.isArray(o.markDefs)){tf("Adding .markDefs to block node"),i.send({type:"normalizing"}),c.gB.setNodes(e,{markDefs:[]},{at:r}),i.send({type:"done normalizing"});return}if(e.isTextSpan(o)&&!Array.isArray(o.marks)){tf("Adding .marks to span node"),i.send({type:"normalizing"}),c.gB.setNodes(e,{marks:[]},{at:r}),i.send({type:"done normalizing"});return}if(e.isTextSpan(o)){let t=c.wA.parent(r),[n]=c.KE.node(e,t),a=i.getSnapshot().context.schema.decorators.map(e=>e.name),l=o.marks?.filter(e=>!a.includes(e));if(e.isTextBlock(n)&&""===o.text&&l&&l.length>0){tf("Removing annotations from empty span node"),i.send({type:"normalizing"}),c.gB.setNodes(e,{marks:o.marks?.filter(e=>a.includes(e))},{at:r}),i.send({type:"done normalizing"});return}}if(e.isTextBlock(o)){let t=i.getSnapshot().context.schema.decorators.map(e=>e.name);for(let[n,a]of c.bP.children(e,r))if(e.isTextSpan(n)){let r=n.marks??[],l=r.filter(e=>!t.includes(e)&&!o.markDefs?.find(t=>t._key===e));if(l.length>0){tf("Removing orphaned annotations from span node"),i.send({type:"normalizing"}),c.gB.setNodes(e,{marks:r.filter(e=>!l.includes(e))},{at:a}),i.send({type:"done normalizing"});return}}}if(e.isTextSpan(o)){let t=c.wA.parent(r),[n]=c.KE.node(e,t);if(e.isTextBlock(n)){let t=i.getSnapshot().context.schema.decorators.map(e=>e.name),a=o.marks??[],l=a.filter(e=>!t.includes(e)&&!n.markDefs?.find(t=>t._key===e));if(l.length>0){tf("Removing orphaned annotations from span node"),i.send({type:"normalizing"}),c.gB.setNodes(e,{marks:a.filter(e=>!l.includes(e))},{at:r}),i.send({type:"done normalizing"});return}}}if(e.isTextBlock(o)){let t=o.markDefs??[],n=new Set,a=[];for(let e of t)n.has(e._key)||(n.add(e._key),a.push(e));if(t.length!==a.length){tf("Removing duplicate markDefs"),i.send({type:"normalizing"}),c.gB.setNodes(e,{markDefs:a},{at:r}),i.send({type:"done normalizing"});return}}if(e.isTextBlock(o)&&!e.operations.some(e=>"merge_node"===e.type&&"markDefs"in e.properties&&1===e.path.length)){let t=(o.markDefs||[]).filter(e=>o.children.find(t=>c.EY.isText(t)&&Array.isArray(t.marks)&&t.marks.includes(e._key)));if(o.markDefs&&!y(t,o.markDefs)){tf("Removing markDef not in use"),i.send({type:"normalizing"}),c.gB.setNodes(e,{markDefs:t},{at:r}),i.send({type:"done normalizing"});return}}n(t)},e.apply=n=>{if(tc(e)||th(e)||tu(e))return void t(n);if("set_selection"===n.type&&n.properties&&n.newProperties&&n.properties.anchor&&n.properties.focus&&n.newProperties.anchor&&n.newProperties.focus){let t=c.Q6.isCollapsed({anchor:n.properties.anchor,focus:n.properties.focus}),o=c.Q6.isCollapsed({anchor:n.newProperties.anchor,focus:n.newProperties.focus});if(t&&o){let t=Array.from(c.KE.nodes(e,{mode:"lowest",at:n.properties.focus,match:t=>e.isTextSpan(t),voids:!1}))[0]?.[0],o=Array.from(c.KE.nodes(e,{mode:"lowest",at:n.newProperties.focus,match:t=>e.isTextSpan(t),voids:!1}))[0]?.[0],i=t&&o&&n.newProperties.focus.path[0]===n.properties.focus.path[0]&&n.newProperties.focus.path[1]===n.properties.focus.path[1]+1&&t.text.length===n.properties.focus.offset&&0===n.newProperties.focus.offset,r=t&&o&&n.newProperties.focus.path[0]===n.properties.focus.path[0]&&n.newProperties.focus.path[1]===n.properties.focus.path[1]-1&&0===n.properties.focus.offset&&o.text.length===n.newProperties.focus.offset;i||r||(e.decoratorState={})}}if("remove_text"===n.type){let{selection:r}=e;if(r&&c.Q6.isExpanded(r)){let[a,l]=c.KE.node(e,r,{depth:1}),[s,d]=Array.from(c.KE.nodes(e,{mode:"lowest",at:{path:n.path,offset:n.offset},match:t=>e.isTextSpan(t),voids:!1}))[0]??[void 0,void 0];if(s&&a&&(0,g.zS)(i.getSnapshot().context,a)){let r=a.markDefs??[],p=s.marks??[],h=p.some(e=>r.find(t=>t._key===e)),u=n.offset+n.text.length===s.text.length,f=0===n.offset&&u,y=function({editor:e,blockPath:t,spanPath:n}){let o;for(let[i,r]of c.bP.children(e,t,{reverse:!0}))if(e.isTextSpan(i)&&c.wA.isBefore(r,n)){o=i;break}return o}({editor:e,blockPath:l,spanPath:d}),g=function({editor:e,blockPath:t,spanPath:n}){let o;for(let[i,r]of c.bP.children(e,t))if(e.isTextSpan(i)&&c.wA.isAfter(r,n)){o=i;break}return o}({editor:e,blockPath:l,spanPath:d}),k=!!y&&y.marks?.some(e=>!o.includes(e)&&p.includes(e)),v=!!g&&g.marks?.some(e=>!o.includes(e)&&p.includes(e));if(h&&f&&!k&&!v){let o=eS({editorActorSnapshot:i.getSnapshot(),slateEditorInstance:e});c.KE.withoutNormalizing(e,()=>{t(n),c.gB.setNodes(e,{marks:(0,m.rm)(o)},{at:n.path})}),e.onChange();return}}}}if("merge_node"===n.type&&1===n.path.length&&"markDefs"in n.properties&&n.properties._type===i.getSnapshot().context.schema.block.name&&Array.isArray(n.properties.markDefs)&&n.properties.markDefs.length>0&&n.path[0]-1>=0){let[o,i]=c.KE.node(e,[n.path[0]-1]);if(e.isTextBlock(o)){let r=b([...Array.isArray(o.markDefs)&&o.markDefs||[],...n.properties.markDefs]);tf("Copying markDefs over to merged block",n),c.gB.setNodes(e,{markDefs:r},{at:i,voids:!1}),t(n);return}}t(n)},e}),x=(r=l,function(e){let{apply:t}=e;return e.apply=n=>{if(r.getSnapshot().matches({"edit mode":"read only"})||tc(e)||th(e)||tu(e))return void t(n);if("remove_node"===n.type){let t=n.path.at(0),o=1===n.path.length&&0===t&&1===e.children.length,i=n.node._type!==r.getSnapshot().context.schema.block.name;o&&i&&(ny("Adding placeholder block"),c.KE.insertNode(e,e.pteCreateTextBlock({decorators:[]})))}t(n)},e}),_=function({editorActor:e}){return function(t){return t.pteCreateTextBlock=t=>H([{_type:e.getSnapshot().context.schema.block.name,_key:e.getSnapshot().context.keyGenerator(),style:e.getSnapshot().context.schema.styles[0].name||"normal",...t.listItem?{listItem:t.listItem}:{},...t.level?{level:t.level}:{},markDefs:[],children:[{_type:"span",_key:e.getSnapshot().context.keyGenerator(),text:"",marks:t.decorators.filter(t=>e.getSnapshot().context.schema.decorators.find(({name:e})=>e===t))}]}],{schemaTypes:e.getSnapshot().context.schema})[0],t}}({editorActor:l});return(a=l,function(e){if(void 0!==a.getSnapshot().context.maxBlocks)return e;let{delete:t,select:n}=e;return e.delete=n=>{if(nc(e))return void t(n);let o=n?.at??e.selection;if(!o)return void console.error("Unexpected call to .delete(...) without `at` option");let i=c.KE.range(e,o),r=et({schema:a.getSnapshot().context.schema,editor:e,range:i});if(!r)return void console.error("Unexpected call to .delete(...) with invalid `at` option");a.send({type:"behavior event",behaviorEvent:{type:"delete",at:r,direction:n?.reverse?"backward":"forward",unit:n?.unit},editor:e})},e.deleteBackward=t=>{if(nc(e))return void console.error("Unexpected call to .deleteBackward(...)");a.send({type:"behavior event",behaviorEvent:{type:"delete.backward",unit:t},editor:e})},e.deleteForward=t=>{if(nc(e))return void console.error("Unexpected call to .deleteForward(...)");a.send({type:"behavior event",behaviorEvent:{type:"delete.forward",unit:t},editor:e})},e.insertBreak=()=>{if(nc(e))return void console.error("Unexpected call to .insertBreak(...)");a.send({type:"behavior event",behaviorEvent:{type:"insert.break"},editor:e})},e.insertData=t=>{if(nc(e))return void console.error("Unexpected call to .insertData(...)");a.send({type:"behavior event",behaviorEvent:{type:"input.*",originEvent:{dataTransfer:t}},editor:e})},e.insertSoftBreak=()=>{if(nc(e))return void na({context:{keyGenerator:a.getSnapshot().context.keyGenerator,schema:a.getSnapshot().context.schema},operation:{type:"insert.text",text:`
`,editor:e}});a.send({type:"behavior event",behaviorEvent:{type:"insert.soft break"},editor:e})},e.insertText=t=>{if(nc(e))return void na({context:{keyGenerator:a.getSnapshot().context.keyGenerator,schema:a.getSnapshot().context.schema},operation:{type:"insert.text",text:t,editor:e}});a.send({type:"behavior event",behaviorEvent:{type:"insert.text",text:t},editor:e})},e.redo=()=>{if(nc(e))return void na({context:{keyGenerator:a.getSnapshot().context.keyGenerator,schema:a.getSnapshot().context.schema},operation:{type:"history.redo",editor:e}});a.send({type:"behavior event",behaviorEvent:{type:"history.redo"},editor:e})},e.select=t=>{if(nc(e))return void n(t);let o=c.KE.range(e,t);a.send({type:"behavior event",behaviorEvent:{type:"select",at:et({schema:a.getSnapshot().context.schema,editor:e,range:o})},editor:e})},e.setFragmentData=()=>{console.error("Unexpected call to .setFragmentData(...)")},e.undo=()=>{if(nc(e))return void na({context:{keyGenerator:a.getSnapshot().context.keyGenerator,schema:a.getSnapshot().context.schema},operation:{type:"history.undo",editor:e}});a.send({type:"behavior event",behaviorEvent:{type:"history.undo"},editor:e})},e})(p(d(v(x(_(u(k(h(function(e,t){let{apply:n}=t;return t.apply=o=>{if("set_selection"===o.type||(t.value=function(e,t,n){let o=(0,z.mq)({children:t});try{!function(e,t,n){switch(n.type){case"insert_node":{let{path:o,node:i}=n,r=nw(e,t,o),a=o[o.length-1];if(!r||a>r.children.length)break;if(1===o.length){if(nk(e,i)){r.children.splice(a,0,{...i,children:i.children.map(e=>"__inline"in e?{_key:e._key,_type:e._type,..."value"in e&&"object"==typeof e.value?e.value:{}}:e)});break}if(c.Hg.isElement(i)&&!("__inline"in i)){r.children.splice(a,0,{_key:i._key,_type:i._type,..."value"in i&&"object"==typeof i.value?i.value:{}});break}}if(2===o.length){if(!nk(e,r))break;if(nb(i)){r.children.splice(a,0,i);break}"__inline"in i&&r.children.splice(a,0,{_key:i._key,_type:i._type,..."value"in i&&"object"==typeof i.value?i.value:{}})}break}case"insert_text":{let{path:o,offset:i,text:r}=n;if(0===r.length)break;let a=nE(e,t,o);if(!a)break;let l=a.text.slice(0,i),s=a.text.slice(i);a.text=l+r+s;break}case"merge_node":{let{path:o}=n,i=n_(e,t,o),r=n_(e,t,c.wA.previous(o)),a=nw(e,t,o);if(!i||!r||!a)break;let l=o[o.length-1];if(nb(i)&&nb(r))r.text+=i.text;else if(nk(e,i)&&nk(e,r))r.children.push(...i.children);else break;a.children.splice(l,1);break}case"move_node":{let{path:o,newPath:i}=n;if(c.wA.isAncestor(o,i))break;let r=n_(e,t,o),a=nw(e,t,o),l=o[o.length-1];if(!r||!a)break;a.children.splice(l,1);let s=c.wA.transform(o,n),d=n_(e,t,c.wA.parent(s)),p=s[s.length-1];if(!d||!("children"in d)||!Array.isArray(d.children))break;d.children.splice(p,0,r);break}case"remove_node":{let{path:o}=n,i=o[o.length-1];nw(e,t,o)?.children.splice(i,1);break}case"remove_text":{let{path:o,offset:i,text:r}=n;if(0===r.length)break;let a=nE(e,t,o);if(!a)break;let l=a.text.slice(0,i),s=a.text.slice(i+r.length);a.text=l+s;break}case"set_node":{let{path:o,properties:i,newProperties:r}=n,a=n_(e,t,o);if(!a||nm(a))break;if(!nm(a)&&!nk(e,a)&&!nv(e,a)&&!nb(a)){let e="value"in i&&"object"==typeof i.value?i.value:{},t="value"in r&&"object"==typeof r.value?r.value:{};for(let e in r){if("value"===e)continue;let t=r[e];null==t?delete a[e]:a[e]=t}for(let e in i)"value"!==e&&(r.hasOwnProperty(e)||delete a[e]);for(let e in t){let n=t[e];null==n?delete a[e]:a[e]=n}for(let n in e)t.hasOwnProperty(n)||delete a[n];break}if(nk(e,a)){for(let e in r){if("children"===e||"text"===e)break;let t=r[e];null==t?delete a[e]:a[e]=t}for(let e in i)r.hasOwnProperty(e)||delete a[e];break}if(nb(a)){for(let e in r){if("text"===e)break;let t=r[e];null==t?delete a[e]:a[e]=t}for(let e in i)r.hasOwnProperty(e)||delete a[e]}break}case"split_node":{let{path:o,position:i,properties:r}=n;if(0===o.length)break;let a=nw(e,t,o),l=o[o.length-1];if(!a)break;if(nm(a)){let n=nx(t,o);if(!n||!nk(e,n))break;let s=n.children.slice(0,i),c=n.children.slice(i);n.children=s;let d={...r,children:c,_type:e.schema.block.name};a.children.splice(l+1,0,d);break}if(nk(e,a)){let n=n_(e,t,o);if(!n||!nv(e,n))break;let s=n.text.slice(0,i),c=n.text.slice(i);n.text=s;let d={...r,text:c};a.children.splice(l+1,0,d)}}}}(e,o,n)}catch(e){console.error(e)}return(0,z.vD)(o).children}(e,t.value,o),"insert_text"===o.type||"remove_text"===o.type))return void n(o);ta({schema:e.schema,value:t.value},{blockIndexMap:t.blockIndexMap,listIndexMap:t.listIndexMap}),n(o)},t}(l.getSnapshot().context,function({editor:e,editorActor:t}){let{onChange:n}=e;return e.onChange=()=>{n(),t.getSnapshot().matches({setup:"setting up"})||(()=>{if(e.selection){let n=e2.get(e.selection);if(n)t.send({type:"update selection",selection:n});else{let n=et({schema:t.getSnapshot().context.schema,editor:e,range:e.selection});e2.set(e.selection,n),t.send({type:"update selection",selection:n})}}else t.send({type:"update selection",selection:null})})()},e}({editorActor:l,editor:e})))))))))))})((0,d.o$)((0,c.ie)()),{editorActor:e.editorActor,relayActor:e.relayActor,subscriptions:e.subscriptions});e1.set(t,{}),e0.set(t,{}),t.decoratedRanges=[],t.decoratorState={},t.value=[tl(e.editorActor.getSnapshot().context)],t.blockIndexMap=new Map,t.listIndexMap=new Map,ta({schema:e.editorActor.getSnapshot().context.schema,value:t.value},{blockIndexMap:t.blockIndexMap,listIndexMap:t.listIndexMap});let n=H(t.value,{schemaTypes:e.editorActor.getSnapshot().context.schema});return{instance:t,initialValue:n}}({editorActor:n,relayActor:o,subscriptions:t}),r=function(e,t){let n=t.getSnapshot().context.schema;return{focus:()=>{t.send({type:"focus",editor:e})},blur:()=>{t.send({type:"blur",editor:e})},toggleMark:n=>{t.send({type:"behavior event",behaviorEvent:{type:"decorator.toggle",decorator:n},editor:e})},toggleList:n=>{t.send({type:"behavior event",behaviorEvent:{type:"list item.toggle",listItem:n},editor:e})},toggleBlockStyle:n=>{t.send({type:"behavior event",behaviorEvent:{type:"style.toggle",style:n},editor:e})},isMarkActive:n=>{let o=eS({editorActorSnapshot:t.getSnapshot(),slateEditorInstance:e});return(0,m.rm)(o).includes(n)},marks:()=>{let n=eS({editorActorSnapshot:t.getSnapshot(),slateEditorInstance:e});return[...(0,m.N2)(n),...(0,m.rm)(n)]},undo:()=>{t.send({type:"behavior event",behaviorEvent:{type:"history.undo"},editor:e})},redo:()=>{t.send({type:"behavior event",behaviorEvent:{type:"history.redo"},editor:e})},select:n=>{let o=ei({context:{schema:t.getSnapshot().context.schema,value:e.value,selection:n},blockIndexMap:e.blockIndexMap});o?c.gB.select(e,o):c.gB.deselect(e),e.onChange()},focusBlock:()=>{if(e.selection){let t=c.bP.descendant(e,e.selection.focus.path.slice(0,1));if(t)return Q([t],n.block.name,e1.get(e))[0]}},focusChild:()=>{if(e.selection){let t=c.bP.descendant(e,e.selection.focus.path.slice(0,1));if(t&&e.isTextBlock(t))return Q([t],n.block.name,e1.get(e))[0].children[e.selection.focus.path[1]]}},insertChild:(o,i)=>{if(o.name!==n.span.name)return t.send({type:"behavior event",behaviorEvent:{type:"insert.inline object",inlineObject:{name:o.name,value:i}},editor:e}),e.selection?et({schema:t.getSnapshot().context.schema,editor:e,range:e.selection})?.focus.path??[]:[];if(!e.selection)throw Error("The editor has no selection");let[r]=Array.from(c.KE.nodes(e,{at:e.selection.focus.path.slice(0,1),match:e=>e._type===n.block.name}))[0]||[void 0];if(!r)throw Error("No focused text block");if(o.name!==n.span.name&&!n.inlineObjects.some(e=>e.name===o.name))throw Error("This type cannot be inserted as a child to a text block");let a=H([{_key:t.getSnapshot().context.keyGenerator(),_type:n.block.name,children:[{_key:t.getSnapshot().context.keyGenerator(),_type:o.name,...i||{}}]}],{schemaTypes:t.getSnapshot().context.schema})[0].children[0],l=e.selection.focus.path.slice(0,2),s=a._type===n.span.name,d=c.bP.get(e,l);return s&&d._type!==n.span.name&&(ov("Inserting span child next to inline object child, moving selection + 1"),e.move({distance:1,unit:"character"})),c.gB.insertNodes(e,a,{select:!0,at:e.selection}),e.onChange(),e.selection?et({schema:t.getSnapshot().context.schema,editor:e,range:e.selection})?.focus.path??[]:[]},insertBlock:(n,o)=>(t.send({type:"behavior event",behaviorEvent:{type:"insert.block",block:{_type:n.name,...o||{}},placement:"auto"},editor:e}),e.selection?et({schema:t.getSnapshot().context.schema,editor:e,range:e.selection})?.focus.path??[]:[]),hasBlockStyle:t=>{try{return function({editor:e,style:t}){if(!e.selection)return!1;let n=[...c.KE.nodes(e,{at:e.selection,match:t=>e.isTextBlock(t)})];return n.length>0&&n.every(([e])=>e.style===t)}({editor:e,style:t})}catch{return!1}},hasListStyle:t=>{try{return function({editor:e,listItem:t}){if(!e.selection)return!1;let n=[...c.KE.nodes(e,{at:e.selection,match:t=>e.isTextBlock(t)})];return n.length>0&&n.every(([n])=>e.isListBlock(n)&&n.listItem===t)}({editor:e,listItem:t})}catch{return!1}},isVoid:e=>![n.block.name,n.span.name].includes(e._type),findByPath:o=>{let i=ei({context:{schema:t.getSnapshot().context.schema,value:e.value,selection:{focus:{path:o,offset:0},anchor:{path:o,offset:0}}},blockIndexMap:e.blockIndexMap});if(i){let[t,r]=c.KE.node(e,i.focus.path.slice(0,1));if(t&&r&&"string"==typeof t._key){if(1===o.length&&1===i.focus.path.length)return[Q([t],n.block.name)[0],[{_key:t._key}]];let r=Q([t],n.block.name,e1.get(e))[0];if(e.isTextBlock(r)){let e=r.children[i.focus.path[1]];if(e)return[e,[{_key:t._key},"children",{_key:e._key}]]}}}return[void 0,void 0]},findDOMNode:t=>{let n;try{let[o]=Array.from(c.KE.nodes(e,{at:[],match:e=>e._key===t._key})||[])[0]||[void 0];n=d.rL.toDOMNode(e,o)}catch{}return n},activeAnnotations:()=>{if(!e.selection||e.selection.focus.path.length<2)return[];try{let t=[];for(let[n,o]of c.KE.nodes(e,{at:e.selection,match:e=>c.EY.isText(e)&&void 0!==e.marks&&Array.isArray(e.marks)&&e.marks.length>0})){let[i]=c.KE.node(e,o,{depth:1});e.isTextBlock(i)&&i.markDefs?.forEach(e=>{c.EY.isText(n)&&n.marks&&Array.isArray(n.marks)&&n.marks.includes(e._key)&&t.push(e)})}return t}catch{return[]}},isAnnotationActive:n=>{let o=eS({editorActorSnapshot:t.getSnapshot(),slateEditorInstance:e});return(0,m.kK)(n)(o)},addAnnotation:(n,o)=>{let i=eS({editorActorSnapshot:t.getSnapshot(),slateEditorInstance:e}),r=(0,k.lN)(i),a=(0,k.d2)(i),l=r.flatMap(e=>(0,g.zS)(i.context,e)?e.markDefs??[]:[]);t.send({type:"behavior event",behaviorEvent:{type:"annotation.add",annotation:{name:n.name,value:o??{}}},editor:e});let s=eS({editorActorSnapshot:t.getSnapshot(),slateEditorInstance:e}),c=(0,k.lN)(s),d=(0,k.gU)(s),p=(0,k.d2)(s),h=p?.node.marks?.filter(e=>!a?.node.marks?.includes(e)&&!s.context.schema.decorators.map(e=>e.name).includes(e)),u=c.flatMap(e=>(0,g.zS)(s.context,e)?e.markDefs?.map(t=>({markDef:t,path:[{_key:e._key},"markDefs",{_key:t._key}]}))??[]:[]).filter(e=>!l.some(t=>t._key===e.markDef._key)),f=p?.path,y=u.find(e=>h?.some(t=>t===e.markDef._key));if(d&&f&&y)return{markDefPath:y.path,markDefPaths:u.map(e=>e.path),spanPath:f}},delete:(o,i)=>{if(o){let r=ei({context:{schema:t.getSnapshot().context.schema,value:e.value,selection:o},blockIndexMap:e.blockIndexMap});if(!(r&&r.anchor.path.length>0&&r.focus.path.length>0))throw Error("Invalid range");if(r){if(!i?.mode||i?.mode==="selected"){ov("Deleting content in selection"),c.gB.delete(e,{at:r,hanging:!0,voids:!0}),e.onChange();return}if(i?.mode==="blocks"&&(ov("Deleting blocks touched by selection"),c.gB.removeNodes(e,{at:r,voids:!0,match:t=>e.isTextBlock(t)||!e.isTextBlock(t)&&c.Hg.isElement(t)})),i?.mode==="children"&&(ov("Deleting children touched by selection"),c.gB.removeNodes(e,{at:r,voids:!0,match:t=>t._type===n.span.name||!e.isTextBlock(t)&&c.Hg.isElement(t)})),0===e.children.length){let n=tl(t.getSnapshot().context);e.children=[n],e.value=[n],ta({schema:t.getSnapshot().context.schema,value:e.value},{blockIndexMap:e.blockIndexMap,listIndexMap:e.listIndexMap})}e.onChange()}}},removeAnnotation:n=>{t.send({type:"behavior event",behaviorEvent:{type:"annotation.remove",annotation:{name:n.name}},editor:e})},getSelection:()=>{let n=null;if(e.selection){let o=e2.get(e.selection);if(o)return o;n=et({schema:t.getSnapshot().context.schema,editor:e,range:e.selection}),e2.set(e.selection,n)}return n},getValue:()=>Q(e.children,n.block.name,e1.get(e)),isCollapsedSelection:()=>!!e.selection&&c.Q6.isCollapsed(e.selection),isExpandedSelection:()=>!!e.selection&&c.Q6.isExpanded(e.selection),insertBreak:()=>{e.insertBreak(),e.onChange()},getFragment:()=>Q(e.getFragment(),n.block.name),isSelectionsOverlapping:(n,o)=>{let i=ei({context:{schema:t.getSnapshot().context.schema,value:e.value,selection:n},blockIndexMap:e.blockIndexMap}),r=ei({context:{schema:t.getSnapshot().context.schema,value:e.value,selection:o},blockIndexMap:e.blockIndexMap});return c.Q6.isRange(i)&&c.Q6.isRange(r)&&c.Q6.includes(i,r)}}}(i.instance,n),{mutationActor:a,syncActor:l}=function(e){oA("Creating new Actors");let t=(0,w.c)(ok,{input:{readOnly:e.editorActor.getSnapshot().matches({"edit mode":"read only"}),schema:e.editorActor.getSnapshot().context.schema,slateEditor:e.slateEditor}}),n=(0,w.c)(ow,{input:{initialValue:e.editorActor.getSnapshot().context.initialValue,keyGenerator:e.editorActor.getSnapshot().context.keyGenerator,readOnly:e.editorActor.getSnapshot().matches({"edit mode":"read only"}),schema:e.editorActor.getSnapshot().context.schema,slateEditor:e.slateEditor}});return e.subscriptions.push(()=>{let o=t.on("*",t=>{"has pending mutations"===t.type&&n.send({type:"has pending mutations"}),"mutation"===t.type&&(n.send({type:"mutation"}),e.editorActor.send({type:"mutation",patches:t.patches,snapshot:t.snapshot,value:t.snapshot})),"patch"===t.type&&e.relayActor.send(t)});return()=>{o.unsubscribe()}}),e.subscriptions.push(()=>{let t=n.on("*",t=>{switch(t.type){case"invalid value":case"value changed":e.relayActor.send(t);break;case"patch":e.editorActor.send({...t,type:"internal.patch",value:Q(e.slateEditor.children,e.editorActor.getSnapshot().context.schema.block.name,e1.get(e.slateEditor))});break;default:e.editorActor.send(t)}});return()=>{t.unsubscribe()}}),e.subscriptions.push(()=>{let o=e.editorActor.subscribe(e=>{e.matches({"edit mode":"read only"})?(t.send({type:"update readOnly",readOnly:!0}),n.send({type:"update readOnly",readOnly:!0})):(t.send({type:"update readOnly",readOnly:!1}),n.send({type:"update readOnly",readOnly:!1}))});return()=>{o.unsubscribe()}}),e.subscriptions.push(()=>{let n=e.editorActor.on("*",n=>{switch(n.type){case"editable":case"mutation":case"ready":case"read only":case"selection":e.relayActor.send(n);break;case"internal.patch":t.send({...n,type:"patch"})}});return()=>{n.unsubscribe()}}),{mutationActor:t,syncActor:n}}({editorActor:n,relayActor:o,slateEditor:i.instance,subscriptions:t}),s={dom:nB(e=>n.send(e),i.instance),getSnapshot:()=>eS({editorActorSnapshot:n.getSnapshot(),slateEditorInstance:i.instance}),registerBehavior:e=>{let t=ed({name:"custom",reference:{priority:ep,importance:"higher"}}),o={...e,priority:t};return n.send({type:"add behavior",behaviorConfig:o}),()=>{n.send({type:"remove behavior",behaviorConfig:o})}},send:e=>{switch(e.type){case"update value":l.send(e);break;case"update readOnly":case"patches":case"update maxBlocks":n.send(e);break;default:n.send(oy({event:e,slateEditor:i.instance}))}},on:(e,t)=>o.on(e,e=>{switch(e.type){case"blurred":case"done loading":case"editable":case"focused":case"invalid value":case"loading":case"mutation":case"patch":case"read only":case"ready":case"selection":case"value changed":t(e)}}),_internal:{editable:r,editorActor:n,slateEditor:i}};return{actors:{editorActor:n,mutationActor:a,relayActor:o,syncActor:l},editor:s,subscriptions:t}}function oD(e){switch(e.type){case"blurred":return{type:"blur",event:e.event};case"patch":case"mutation":case"ready":case"selection":case"unset":return e;case"loading":return{type:"loading",isLoading:!0};case"done loading":return{type:"loading",isLoading:!1};case"focused":return{type:"focus",event:e.event};case"value changed":return{type:"value",value:e.value};case"invalid value":return{type:"invalidValue",resolution:e.resolution,value:e.value}}}let oN=G("component:PortableTextEditor");class oI extends i.Component{static displayName="PortableTextEditor";change$=new L.B;subscriptions=[];unsubscribers=[];constructor(e){if(super(e),e.editor)this.editor=e.editor,this.schemaTypes=this.editor._internal.editorActor.getSnapshot().context.getLegacySchema();else{let{actors:t,editor:n,subscriptions:o}=oO({initialValue:e.value,keyGenerator:e.keyGenerator,maxBlocks:void 0===e.maxBlocks?void 0:Number.parseInt(e.maxBlocks.toString(),10),readOnly:e.readOnly,schema:e.schemaType});this.subscriptions=o,this.actors=t,this.editor=n,this.schemaTypes=t.editorActor.getSnapshot().context.getLegacySchema()}this.editable=this.editor._internal.editable}componentDidMount(){if(!this.actors)return;for(let e of this.subscriptions)this.unsubscribers.push(e());let e=this.actors.relayActor.on("*",e=>{let t=oD(e);t&&(this.props.editor||this.props.onChange(t),this.change$.next(t))});this.unsubscribers.push(e.unsubscribe),this.actors.editorActor.start(),this.actors.mutationActor.start(),this.actors.relayActor.start(),this.actors.syncActor.start()}componentDidUpdate(e){this.props.editor||e.editor||this.props.schemaType===e.schemaType||console.warn("Updating schema type is no longer supported"),this.props.editor||e.editor||(this.props.readOnly!==e.readOnly&&this.editor._internal.editorActor.send({type:"update readOnly",readOnly:this.props.readOnly??!1}),this.props.maxBlocks!==e.maxBlocks&&this.editor._internal.editorActor.send({type:"update maxBlocks",maxBlocks:void 0===this.props.maxBlocks?void 0:Number.parseInt(this.props.maxBlocks.toString(),10)}),this.props.value!==e.value&&this.editor.send({type:"update value",value:this.props.value}),this.props.editorRef!==e.editorRef&&this.props.editorRef&&(this.props.editorRef.current=this))}componentWillUnmount(){for(let e of this.unsubscribers)e();this.actors&&(tt(this.actors.editorActor),tt(this.actors.mutationActor),tt(this.actors.relayActor),tt(this.actors.syncActor))}setEditable=e=>{this.editor._internal.editable={...this.editor._internal.editable,...e}};render(){let e=this.props.editor?void 0:this.props.incomingPatches$??this.props.patches$;return(0,a.jsxs)(a.Fragment,{children:[e?(0,a.jsx)(oM,{editorActor:this.editor._internal.editorActor,patches$:e}):null,(0,a.jsx)(ea.Provider,{value:this.editor._internal.editorActor,children:(0,a.jsx)(eW.Provider,{value:this.actors.relayActor,children:(0,a.jsx)(d.A,{editor:this.editor._internal.slateEditor.instance,initialValue:this.editor._internal.slateEditor.initialValue,children:(0,a.jsx)(eC.Provider,{value:this,children:this.props.children})})})})]})}static activeAnnotations=e=>e&&e.editable?e.editable.activeAnnotations():[];static isAnnotationActive=(e,t)=>!!e&&!!e.editable&&e.editable.isAnnotationActive(t);static addAnnotation=(e,t,n)=>e.editable?.addAnnotation(t,n);static blur=e=>{oN("Host blurred"),e.editable?.blur()};static delete=(e,t,n)=>e.editable?.delete(t,n);static findDOMNode=(e,t)=>e.editable?.findDOMNode(t);static findByPath=(e,t)=>e.editable?.findByPath(t)||[];static focus=e=>{oN("Host requesting focus"),e.editable?.focus()};static focusBlock=e=>e.editable?.focusBlock();static focusChild=e=>e.editable?.focusChild();static getSelection=e=>e.editable?e.editable.getSelection():null;static getValue=e=>e.editable?.getValue();static hasBlockStyle=(e,t)=>e.editable?.hasBlockStyle(t);static hasListStyle=(e,t)=>e.editable?.hasListStyle(t);static isCollapsedSelection=e=>e.editable?.isCollapsedSelection();static isExpandedSelection=e=>e.editable?.isExpandedSelection();static isMarkActive=(e,t)=>e.editable?.isMarkActive(t);static insertChild=(e,t,n)=>(oN("Host inserting child"),e.editable?.insertChild(t,n));static insertBlock=(e,t,n)=>e.editable?.insertBlock(t,n);static insertBreak=e=>e.editable?.insertBreak();static isVoid=(e,t)=>e.editable?.isVoid(t);static isObjectPath=(e,t)=>{if(!t||!Array.isArray(t))return!1;let n=t.length>3&&"children"===t[1];return t.length>1&&"children"!==t[1]||n};static marks=e=>e.editable?.marks();static select=(e,t)=>{oN("Host setting selection",t),e.editable?.select(t)};static removeAnnotation=(e,t)=>e.editable?.removeAnnotation(t);static toggleBlockStyle=(e,t)=>(oN("Host is toggling block style"),e.editable?.toggleBlockStyle(t));static toggleList=(e,t)=>e.editable?.toggleList(t);static toggleMark=(e,t)=>{oN("Host toggling mark",t),e.editable?.toggleMark(t)};static getFragment=e=>e.editable?.getFragment();static undo=e=>{oN("Host undoing"),e.editable?.undo()};static redo=e=>{oN("Host redoing"),e.editable?.redo()};static isSelectionsOverlapping=(e,t,n)=>e.editable?.isSelectionsOverlapping(t,n)}function oM(e){let t,n,r=(0,o.c)(4);return r[0]!==e.editorActor||r[1]!==e.patches$?(t=()=>{let t=e.patches$.subscribe(t=>{e.editorActor.send({type:"patches",...t})});return()=>{t.unsubscribe()}},n=[e.editorActor,e.patches$],r[0]=e.editorActor,r[1]=e.patches$,r[2]=t,r[3]=n):(t=r[2],n=r[3]),(0,i.useEffect)(t,n),null}function oj(e){let t,n,l,s,c,p,h,u,f=(0,o.c)(28);f[0]!==e.initialConfig?(t=()=>{let t=oO(e.initialConfig),n=new oI({editor:t.editor});return{internalEditor:t,portableTextEditor:n}},f[0]=e.initialConfig,f[1]=t):t=f[1];let[y]=(0,i.useState)(t),{internalEditor:g,portableTextEditor:m}=y;return f[2]!==g.actors.editorActor||f[3]!==g.actors.mutationActor||f[4]!==g.actors.relayActor||f[5]!==g.actors.syncActor||f[6]!==g.subscriptions||f[7]!==m?(n=()=>{let e=[];for(let t of g.subscriptions)e.push(t());let t=g.actors.relayActor.on("*",e=>{let t=oD(e);t&&m.change$.next(t)});return e.push(t.unsubscribe),g.actors.editorActor.start(),g.actors.mutationActor.start(),g.actors.relayActor.start(),g.actors.syncActor.start(),()=>{for(let t of e)t();tt(g.actors.editorActor),tt(g.actors.mutationActor),tt(g.actors.relayActor),tt(g.actors.syncActor)}},f[2]=g.actors.editorActor,f[3]=g.actors.mutationActor,f[4]=g.actors.relayActor,f[5]=g.actors.syncActor,f[6]=g.subscriptions,f[7]=m,f[8]=n):n=f[8],f[9]!==g||f[10]!==m?(l=[g,m],f[9]=g,f[10]=m,f[11]=l):l=f[11],(0,i.useEffect)(n,l),f[12]!==m||f[13]!==e.children?(s=(0,a.jsx)(eC.Provider,{value:m,children:e.children}),f[12]=m,f[13]=e.children,f[14]=s):s=f[14],f[15]!==g.editor._internal.slateEditor.initialValue||f[16]!==g.editor._internal.slateEditor.instance||f[17]!==s?(c=(0,a.jsx)(d.A,{editor:g.editor._internal.slateEditor.instance,initialValue:g.editor._internal.slateEditor.initialValue,children:s}),f[15]=g.editor._internal.slateEditor.initialValue,f[16]=g.editor._internal.slateEditor.instance,f[17]=s,f[18]=c):c=f[18],f[19]!==g.actors.relayActor||f[20]!==c?(p=(0,a.jsx)(eW.Provider,{value:g.actors.relayActor,children:c}),f[19]=g.actors.relayActor,f[20]=c,f[21]=p):p=f[21],f[22]!==g.actors.editorActor||f[23]!==p?(h=(0,a.jsx)(ea.Provider,{value:g.actors.editorActor,children:p}),f[22]=g.actors.editorActor,f[23]=p,f[24]=h):h=f[24],f[25]!==g.editor||f[26]!==h?(u=(0,a.jsx)(r.p.Provider,{value:g.editor,children:h}),f[25]=g.editor,f[26]=h,f[27]=u):u=f[27],u}let oC=()=>{let e,t,n=(0,o.c)(3),r=(0,i.useContext)(ea),[a,l]=(0,i.useState)(null);return n[0]!==r?(e=()=>{let e=r.on("selection",e=>{(0,i.startTransition)(()=>{l(e.selection)})});return()=>{e.unsubscribe()}},t=[r],n[0]=r,n[1]=e,n[2]=t):(e=n[1],t=n[2]),(0,i.useEffect)(e,t),a}}}]);